/* ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
   ‚ïë üöÄ ARQUIVO: ViagemEventoController.UpdateStatus.cs                                                  ‚ïë
   ‚ïë üìÇ CAMINHO: /Controllers                                                                            ‚ïë
   ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
   ‚ïë üéØ OBJETIVO: Partial para atualiza√ß√£o de status de eventos. Alterna entre Ativo ("1") e            ‚ïë
   ‚ïë    Inativo ("0") de forma toggle.                                                                   ‚ïë
   ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
   ‚ïë üìã ENDPOINTS: [GET] /api/ViagemEvento/UpdateStatusEvento?Id={guid} ‚Üí Alterna status                ‚ïë
   ‚ïë    RETORNO: { success, type (0|1), message } para atualizar UI                                     ‚ïë
   ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
   ‚ïë üîó DEPS: IUnitOfWork (Evento), ViagemEventoController                                               ‚ïë
   ‚ïë üìÖ Atualizado: 2026 | üë§ FrotiX Team | üìù Vers√£o: 2.0                                              ‚ïë
   ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù */

using FrotiX.Repository.IRepository;
using Microsoft.AspNetCore.Mvc;
using System;

namespace FrotiX.Controllers
{
    public partial class ViagemEventoController
    {
        /****************************************************************************************
         * ‚ö° FUN√á√ÉO: UpdateStatusEvento
         * --------------------------------------------------------------------------------------
         * üéØ OBJETIVO     : Alternar status do evento entre Ativo ("1") e Inativo ("0")
         *                   Opera√ß√£o toggle: se ativo‚Üíinativo, se inativo‚Üíativo
         * üì• ENTRADAS     : [Guid] Id - ID do evento a alterar
         * üì§ SA√çDAS       : [IActionResult] JSON com success, type (novo status), message
         * üîó CHAMADA POR  : JavaScript (bot√£o de ativar/inativar na grid de eventos)
         * üîÑ CHAMA        : IUnitOfWork.Evento.GetFirstOrDefault, Update, Save
         *
         * üìä RETORNO:
         *    - success: true/false
         *    - type: Novo status como int (0 ou 1) para atualizar UI
         *    - message: Mensagem de confirma√ß√£o para toast/alert
         ****************************************************************************************/
        [Route("UpdateStatusEvento")]
        [HttpGet]
        public IActionResult UpdateStatusEvento(Guid Id)
        {
            try
            {
                // [DOC] STEP 1: Buscar evento pelo ID
                var evento = _unitOfWork.Evento.GetFirstOrDefault(e => e.EventoId == Id);

                // [DOC] STEP 2: Validar se evento existe
                if (evento == null)
                {
                    return Json(new
                    {
                        success = false,
                        message = "Evento n√£o encontrado"
                    });
                }

                // [DOC] STEP 3: Toggle do status - Alterna entre "1" (Ativo) e "0" (Inativo)
                evento.Status = evento.Status == "1" ? "0" : "1";

                // [DOC] STEP 4: Persistir altera√ß√£o no banco
                _unitOfWork.Evento.Update(evento);
                _unitOfWork.Save();

                // [DOC] STEP 5: Retornar sucesso com novo status para atualizar UI
                return Json(new
                {
                    success = true,
                    type = int.Parse(evento.Status),  // [DOC] Retorna como int para facilitar uso no JS
                    message = evento.Status == "1" ? "Evento ativado com sucesso" : "Evento inativado com sucesso"
                });
            }
            catch (Exception error)
            {
                // [DOC] Tratamento de erro padronizado
                Alerta.TratamentoErroComLinha("ViagemEventoController.cs", "UpdateStatusEvento", error);
                return Json(new
                {
                    success = false,
                    message = "Erro ao alterar status do evento"
                });
            }
        }
    }
}
