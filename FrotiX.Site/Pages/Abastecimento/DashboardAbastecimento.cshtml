@* ****************************************************************************************
 * ‚ö° ARQUIVO: Pages/Abastecimento/DashboardAbastecimento.cshtml
 * --------------------------------------------------------------------------------------
 * üéØ OBJETIVO     : Dashboard completo de abastecimentos com 3 abas (Geral, Mensal, Por Ve√≠culo) usando Chart.js e Syncfusion Heatmap
 * üì• ENTRADAS     : @page, @model DashboardAbastecimentoModel, filtros por ano/m√™s/placa/per√≠odo personalizado
 * üì§ SA√çDAS       : Sistema de abas, cards estat√≠sticos, gr√°ficos Chart.js, heatmaps Syncfusion, modais de detalhes (viagens, abastecimentos, categoria, unidade), export PDF via jsPDF+html2canvas
 * üîó CHAMADA POR  : Menu "Dashboards > Abastecimento"
 * üîÑ CHAMA        : /js/dashboards/dashboard-abastecimento.js (externo), APIs REST /api/abastecimento/Dashboard/*
 * üì¶ DEPEND√äNCIAS : Syncfusion EJ2 (Heatmap, Charts), Select2, jQuery, jsPDF, html2canvas, dashboard-abastecimento.js
 * üìù OBSERVA√á√ïES  : Total: 2401 linhas (LIDO PARCIAL). ISSUES: Arquivo GIGANTE (2400+ linhas), CSS excessivo inline (400+ linhas), sistema de abas sem lazy loading, modais com dados carregados mas n√£o limitados (performance), Select2 configurado mas tooltip sobrep√µe dropdown
 **************************************************************************************** *@
@page
@model FrotiX.Pages.Abastecimento.DashboardAbastecimentoModel
@{
    ViewData["Title"] = "Dashboard de Abastecimentos";
    ViewData["PageName"] = "abastecimento_dashboardabastecimento";
    ViewData["Heading"] = "<i class='fa-duotone fa-gas-pump'></i> Dashboard: <span class='fw-300'>Abastecimentos</span>";
    ViewData["Category1"] = "Dashboards";
    ViewData["PageIcon"] = "fa-duotone fa-chart-line";
}

@section HeadBlock {
<style>
    /* ========================================
       PALETA DE CORES - TEMA CARAMELO SUAVE
       ======================================== */
    :root {
        --abast-primary: #a8784c;
        --abast-secondary: #c4956a;
        --abast-accent: #d4a574;
        --abast-dark: #8b5e3c;
        --abast-darker: #6d472c;
        --abast-light: #faf6f1;
        --abast-cream: #f5ebe0;
        --abast-gradient: linear-gradient(135deg, #a8784c 0%, #c4956a 100%);
    }

    /* Header do Dashboard */
    .header-dashboard-abast {
        background: var(--abast-gradient);
        color: white;
        padding: 20px 24px;
        border-radius: 10px;
        margin-bottom: 24px;
        box-shadow: 0 4px 15px rgba(168, 120, 76, 0.35);
    }

    .header-dashboard-titulo-abast {
        margin: 0;
        font-family: 'Outfit', sans-serif;
        font-weight: 800;
        font-size: 1.75rem;
        display: flex;
        align-items: center;
        gap: 12px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        position: relative;
        z-index: 1;
    }

    .header-dashboard-titulo-abast i {
        font-size: 1.75rem;
        filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.25));
    }

    /* Navega√ß√£o de Abas - Atualizado 15/01/2026 */
    .dash-tabs {
        background: #f5ebe0 !important; /* var(--abast-cream) for√ßado */
        border-radius: 12px;
        padding: 6px;
        margin-bottom: 24px;
        box-shadow: 0 2px 8px rgba(168, 120, 76, 0.15);
        display: flex;
        gap: 6px;
    }

    .dash-tab {
        flex: 1;
        padding: 12px 20px;
        border: none;
        background: transparent;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        color: #8b5e3c !important; /* var(--abast-dark) for√ßado */
        cursor: pointer;
        transition: all 0.25s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .dash-tab:hover {
        background: rgba(168, 120, 76, 0.15);
        color: var(--abast-darker);
    }

    .dash-tab.active {
        background: var(--abast-gradient);
        color: white;
        box-shadow: 0 4px 12px rgba(168, 120, 76, 0.35);
    }

    .dash-tab i { font-size: 1.1rem; }

    .dash-content {
        display: none !important;
        visibility: hidden;
        position: absolute;
        left: -9999px;
    }

    .dash-content.active {
        display: block !important;
        visibility: visible;
        position: relative;
        left: 0;
        animation: fadeIn 0.3s ease;
    }

    @@keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Container de Filtros */
    .filter-card-abast {
        background: var(--abast-gradient);
        color: white;
        border-radius: 12px;
        padding: 20px 24px;
        margin-bottom: 24px;
        box-shadow: 0 4px 12px rgba(168, 120, 76, 0.25);
    }

    .filter-card-abast .form-label {
        color: white;
        font-weight: 600;
        font-size: 0.85rem;
        margin-bottom: 6px;
    }

    .filter-card-abast .form-control,
    .filter-card-abast .form-select {
        background: rgba(255,255,255,0.18);
        border: 1px solid rgba(255,255,255,0.35);
        color: white;
        border-radius: 8px;
        font-size: 0.9rem;
        padding: 8px 12px;
    }

    .filter-card-abast .form-control::placeholder { color: rgba(255,255,255,0.7); }

    .filter-card-abast .form-control:focus,
    .filter-card-abast .form-select:focus {
        background: rgba(255,255,255,0.28);
        border-color: rgba(255,255,255,0.6);
        box-shadow: 0 0 0 3px rgba(255,255,255,0.2);
        color: white;
    }

    .filter-card-abast .form-select option {
        background: var(--abast-dark);
        color: white;
    }

    /* Bot√µes de Filtro - Base comum */
    .btn-filtrar-abast, .btn-limpar-abast {
        padding: 8px 20px !important;
        border-radius: 8px !important;
        font-weight: 600 !important;
        font-size: 0.875rem !important;
        line-height: 1.5 !important;
        transition: all 0.3s ease !important;
        box-sizing: border-box !important;
    }

    /* Bot√£o Filtrar */
    .btn-filtrar-abast {
        background: rgba(255,255,255,0.2) !important;
        border: 2px solid rgba(255,255,255,0.5) !important;
        color: white !important;
    }

    .btn-filtrar-abast:hover {
        background: rgba(255,255,255,0.35) !important;
        border-color: white !important;
        transform: translateY(-1px) !important;
    }

    /* Bot√£o Limpar Filtro */
    .btn-limpar-abast {
        background: linear-gradient(135deg, #B28767 0%, #9a7254 100%) !important;
        border: 2px solid rgba(255, 255, 255, 0.6) !important;
        color: white !important;
        box-shadow: 0 2px 8px rgba(178, 135, 103, 0.4);
    }

    .btn-limpar-abast:hover {
        background: linear-gradient(135deg, #9a7254 0%, #825d43 100%) !important;
        border-color: rgba(255, 255, 255, 0.9) !important;
        color: white !important;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(75, 85, 99, 0.5);
    }

    /* Bot√µes de Per√≠odo R√°pido */
    .btn-period-abast, .btn-period-abast-veiculo {
        border-radius: 20px;
        padding: 8px 16px;
        font-weight: 600;
        font-size: 0.85rem;
        transition: all 0.2s;
        border: 2px solid rgba(255,255,255,0.3);
        background: rgba(255,255,255,0.15);
        color: white;
    }

    .btn-period-abast:hover, .btn-period-abast-veiculo:hover {
        transform: scale(1.05);
        background: rgba(255,255,255,0.25);
        border-color: rgba(255,255,255,0.5);
        color: white;
    }

    .btn-period-abast.active, .btn-period-abast-veiculo.active {
        background: white;
        color: var(--abast-primary);
        border-color: white;
    }

    /* Indicador de Per√≠odo */
    .periodo-atual-abast {
        background: rgba(255,255,255,0.2);
        border: 1px solid rgba(255,255,255,0.3);
        border-radius: 8px;
        padding: 10px 16px;
        color: white;
        font-size: 0.9rem;
    }

    /* Cards de Estat√≠sticas */
    .card-estatistica-abast {
        background: white;
        border-radius: 10px;
        padding: 16px 20px;
        border-left: 4px solid;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        transition: all 0.3s ease;
        height: 100%;
        min-height: 90px;
    }

    .card-estatistica-abast:hover {
        box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        transform: translateY(-3px);
    }

    .card-estatistica-abast.amber { border-left-color: var(--abast-primary); }
    .card-estatistica-abast.orange { border-left-color: #ea580c; }
    .card-estatistica-abast.yellow { border-left-color: var(--abast-accent); }
    .card-estatistica-abast.brown { border-left-color: var(--abast-darker); }
    .card-estatistica-abast.gold { border-left-color: #ca8a04; }

    .icone-card-abast {
        font-size: 1.4rem;
        margin-bottom: 8px;
    }

    .card-estatistica-abast.amber .icone-card-abast { color: var(--abast-primary); }
    .card-estatistica-abast.orange .icone-card-abast { color: #ea580c; }
    .card-estatistica-abast.yellow .icone-card-abast { color: var(--abast-accent); }
    .card-estatistica-abast.brown .icone-card-abast { color: var(--abast-darker); }
    .card-estatistica-abast.gold .icone-card-abast { color: #ca8a04; }

    .texto-metrica-abast {
        font-size: 0.7rem;
        color: #6B7280;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 6px;
    }

    .valor-metrica-abast {
        font-size: 1.5rem;
        font-weight: 800;
        color: #111827;
        line-height: 1.1;
    }

    /* Cards de Gr√°ficos */
    .chart-container-abast {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        transition: box-shadow 0.3s ease;
        height: 100%;
        border: none;
    }

    .chart-container-abast:hover {
        box-shadow: 0 6px 16px rgba(0,0,0,0.1);
    }

    .chart-title-abast {
        font-size: 0.95rem;
        font-weight: 700;
        margin-bottom: 16px;
        color: #111827;
        display: flex;
        align-items: center;
        gap: 10px;
        padding-bottom: 12px;
        border-bottom: 2px solid var(--abast-cream);
    }

    .chart-title-abast i {
        color: var(--abast-primary);
        font-size: 1.1rem;
    }

    .chart-subtitle {
        font-size: 0.7rem;
        color: #9ca3af;
        font-weight: 400;
        margin-left: auto;
    }

    /* Card Mensal Grande */
    .stat-card-mensal-abast {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .stat-card-mensal-abast .card-header-custom {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--abast-cream);
    }

    .stat-card-mensal-abast .card-header-custom i {
        color: var(--abast-primary);
        font-size: 1.1rem;
    }

    .stat-card-mensal-abast .card-header-custom span {
        font-size: 0.9rem;
        font-weight: 700;
        color: #111827;
    }

    .stat-card-mensal-abast .big-value {
        font-size: 2rem;
        font-weight: 800;
        color: var(--abast-dark);
        text-align: center;
        margin-top: auto;
        margin-bottom: auto;
    }

    /* =====================================================
       GRID-TABELAS - Usando DIVs para evitar CSS global de table
       ===================================================== */
    .ftx-grid-tabela {
        width: 100%;
        font-size: 0.8rem;
    }

    .ftx-grid-tabela .grid-header {
        display: grid;
        background: linear-gradient(135deg, #a8784c 0%, #c4956a 100%);
        border-radius: 6px 6px 0 0;
    }

    .ftx-grid-tabela .grid-header-cell {
        color: #ffffff;
        font-weight: 600;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        padding: 10px 12px;
    }

    .ftx-grid-tabela .grid-body {
        max-height: 280px;
        overflow-y: auto;
    }

    .ftx-grid-tabela .grid-row {
        display: grid;
        border-bottom: 1px solid #f3f4f6;
        transition: background-color 0.15s;
    }

    .ftx-grid-tabela .grid-row:hover {
        background-color: var(--abast-light);
    }

    .ftx-grid-tabela .grid-cell {
        padding: 10px 12px;
    }

    .ftx-grid-tabela .text-end {
        text-align: right;
    }

    /* Layout 2 colunas (Resumo por Ano, Top por Tipo) */
    .ftx-grid-tabela.cols-2 .grid-header,
    .ftx-grid-tabela.cols-2 .grid-row {
        grid-template-columns: 1fr auto;
    }

    /* Layout 3 colunas (Top por Placa) */
    .ftx-grid-tabela.cols-3 .grid-header,
    .ftx-grid-tabela.cols-3 .grid-row {
        grid-template-columns: auto 1fr auto;
    }

    .ftx-grid-tabela .grid-row-total {
        background: var(--abast-cream);
        font-weight: 700;
    }

    /* Linha clic√°vel - abre detalhes */
    .ftx-grid-tabela .grid-row-clicavel {
        cursor: pointer;
    }

    .ftx-grid-tabela .grid-row-clicavel:hover {
        background-color: #e8f4e8;
        box-shadow: inset 3px 0 0 var(--abast-primary);
    }

    .ftx-grid-tabela .grid-row-clicavel:active {
        background-color: #d4ecd4;
    }

    /* Badge de Ranking */
    .badge-rank-abast {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--abast-secondary);
        color: white;
        font-size: 0.7rem;
        font-weight: 700;
        margin-right: 8px;
    }

    .badge-rank-abast.top3 {
        background: var(--abast-primary);
        box-shadow: 0 2px 6px rgba(168, 120, 76, 0.4);
    }

    /* Tabela M√©dia Litro */
    .table-media-litro-abast {
        font-size: 0.8rem;
        margin: 0;
    }

    .table-media-litro-abast tbody tr {
        border-bottom: 1px solid #f3f4f6;
    }

    .table-media-litro-abast tbody td {
        padding: 8px 10px;
    }

    /* Loading - Usa padr√£o FrotiX global (ftx-spin-overlay) */

    /* ================================================================
       MODAL DE DETALHES - Tema Caramelo/Creme
       ================================================================ */
    #modalDetalhesAbast .modal-dialog {
        max-width: 900px;
    }

    #modalDetalhesAbast .modal-content {
        border: none;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 10px 40px rgba(0,0,0,0.25);
    }

    #modalDetalhesAbast .modal-header {
        background: linear-gradient(135deg, #a8784c 0%, #c4956a 100%);
        border-bottom: none;
        padding: 1rem 1.5rem;
    }

    #modalDetalhesAbast .modal-title {
        font-family: 'Outfit', sans-serif;
        font-weight: 700;
        font-size: 1.1rem;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    #modalDetalhesAbast .modal-title i {
        font-size: 1.2rem;
    }

    #modalDetalhesAbast .btn-close {
        filter: brightness(0) invert(1);
        opacity: 0.8;
    }

    #modalDetalhesAbast .btn-close:hover {
        opacity: 1;
    }

    #modalDetalhesAbast .modal-body {
        background: var(--abast-cream);
        padding: 1.5rem;
        max-height: 500px;
        overflow-y: auto;
    }

    #modalDetalhesAbast .detalhes-resumo {
        background: white;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        display: flex;
        gap: 2rem;
        flex-wrap: wrap;
    }

    #modalDetalhesAbast .detalhes-resumo-item {
        text-align: center;
    }

    #modalDetalhesAbast .detalhes-resumo-label {
        font-size: 0.7rem;
        color: #6c757d;
        text-transform: uppercase;
        font-weight: 600;
    }

    #modalDetalhesAbast .detalhes-resumo-valor {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--abast-dark);
    }

    #modalDetalhesAbast .detalhes-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 0;
        background: white;
        border-radius: 8px;
        overflow: hidden;
    }

    #modalDetalhesAbast .detalhes-grid-header {
        background: linear-gradient(135deg, #a8784c 0%, #c4956a 100%);
        color: white;
        font-weight: 600;
        font-size: 0.75rem;
        text-transform: uppercase;
        padding: 10px 12px;
    }

    #modalDetalhesAbast .detalhes-grid-cell {
        padding: 8px 12px;
        font-size: 0.8rem;
        border-bottom: 1px solid #f3f4f6;
    }

    #modalDetalhesAbast .detalhes-grid-cell:nth-child(10n+6),
    #modalDetalhesAbast .detalhes-grid-cell:nth-child(10n+7),
    #modalDetalhesAbast .detalhes-grid-cell:nth-child(10n+8),
    #modalDetalhesAbast .detalhes-grid-cell:nth-child(10n+9),
    #modalDetalhesAbast .detalhes-grid-cell:nth-child(10n+10) {
        background: var(--abast-light);
    }

    #modalDetalhesAbast .modal-footer {
        background: var(--abast-cream);
        border-top: 1px solid rgba(168, 120, 76, 0.2);
        padding: 1rem 1.5rem;
    }

    #modalDetalhesAbast .btn-fechar-modal {
        background: var(--abast-primary);
        border: none;
        color: white;
        padding: 8px 24px;
        border-radius: 6px;
        font-weight: 600;
    }

    #modalDetalhesAbast .btn-fechar-modal:hover {
        background: var(--abast-dark);
    }

    /* ================================================================
       MAPA DE CALOR
       ================================================================ */
    .heatmap-container {
        background: white;
        border-radius: 8px;
        padding: 10px;
    }

    /* Legenda customizada com faixas de valores */
    .heatmap-legenda-custom {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
        margin-top: 12px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
        flex-wrap: wrap;
    }

    .heatmap-legenda-item {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 0.72rem;
        color: #555;
    }

    .heatmap-legenda-cor {
        width: 16px;
        height: 16px;
        border-radius: 3px;
        border: 1px solid #ddd;
    }

    .heatmap-legenda-range {
        font-family: 'Outfit', sans-serif;
        white-space: nowrap;
    }

    /* Responsividade */
    @@media (max-width: 992px) {
        .valor-metrica-abast { font-size: 1.3rem; }
        .chart-container-abast { margin-bottom: 1rem; }
        .dash-tab { font-size: 0.85rem; padding: 10px 16px; }
        .header-dashboard-titulo-abast { font-size: 1.4rem; }
    }

    @@media (max-width: 768px) {
        .dash-tabs { flex-direction: column; }
        .card-estatistica-abast { margin-bottom: 12px; }
        .header-dashboard-abast { padding: 16px 20px; }
    }

    /* ========== BOT√ÉO EXPORTAR PDF ========== */
    .abast-btn-pdf {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        background: linear-gradient(135deg, var(--abast-primary), var(--abast-dark));
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 0.65rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        opacity: 0.85;
        margin-left: auto;
    }

    .abast-btn-pdf:hover {
        opacity: 1;
        transform: translateY(-1px);
        box-shadow: 0 3px 10px rgba(168, 120, 76, 0.4);
    }

    .abast-btn-pdf i {
        font-size: 10px;
    }

    .chart-title-abast {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* ========================================
       SELECT2 - Estilo para filtro de Placas
       ======================================== */
    /* Garantir que o container da Placa seja em bloco com label em cima */
    .filtro-placa-container {
        display: flex;
        flex-direction: column;
    }

    .filtro-placa-container .form-label {
        display: block;
        margin-bottom: 6px;
    }

    #filtroPlacaVeiculo + .select2-container {
        min-width: 220px !important;
        display: block !important;
    }

    #filtroPlacaVeiculo + .select2-container .select2-selection--single {
        height: 38px;
        border: 1px solid #ced4da;
        border-radius: 6px;
        background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
    }

    #filtroPlacaVeiculo + .select2-container .select2-selection--single .select2-selection__rendered {
        line-height: 36px;
        padding-left: 12px;
        color: #495057;
    }

    #filtroPlacaVeiculo + .select2-container .select2-selection--single .select2-selection__arrow {
        height: 36px;
    }

    #filtroPlacaVeiculo + .select2-container--focus .select2-selection--single {
        border-color: var(--abast-accent);
        box-shadow: 0 0 0 0.2rem rgba(168, 120, 76, 0.25);
    }

    /* Dropdown do Select2 */
    .select2-dropdown {
        border-color: var(--abast-accent);
        border-radius: 6px;
    }

    .select2-results__option--highlighted[aria-selected] {
        background-color: var(--abast-accent) !important;
        color: white !important;
    }

    .select2-search--dropdown .select2-search__field {
        border: 1px solid var(--abast-secondary);
        border-radius: 4px;
        padding: 6px 10px;
    }

    .select2-search--dropdown .select2-search__field:focus {
        border-color: var(--abast-primary);
        outline: none;
    }
</style>
}

<div id="dashboardAbastecimento" class="container-fluid">
    <!-- HEADER -->
    <div class="header-dashboard-abast">
        <h2 class="header-dashboard-titulo-abast">
            <i class="fa-duotone fa-gas-pump"></i>
            Dashboard de Abastecimentos
        </h2>
    </div>

    <!-- NAVEGA√á√ÉO DE ABAS -->
    <div class="dash-tabs">
        <button class="dash-tab active" data-tab="consumo-geral">
            <i class="fa-duotone fa-house"></i>
            <span>Consumo Geral</span>
        </button>
        <button class="dash-tab" data-tab="consumo-mensal">
            <i class="fa-duotone fa-calendar-days"></i>
            <span>Consumo Mensal</span>
        </button>
        <button class="dash-tab" data-tab="consumo-veiculo">
            <i class="fa-duotone fa-car"></i>
            <span>Consumo por Ve√≠culo</span>
        </button>
    </div>

    <div class="dash-tabs-container">
    <!-- ========================================== -->
    <!-- ABA 1: CONSUMO GERAL -->
    <!-- ========================================== -->
    <div id="tab-consumo-geral" class="dash-content active">
        <div class="filter-card-abast">
            <!-- Linha 1: Ano, M√™s -->
            <div class="row align-items-end g-3 mb-3">
                <div class="col-auto">
                    <label class="form-label">
                        <i class="fa-duotone fa-calendar me-1"></i> Ano
                    </label>
                    <select id="filtroAnoGeral" class="form-select" style="min-width: 120px;">
                        <option value="">&lt;Todos os Anos&gt;</option>
                    </select>
                </div>
                <div class="col-auto">
                    <label class="form-label">
                        <i class="fa-duotone fa-calendar-day me-1"></i> M√™s
                    </label>
                    <select id="filtroMesGeral" class="form-select" style="min-width: 150px;">
                        <option value="">&lt;Todos os Meses&gt;</option>
                    </select>
                </div>
                <div class="col-auto">
                    <label class="form-label">&nbsp;</label>
                    <button type="button" class="btn btn-filtrar-abast d-block" id="btnFiltrarAnoMesGeral">
                        <i class="fa-duotone fa-magnifying-glass me-1"></i> Filtrar
                    </button>
                </div>
                <div class="col-auto">
                    <label class="form-label">&nbsp;</label>
                    <button type="button" class="btn btn-limpar-abast d-block" id="btnLimparAnoMesGeral">
                        <i class="fa-duotone fa-eraser me-1"></i> Limpar
                    </button>
                </div>
            </div>

            <!-- Linha 2: Per√≠odo Personalizado + Per√≠odos R√°pidos -->
            <div class="row align-items-end g-3">
                <div class="col-auto">
                    <label class="form-label">
                        <i class="fa-duotone fa-calendar-range me-1"></i> Per√≠odo Personalizado
                    </label>
                    <div class="d-flex gap-2 align-items-center">
                        <div>
                            <label class="form-label small mb-1">De:</label>
                            <input type="date" id="dataInicioGeral" class="form-control" style="width: 140px;" />
                        </div>
                        <div>
                            <label class="form-label small mb-1">At√©:</label>
                            <input type="date" id="dataFimGeral" class="form-control" style="width: 140px;" />
                        </div>
                    </div>
                </div>
                <div class="col-auto">
                    <label class="form-label">&nbsp;</label>
                    <button type="button" class="btn btn-filtrar-abast d-block" id="btnFiltrarPeriodoGeral">
                        <i class="fa-duotone fa-magnifying-glass me-1"></i> Filtrar
                    </button>
                </div>
                <div class="col-auto">
                    <label class="form-label">&nbsp;</label>
                    <button type="button" class="btn btn-limpar-abast d-block" id="btnLimparPeriodoGeral">
                        <i class="fa-duotone fa-eraser me-1"></i> Limpar
                    </button>
                </div>
                <div class="col">
                    <label class="form-label">Per√≠odos R√°pidos</label>
                    <div class="d-flex gap-2 flex-wrap">
                        <button type="button" class="btn-period-abast" data-dias="7">7 dias</button>
                        <button type="button" class="btn-period-abast" data-dias="15">15 dias</button>
                        <button type="button" class="btn-period-abast" data-dias="30">30 dias</button>
                        <button type="button" class="btn-period-abast" data-dias="60">60 dias</button>
                        <button type="button" class="btn-period-abast" data-dias="90">90 dias</button>
                        <button type="button" class="btn-period-abast" data-dias="180">180 dias</button>
                        <button type="button" class="btn-period-abast" data-dias="365">1 ano</button>
                    </div>
                </div>
            </div>

            <!-- Indicador do per√≠odo atual -->
            <div class="row mt-3">
                <div class="col-12">
                    <div class="periodo-atual-abast d-flex align-items-center">
                        <i class="fa-duotone fa-info-circle me-2"></i>
                        <span id="periodoAtualLabelGeral">Exibindo todos os dados</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-2">
            <div class="col-lg col-md-6">
                <div class="card-estatistica-abast amber">
                    <div class="icone-card-abast"><i class="fa-duotone fa-sack-dollar"></i></div>
                    <div class="texto-metrica-abast">Valor Total</div>
                    <div class="valor-metrica-abast" id="valorTotalGeral">R$ 0</div>
                </div>
            </div>
            <div class="col-lg col-md-6">
                <div class="card-estatistica-abast orange">
                    <div class="icone-card-abast"><i class="fa-duotone fa-gas-pump"></i></div>
                    <div class="texto-metrica-abast">Total de Litros</div>
                    <div class="valor-metrica-abast" id="litrosTotalGeral">0</div>
                </div>
            </div>
            <div class="col-lg col-md-6">
                <div class="card-estatistica-abast yellow">
                    <div class="icone-card-abast"><i class="fa-duotone fa-gauge-high"></i></div>
                    <div class="texto-metrica-abast">Abastecimentos</div>
                    <div class="valor-metrica-abast" id="qtdAbastecimentosGeral">0</div>
                </div>
            </div>
            <div class="col-lg col-md-6">
                <div class="card-estatistica-abast brown">
                    <div class="icone-card-abast"><i class="fa-duotone fa-droplet"></i></div>
                    <div class="texto-metrica-abast">Diesel S-10</div>
                    <div class="valor-metrica-abast" id="mediaDieselGeral">R$ 0</div>
                </div>
            </div>
            <div class="col-lg col-md-6">
                <div class="card-estatistica-abast gold">
                    <div class="icone-card-abast"><i class="fa-duotone fa-droplet"></i></div>
                    <div class="texto-metrica-abast">Gasolina</div>
                    <div class="valor-metrica-abast" id="mediaGasolinaGeral">R$ 0</div>
                </div>
            </div>
        </div>

        <div class="row g-3 mt-1">
            <div class="col-lg-3">
                <div class="chart-container-abast" style="min-height: 360px;">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-calendar-lines"></i>
                        Resumo por Ano
                        <button type="button" class="abast-btn-pdf" onclick="exportarGraficoPdf('tabelaResumoPorAno', 'Resumo por Ano')" title="Exportar PDF">
                            <i class="fa-duotone fa-file-pdf"></i> PDF
                        </button>
                    </h5>
                    <div class="ftx-grid-tabela cols-2">
                        <div class="grid-header">
                            <div class="grid-header-cell">Ano</div>
                            <div class="grid-header-cell text-end">Valor (R$)</div>
                        </div>
                        <div class="grid-body" id="tabelaResumoPorAno">
                            <div class="grid-row" style="justify-content: center; padding: 20px;">
                                <i class="fa-duotone fa-spinner-third fa-spin"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="chart-container-abast" style="min-height: 360px;">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-chart-bar"></i>
                        Valor Total por Categoria
                        <button type="button" class="abast-btn-pdf" onclick="exportarGraficoPdf('chartValorCategoria', 'Valor Total por Categoria')" title="Exportar PDF">
                            <i class="fa-duotone fa-file-pdf"></i> PDF
                        </button>
                    </h5>
                    <div id="chartValorCategoria" style="height: 300px;"></div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="chart-container-abast" style="min-height: 360px;">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-chart-line"></i>
                        Valor do Litro por M√™s
                        <button type="button" class="abast-btn-pdf" onclick="exportarGraficoPdf('chartValorLitro', 'Valor do Litro por Mes')" title="Exportar PDF">
                            <i class="fa-duotone fa-file-pdf"></i> PDF
                        </button>
                    </h5>
                    <div id="chartValorLitro" style="height: 300px;"></div>
                </div>
            </div>
        </div>

        <div class="row g-3 mt-1">
            <div class="col-lg-6">
                <div class="chart-container-abast" style="min-height: 340px;">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-chart-area"></i>
                        Litros por M√™s
                        <button type="button" class="abast-btn-pdf" onclick="exportarGraficoPdf('chartLitrosMes', 'Litros por Mes')" title="Exportar PDF">
                            <i class="fa-duotone fa-file-pdf"></i> PDF
                        </button>
                    </h5>
                    <div id="chartLitrosMes" style="height: 280px;"></div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="chart-container-abast" style="min-height: 340px;">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-chart-column"></i>
                        Consumo Geral por M√™s
                        <button type="button" class="abast-btn-pdf" onclick="exportarGraficoPdf('chartConsumoMes', 'Consumo Geral por Mes')" title="Exportar PDF">
                            <i class="fa-duotone fa-file-pdf"></i> PDF
                        </button>
                    </h5>
                    <div id="chartConsumoMes" style="height: 280px;"></div>
                </div>
            </div>
        </div>

        <!-- Mapa de Calor - Dia da Semana x Hora -->
        <div class="row g-3 mt-2">
            <div class="col-12">
                <div class="chart-container-abast">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-grid-2"></i>
                        Mapa de Calor - Consumo por Dia/Hora
                        <span class="chart-subtitle">Visualize quando ocorrem mais abastecimentos (clique para ver detalhes)</span>
                        <button type="button" class="abast-btn-pdf" onclick="exportarGraficoPdf('heatmapDiaHora', 'Mapa de Calor - Consumo por Dia-Hora')" title="Exportar PDF">
                            <i class="fa-duotone fa-file-pdf"></i> PDF
                        </button>
                    </h5>
                    <div class="heatmap-container">
                        <div id="heatmapDiaHora" style="height: 450px;"></div>
                        <div id="legendaHeatmapDiaHora" class="heatmap-legenda-custom"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- ABA 2: CONSUMO MENSAL -->
    <!-- ========================================== -->
    <div id="tab-consumo-mensal" class="dash-content">
        <!-- Filtros -->
        <div class="filter-card-abast">
            <div class="row align-items-end g-3">
                <div class="col-md-3">
                    <label class="form-label">
                        <i class="fa-duotone fa-calendar me-1"></i> Ano
                    </label>
                    <select id="filtroAnoMensal" class="form-select"></select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">
                        <i class="fa-duotone fa-calendar-day me-1"></i> M√™s
                    </label>
                    <select id="filtroMesMensal" class="form-select">
                        <option value="">&lt;Todos os Meses&gt;</option>
                    </select>
                </div>
                <div class="col-auto">
                    <label class="form-label">&nbsp;</label>
                    <button type="button" class="btn btn-filtrar-abast d-block" id="btnFiltrarMensal">
                        <i class="fa-duotone fa-magnifying-glass me-1"></i> Filtrar
                    </button>
                </div>
                <div class="col-auto">
                    <label class="form-label">&nbsp;</label>
                    <button type="button" class="btn btn-limpar-abast d-block" id="btnLimparMensal">
                        <i class="fa-duotone fa-eraser me-1"></i> Limpar
                    </button>
                </div>
            </div>
        </div>

        <!-- LINHA 1: 4 Cards equivalentes -->
        <div class="row g-3">
            <!-- Card 1: Valor Total -->
            <div class="col-lg-3 col-md-6">
                <div class="stat-card-mensal-abast">
                    <div class="card-header-custom">
                        <i class="fa-duotone fa-sack-dollar"></i>
                        <span>Valor Total</span>
                    </div>
                    <div class="big-value" id="valorTotalMensal">R$ 0</div>
                </div>
            </div>

            <!-- Card 2: Litros -->
            <div class="col-lg-3 col-md-6">
                <div class="stat-card-mensal-abast">
                    <div class="card-header-custom">
                        <i class="fa-duotone fa-gas-pump"></i>
                        <span>Total de Litros</span>
                    </div>
                    <div class="big-value" id="totalLitrosMensal">0</div>
                </div>
            </div>

            <!-- Card 3: M√©dia do Litro -->
            <div class="col-lg-3 col-md-6">
                <div class="stat-card-mensal-abast">
                    <div class="card-header-custom">
                        <i class="fa-duotone fa-dollar-sign"></i>
                        <span>M√©dia do Litro</span>
                    </div>
                    <div class="table-responsive" style="flex: 1;">
                        <table class="table table-media-litro-abast mb-0">
                            <tbody id="tabelaMediaLitroMensal">
                                <tr><td colspan="2" class="text-center py-3"><i class="fa-duotone fa-spinner-third fa-spin"></i></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Card 4: Combust√≠veis (Pizza COM LEGENDA) -->
            <div class="col-lg-3 col-md-6">
                <div class="stat-card-mensal-abast" style="min-height: 220px;">
                    <div class="card-header-custom">
                        <i class="fa-duotone fa-chart-pie"></i>
                        <span>Combust√≠veis</span>
                    </div>
                    <div id="chartPizzaCombustivel" style="height: 180px;"></div>
                </div>
            </div>
        </div>

        <!-- LINHA 2: Litros por Dia (largura total) -->
        <div class="row g-3 mt-2">
            <div class="col-12">
                <div class="chart-container-abast">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-chart-area"></i>
                        Litros por Dia
                        <button type="button" class="abast-btn-pdf" onclick="exportarGraficoPdf('chartLitrosDia', 'Litros por Dia')" title="Exportar PDF">
                            <i class="fa-duotone fa-file-pdf"></i> PDF
                        </button>
                    </h5>
                    <div id="chartLitrosDia" style="height: 220px;"></div>
                </div>
            </div>
        </div>

        <!-- LINHA 3: TOP 15 lado a lado -->
        <div class="row g-3 mt-2">
            <!-- Por Unidade -->
            <div class="col-lg-6">
                <div class="chart-container-abast" style="min-height: 480px;">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-building"></i>
                        Top 15 por Unidade
                        <span class="chart-subtitle">Soma de todos os abastecimentos por unidade</span>
                        <button type="button" class="abast-btn-pdf" onclick="exportarGraficoPdf('tabelaValorPorUnidade', 'Top 15 por Unidade', 'portrait')" title="Exportar PDF">
                            <i class="fa-duotone fa-file-pdf"></i> PDF
                        </button>
                    </h5>
                    <div class="ftx-grid-tabela cols-2">
                        <div class="grid-header">
                            <div class="grid-header-cell">Unidade</div>
                            <div class="grid-header-cell text-end">Valor</div>
                        </div>
                        <div class="grid-body" id="tabelaValorPorUnidade" style="max-height: 380px;">
                            <div class="grid-row" style="justify-content: center; padding: 20px;">
                                <i class="fa-duotone fa-spinner-third fa-spin"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Por Placa Individual -->
            <div class="col-lg-6">
                <div class="chart-container-abast" style="min-height: 480px;">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-rectangle-barcode"></i>
                        Top 15 por Placa Individual
                        <span class="chart-subtitle">Cada ve√≠culo separadamente</span>
                        <button type="button" class="abast-btn-pdf" onclick="exportarGraficoPdf('tabelaValorPorPlaca', 'Top 15 por Placa Individual', 'portrait')" title="Exportar PDF">
                            <i class="fa-duotone fa-file-pdf"></i> PDF
                        </button>
                    </h5>
                    <div class="ftx-grid-tabela cols-3">
                        <div class="grid-header">
                            <div class="grid-header-cell">Placa</div>
                            <div class="grid-header-cell">Tipo</div>
                            <div class="grid-header-cell text-end">Valor</div>
                        </div>
                        <div class="grid-body" id="tabelaValorPorPlaca" style="max-height: 380px;">
                            <div class="grid-row" style="justify-content: center; padding: 20px;">
                                <i class="fa-duotone fa-spinner-third fa-spin"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- LINHA 4: Consumo por Categoria REAL -->
        <div class="row g-3 mt-2">
            <div class="col-12">
                <div class="chart-container-abast">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-tags"></i>
                        Consumo por Categoria
                        <span class="chart-subtitle">Ambul√¢ncia, Carga Leve, Carga Pesada, Coletivos Pequenos, Depol, Mesa, √înibus/Micro√¥nibus, Passeio</span>
                        <button type="button" class="abast-btn-pdf" onclick="exportarGraficoPdf('chartConsumoCategoria', 'Consumo por Categoria')" title="Exportar PDF">
                            <i class="fa-duotone fa-file-pdf"></i> PDF
                        </button>
                    </h5>
                    <div id="chartConsumoCategoria" style="height: 280px;"></div>
                </div>
            </div>
        </div>

        <!-- Mapa de Calor - Categoria x M√™s -->
        <div class="row g-3 mt-2">
            <div class="col-12">
                <div class="chart-container-abast">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-grid-2"></i>
                        Mapa de Calor - Consumo por Categoria
                        <span class="chart-subtitle">Visualize o consumo por categoria ao longo do ano</span>
                        <button type="button" class="abast-btn-pdf" onclick="exportarGraficoPdf('heatmapCategoria', 'Mapa de Calor - Consumo por Categoria')" title="Exportar PDF">
                            <i class="fa-duotone fa-file-pdf"></i> PDF
                        </button>
                    </h5>
                    <div class="heatmap-container">
                        <div id="heatmapCategoria" style="height: 320px;"></div>
                        <div id="legendaHeatmapCategoria" class="heatmap-legenda-custom"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- ABA 3: CONSUMO POR VE√çCULO -->
    <!-- ========================================== -->
    <div id="tab-consumo-veiculo" class="dash-content">
        <div class="filter-card-abast">
            <!-- Linha 1: Ano, M√™s, Modelo, Placa -->
            <div class="row align-items-end g-3 mb-3">
                <div class="col-auto">
                    <label class="form-label">
                        <i class="fa-duotone fa-calendar me-1"></i> Ano
                    </label>
                    <select id="filtroAnoVeiculo" class="form-select" style="min-width: 120px;"></select>
                </div>
                <div class="col-auto">
                    <label class="form-label">
                        <i class="fa-duotone fa-calendar-day me-1"></i> M√™s
                    </label>
                    <select id="filtroMesVeiculo" class="form-select" style="min-width: 150px;">
                        <option value="">&lt;Todos os Meses&gt;</option>
                    </select>
                </div>
                <div class="col-auto filtro-placa-container">
                    <label class="form-label">
                        <i class="fa-duotone fa-rectangle-barcode me-1"></i> Placa
                    </label>
                    <select id="filtroPlacaVeiculo" class="form-select" style="min-width: 200px;">
                        <option value="">Todas</option>
                    </select>
                </div>
                <div class="col-auto">
                    <label class="form-label">&nbsp;</label>
                    <button type="button" class="btn btn-filtrar-abast d-block" id="btnFiltrarAnoMesVeiculo" data-ejtip="Selecione os Par√¢metros para a Pesquisa">
                        <i class="fa-duotone fa-filter me-1"></i> Filtrar
                    </button>
                </div>
                <div class="col-auto">
                    <label class="form-label">&nbsp;</label>
                    <button type="button" class="btn btn-limpar-abast d-block" id="btnLimparAnoMesVeiculo">
                        <i class="fa-duotone fa-eraser me-1"></i> Limpar
                    </button>
                </div>
            </div>

            <!-- Linha 2: Per√≠odo Personalizado + Per√≠odos R√°pidos -->
            <div class="row align-items-end g-3">
                <div class="col-auto">
                    <label class="form-label">
                        <i class="fa-duotone fa-calendar-range me-1"></i> Per√≠odo Personalizado
                    </label>
                    <div class="d-flex gap-2 align-items-center">
                        <div>
                            <label class="form-label small mb-1">De:</label>
                            <input type="date" id="dataInicioVeiculo" class="form-control" style="width: 140px;" />
                        </div>
                        <div>
                            <label class="form-label small mb-1">At√©:</label>
                            <input type="date" id="dataFimVeiculo" class="form-control" style="width: 140px;" />
                        </div>
                    </div>
                </div>
                <div class="col-auto">
                    <label class="form-label">&nbsp;</label>
                    <button type="button" class="btn btn-filtrar-abast d-block" id="btnFiltrarPeriodoVeiculo">
                        <i class="fa-duotone fa-magnifying-glass me-1"></i> Filtrar
                    </button>
                </div>
                <div class="col-auto">
                    <label class="form-label">&nbsp;</label>
                    <button type="button" class="btn btn-limpar-abast d-block" id="btnLimparPeriodoVeiculo">
                        <i class="fa-duotone fa-eraser me-1"></i> Limpar
                    </button>
                </div>
                <div class="col">
                    <label class="form-label">Per√≠odos R√°pidos</label>
                    <div class="d-flex gap-2 flex-wrap">
                        <button type="button" class="btn-period-abast-veiculo" data-dias="7">7 dias</button>
                        <button type="button" class="btn-period-abast-veiculo" data-dias="15">15 dias</button>
                        <button type="button" class="btn-period-abast-veiculo" data-dias="30">30 dias</button>
                        <button type="button" class="btn-period-abast-veiculo" data-dias="60">60 dias</button>
                        <button type="button" class="btn-period-abast-veiculo" data-dias="90">90 dias</button>
                        <button type="button" class="btn-period-abast-veiculo" data-dias="180">180 dias</button>
                        <button type="button" class="btn-period-abast-veiculo" data-dias="365">1 ano</button>
                    </div>
                </div>
            </div>

            <!-- Indicador do per√≠odo atual -->
            <div class="row mt-3">
                <div class="col-12">
                    <div class="periodo-atual-abast d-flex align-items-center">
                        <i class="fa-duotone fa-info-circle me-2"></i>
                        <span id="periodoAtualLabelVeiculo">Exibindo todos os dados</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-3">
            <div class="col-lg-12">
                <div class="chart-container-abast mb-3">
                    <div class="text-center py-2">
                        <div style="font-size: 0.75rem; color: #64748b;">Ve√≠culo Selecionado</div>
                        <h3 id="descricaoVeiculoSelecionado" style="font-size: 1.3rem; font-weight: 700; color: var(--abast-dark); margin: 0.4rem 0;">
                            Selecione um ve√≠culo
                        </h3>
                        <div style="font-size: 0.75rem; color: #64748b;">Categoria</div>
                        <h4 id="categoriaVeiculoSelecionado" style="font-size: 1rem; font-weight: 600; color: var(--abast-primary); margin: 0.2rem 0;">-</h4>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-3">
            <div class="col-lg-3 col-md-6">
                <div class="card-estatistica-abast amber">
                    <div class="icone-card-abast"><i class="fa-duotone fa-sack-dollar"></i></div>
                    <div class="texto-metrica-abast">Valor Total</div>
                    <div class="valor-metrica-abast" id="valorTotalVeiculo">R$ 0</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card-estatistica-abast orange">
                    <div class="icone-card-abast"><i class="fa-duotone fa-gas-pump"></i></div>
                    <div class="texto-metrica-abast">Total de Litros</div>
                    <div class="valor-metrica-abast" id="litrosTotalVeiculo">0</div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="chart-container-abast" style="min-height: 120px;">
                    <h5 class="chart-title-abast" style="font-size: 0.8rem;">
                        <i class="fa-duotone fa-chart-line"></i>
                        Consumo Mensal de Litros
                    </h5>
                    <div id="chartConsumoMensalVeiculo" style="height: 160px;"></div>
                </div>
            </div>
        </div>

        <div class="row g-3 mt-1">
            <div class="col-lg-6">
                <div class="chart-container-abast" style="min-height: 340px;">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-chart-bar"></i>
                        Valor Total Mensal
                    </h5>
                    <div id="chartValorMensalVeiculo" style="height: 280px;"></div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="chart-container-abast" style="min-height: 340px;">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-ranking-star" id="iconRankingVeiculos"></i>
                        <span id="tituloRankingVeiculos">Ranking de Ve√≠culos (Top 10)</span>
                        <span class="chart-subtitle" id="subtituloRankingVeiculos">Por placa individual</span>
                    </h5>
                    <div id="chartRankingVeiculos" style="height: 280px;"></div>
                </div>
            </div>
        </div>

        <div class="row g-3 mt-1">
            <div class="col-lg-12">
                <div class="chart-container-abast">
                    <h5 class="chart-title-abast">
                        <i class="fa-duotone fa-fire-flame-simple"></i>
                        Mapa de Calor - Dia da Semana x Hora
                        <span class="chart-subtitle">Padr√£o de abastecimento do ve√≠culo selecionado</span>
                    </h5>
                    <div class="heatmap-container">
                        <div id="heatmapVeiculo" style="height: 380px;"></div>
                        <div id="legendaHeatmapVeiculo" class="heatmap-legenda-custom"></div>
                    </div>
                    <div id="heatmapVeiculoVazio" class="text-center text-muted py-4" style="display: none;">
                        Selecione um ve√≠culo para visualizar o padr√£o de abastecimento
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>

<!-- Overlay de Loading - Padr√£o FrotiX -->
<div id="loadingOverlayAbast" class="ftx-spin-overlay" style="z-index: 999999; cursor: wait; display: none;">
    <div class="ftx-spin-box" style="text-align: center; min-width: 300px;">
        <img src="/images/logo_gota_frotix_transparente.png" alt="FrotiX" class="ftx-loading-logo" style="display: block;" />
        <div class="ftx-loading-bar"></div>
        <div class="ftx-loading-text">Carregando Dashboard de Abastecimento</div>
        <div class="ftx-loading-subtext">Aguarde, por favor</div>
    </div>
</div>

<!-- Modal de Detalhes dos Abastecimentos -->
<div class="modal fade" id="modalDetalhesAbast" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fa-duotone fa-list-check"></i>
                    <span id="modalDetalhesTitulo">Detalhes dos Abastecimentos</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <div class="detalhes-resumo" id="detalhesResumo">
                    <div class="detalhes-resumo-item">
                        <div class="detalhes-resumo-label">Registros</div>
                        <div class="detalhes-resumo-valor" id="detalhesQtd">0</div>
                    </div>
                    <div class="detalhes-resumo-item">
                        <div class="detalhes-resumo-label">Total Litros</div>
                        <div class="detalhes-resumo-valor" id="detalhesLitros">0</div>
                    </div>
                    <div class="detalhes-resumo-item">
                        <div class="detalhes-resumo-label">Valor Total</div>
                        <div class="detalhes-resumo-valor" id="detalhesValor">R$ 0</div>
                    </div>
                </div>
                <div class="detalhes-grid" id="detalhesGrid">
                    <div class="detalhes-grid-header">Data</div>
                    <div class="detalhes-grid-header">Ve√≠culo</div>
                    <div class="detalhes-grid-header">Litros</div>
                    <div class="detalhes-grid-header">R$/Litro</div>
                    <div class="detalhes-grid-header">Total</div>
                    <!-- Linhas ser√£o adicionadas via JavaScript -->
                </div>
                <div id="detalhesVazio" class="text-center py-4 text-muted" style="display: none;">
                    <i class="fa-duotone fa-inbox fa-2x mb-2"></i>
                    <div>Nenhum registro encontrado</div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-fechar-modal" data-bs-dismiss="modal">
                    <i class="fa-duotone fa-xmark me-1"></i> Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Viagens do Ve√≠culo -->
<div class="modal fade" id="modalViagensVeiculo" tabindex="-1" aria-labelledby="modalViagensVeiculoLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content" style="border-radius: 12px; overflow: hidden;">
            <div class="modal-header" style="background: linear-gradient(135deg, #325d88 0%, #4a7c59 100%); color: white; border: none;">
                <h5 class="modal-title" id="modalViagensVeiculoLabel">
                    <i class="fa-duotone fa-route me-2"></i>
                    Viagens do Ve√≠culo
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" style="background: #f8f9fa; padding: 0;">
                <!-- Header com informa√ß√µes do ve√≠culo -->
                <div class="viagem-modal-header" style="background: white; padding: 20px; border-bottom: 1px solid #dee2e6;">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <div class="d-flex align-items-center gap-3">
                                <div class="viagem-placa-badge" style="background: #325d88; color: white; padding: 10px 20px; border-radius: 8px; font-size: 1.3rem; font-weight: 700; letter-spacing: 2px;">
                                    <i class="fa-duotone fa-rectangle-barcode me-2"></i>
                                    <span id="modalVeiculoPlaca">---</span>
                                </div>
                                <div>
                                    <div style="font-weight: 600; color: #333;" id="modalVeiculoModelo">---</div>
                                    <div style="font-size: 0.85rem; color: #6c757d;" id="modalVeiculoCategoria">---</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8 text-md-end mt-3 mt-md-0">
                            <div class="d-flex justify-content-md-end gap-3 flex-wrap">
                                <div class="text-center px-2">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Per√≠odo</div>
                                    <div style="font-size: 1rem; font-weight: 600; color: #325d88;" id="modalPeriodo">---</div>
                                </div>
                                <div class="text-center px-2" style="border-left: 1px solid #dee2e6;">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Viagens</div>
                                    <div style="font-size: 1rem; font-weight: 600; color: #4a7c59;" id="modalTotalViagens">0</div>
                                </div>
                                <div class="text-center px-2" style="border-left: 1px solid #dee2e6;">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Km Rodados</div>
                                    <div style="font-size: 1rem; font-weight: 600; color: #722f37;" id="modalTotalKm">0</div>
                                </div>
                                <div class="text-center px-2" style="border-left: 1px solid #dee2e6;">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Abastec.</div>
                                    <div style="font-size: 1rem; font-weight: 600; color: #f59e0b;" id="modalTotalAbastecimentos">0</div>
                                </div>
                                <div class="text-center px-2" style="border-left: 1px solid #dee2e6;">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Litros</div>
                                    <div style="font-size: 1rem; font-weight: 600; color: #0ea5e9;" id="modalTotalLitros">0</div>
                                </div>
                                <div class="text-center px-2" style="border-left: 1px solid #dee2e6;">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Valor Total</div>
                                    <div style="font-size: 1rem; font-weight: 700; color: #dc2626;" id="modalTotalValor">R$ 0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Abas -->
                <ul class="nav nav-tabs" style="padding: 0 20px; background: white; border-bottom: none;">
                    <li class="nav-item">
                        <button class="nav-link active" id="tabViagens" data-bs-toggle="tab" data-bs-target="#painelViagens" type="button">
                            <i class="fa-duotone fa-route me-1"></i> Viagens
                            <span class="badge bg-success ms-1" id="badgeViagens">0</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="tabAbastecimentos" data-bs-toggle="tab" data-bs-target="#painelAbastecimentos" type="button">
                            <i class="fa-duotone fa-gas-pump me-1"></i> Abastecimentos
                            <span class="badge bg-warning text-dark ms-1" id="badgeAbastecimentos">0</span>
                        </button>
                    </li>
                </ul>

                <div class="tab-content" style="padding: 20px;">
                    <!-- Painel Viagens -->
                    <div class="tab-pane fade show active" id="painelViagens">
                        <div class="table-responsive" style="background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); max-height: 400px;">
                            <table class="table table-hover mb-0" id="tabelaViagensModal">
                                <thead style="background: #f1f3f5; position: sticky; top: 0;">
                                    <tr>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-file-lines me-1"></i> Ficha
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-calendar me-1"></i> Data Inicial
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-clock me-1"></i> Hora
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-calendar me-1"></i> Data Final
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-clock me-1"></i> Hora
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-gauge me-1"></i> Km Ini
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-gauge-max me-1"></i> Km Fin
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-road me-1"></i> Rodado
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="corpoTabelaViagens">
                                    <tr>
                                        <td colspan="8" class="text-center py-4">
                                            <i class="fa-duotone fa-spinner-third fa-spin fa-2x text-muted"></i>
                                            <div class="mt-2 text-muted">Carregando...</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Painel Abastecimentos -->
                    <div class="tab-pane fade" id="painelAbastecimentos">
                        <div class="table-responsive" style="background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); max-height: 400px;">
                            <table class="table table-hover mb-0" id="tabelaAbastecimentosModal">
                                <thead style="background: #fff8e1; position: sticky; top: 0;">
                                    <tr>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-calendar me-1"></i> Data
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-fire-flame me-1"></i> Combust√≠vel
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-droplet me-1"></i> Litros
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-dollar-sign me-1"></i> R$/Litro
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-coins me-1"></i> Total
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-road me-1"></i> Km Rodado
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="corpoTabelaAbastecimentos">
                                    <tr>
                                        <td colspan="6" class="text-center py-4">
                                            <i class="fa-duotone fa-spinner-third fa-spin fa-2x text-muted"></i>
                                            <div class="mt-2 text-muted">Carregando...</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="background: white; border-top: 1px solid #dee2e6;">
                <button type="button" class="btn btn-fechar-modal" data-bs-dismiss="modal">
                    <i class="fa-duotone fa-xmark me-1"></i> Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Abastecimentos da Unidade -->
<div class="modal fade" id="modalAbastecimentosUnidade" tabindex="-1" aria-labelledby="modalAbastecimentosUnidadeLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content" style="border-radius: 12px; overflow: hidden;">
            <div class="modal-header" style="background: linear-gradient(135deg, #a8784c 0%, #c4956a 100%); color: white; border: none;">
                <h5 class="modal-title" id="modalAbastecimentosUnidadeLabel">
                    <i class="fa-duotone fa-building me-2"></i>
                    Abastecimentos da Unidade
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" style="background: #f8f9fa; padding: 0;">
                <!-- Header com informa√ß√µes da unidade -->
                <div class="unidade-modal-header" style="background: white; padding: 20px; border-bottom: 1px solid #dee2e6;">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <div class="d-flex align-items-center gap-3">
                                <div class="unidade-badge" style="background: #a8784c; color: white; padding: 10px 20px; border-radius: 8px; font-size: 1.3rem; font-weight: 700; letter-spacing: 2px;">
                                    <i class="fa-duotone fa-building me-2"></i>
                                    <span id="modalUnidadeNome">---</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8 text-md-end mt-3 mt-md-0">
                            <div class="d-flex justify-content-md-end gap-3 flex-wrap">
                                <div class="text-center px-2">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Per√≠odo</div>
                                    <div style="font-size: 1rem; font-weight: 600; color: #a8784c;" id="modalUnidadePeriodo">---</div>
                                </div>
                                <div class="text-center px-2" style="border-left: 1px solid #dee2e6;">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Abastec.</div>
                                    <div style="font-size: 1rem; font-weight: 600; color: #f59e0b;" id="modalUnidadeTotalAbastecimentos">0</div>
                                </div>
                                <div class="text-center px-2" style="border-left: 1px solid #dee2e6;">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Litros</div>
                                    <div style="font-size: 1rem; font-weight: 600; color: #0ea5e9;" id="modalUnidadeTotalLitros">0</div>
                                </div>
                                <div class="text-center px-2" style="border-left: 1px solid #dee2e6;">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Valor Total</div>
                                    <div style="font-size: 1rem; font-weight: 700; color: #dc2626;" id="modalUnidadeTotalValor">R$ 0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Abas -->
                <ul class="nav nav-tabs" style="padding: 0 20px; background: white; border-bottom: none;">
                    <li class="nav-item">
                        <button class="nav-link active" id="tabAbastecimentosUnidade" data-bs-toggle="tab" data-bs-target="#painelAbastecimentosUnidade" type="button">
                            <i class="fa-duotone fa-gas-pump me-1"></i> Abastecimentos
                            <span class="badge bg-warning text-dark ms-1" id="badgeAbastecimentosUnidade">0</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="tabResumoVeiculos" data-bs-toggle="tab" data-bs-target="#painelResumoVeiculos" type="button">
                            <i class="fa-duotone fa-cars me-1"></i> Resumo por Ve√≠culo
                            <span class="badge bg-info text-dark ms-1" id="badgeResumoVeiculos">0</span>
                        </button>
                    </li>
                </ul>

                <div class="tab-content" style="padding: 20px;">
                    <!-- Painel Abastecimentos -->
                    <div class="tab-pane fade show active" id="painelAbastecimentosUnidade">
                        <div class="table-responsive" style="background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); max-height: 400px;">
                            <table class="table table-hover mb-0" id="tabelaAbastecimentosUnidadeModal">
                                <thead style="background: #fff8e1; position: sticky; top: 0;">
                                    <tr>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-calendar me-1"></i> Data
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-rectangle-barcode me-1"></i> Placa
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-car me-1"></i> Ve√≠culo
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-fire-flame me-1"></i> Combust√≠vel
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-droplet me-1"></i> Litros
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-dollar-sign me-1"></i> R$/Litro
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-coins me-1"></i> Total
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="corpoTabelaAbastecimentosUnidade">
                                    <tr>
                                        <td colspan="7" class="text-center py-4">
                                            <i class="fa-duotone fa-spinner-third fa-spin fa-2x text-muted"></i>
                                            <div class="mt-2 text-muted">Carregando...</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Painel Resumo por Ve√≠culo -->
                    <div class="tab-pane fade" id="painelResumoVeiculos">
                        <div class="table-responsive" style="background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); max-height: 400px;">
                            <table class="table table-hover mb-0" id="tabelaResumoVeiculosModal">
                                <thead style="background: #e0f7fa; position: sticky; top: 0;">
                                    <tr>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-rectangle-barcode me-1"></i> Placa
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-car me-1"></i> Tipo Ve√≠culo
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-gas-pump me-1"></i> Qtd Abast.
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-droplet me-1"></i> Litros
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-coins me-1"></i> Valor Total
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="corpoTabelaResumoVeiculos">
                                    <tr>
                                        <td colspan="5" class="text-center py-4">
                                            <i class="fa-duotone fa-spinner-third fa-spin fa-2x text-muted"></i>
                                            <div class="mt-2 text-muted">Carregando...</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="background: white; border-top: 1px solid #dee2e6;">
                <button type="button" class="btn btn-fechar-modal" data-bs-dismiss="modal">
                    <i class="fa-duotone fa-xmark me-1"></i> Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Abastecimentos por Categoria -->
<div class="modal fade" id="modalAbastecimentosCategoria" tabindex="-1" aria-labelledby="modalAbastecimentosCategoriaLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content" style="border-radius: 12px; overflow: hidden;">
            <div class="modal-header" style="background: linear-gradient(135deg, #4a7c59 0%, #6b8e23 100%); color: white; border: none;">
                <h5 class="modal-title" id="modalAbastecimentosCategoriaLabel">
                    <i class="fa-duotone fa-layer-group me-2"></i>
                    Abastecimentos por Categoria
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" style="background: #f8f9fa; padding: 0;">
                <!-- Header com informa√ß√µes da categoria -->
                <div class="categoria-modal-header" style="background: white; padding: 20px; border-bottom: 1px solid #dee2e6;">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <div class="d-flex align-items-center gap-3">
                                <div class="categoria-badge" style="background: #4a7c59; color: white; padding: 10px 20px; border-radius: 8px; font-size: 1.1rem; font-weight: 700;">
                                    <i class="fa-duotone fa-layer-group me-2"></i>
                                    <span id="modalCategoriaNome">---</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8 text-md-end mt-3 mt-md-0">
                            <div class="d-flex justify-content-md-end gap-3 flex-wrap">
                                <div class="text-center px-2">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Per√≠odo</div>
                                    <div style="font-size: 1rem; font-weight: 600; color: #4a7c59;" id="modalCategoriaPeriodo">---</div>
                                </div>
                                <div class="text-center px-2" style="border-left: 1px solid #dee2e6;">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Ve√≠culos</div>
                                    <div style="font-size: 1rem; font-weight: 600; color: #325d88;" id="modalCategoriaTotalVeiculos">0</div>
                                </div>
                                <div class="text-center px-2" style="border-left: 1px solid #dee2e6;">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Abastec.</div>
                                    <div style="font-size: 1rem; font-weight: 600; color: #f59e0b;" id="modalCategoriaTotalAbastecimentos">0</div>
                                </div>
                                <div class="text-center px-2" style="border-left: 1px solid #dee2e6;">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Litros</div>
                                    <div style="font-size: 1rem; font-weight: 600; color: #0ea5e9;" id="modalCategoriaTotalLitros">0</div>
                                </div>
                                <div class="text-center px-2" style="border-left: 1px solid #dee2e6;">
                                    <div style="font-size: 0.7rem; color: #6c757d; text-transform: uppercase;">Valor Total</div>
                                    <div style="font-size: 1rem; font-weight: 700; color: #dc2626;" id="modalCategoriaTotalValor">R$ 0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Abas -->
                <ul class="nav nav-tabs" style="padding: 0 20px; background: white; border-bottom: none;">
                    <li class="nav-item">
                        <button class="nav-link active" id="tabVeiculosCategoria" data-bs-toggle="tab" data-bs-target="#painelVeiculosCategoria" type="button">
                            <i class="fa-duotone fa-cars me-1"></i> Ve√≠culos da Categoria
                            <span class="badge bg-info text-dark ms-1" id="badgeVeiculosCategoria">0</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="tabAbastecimentosCategoria" data-bs-toggle="tab" data-bs-target="#painelAbastecimentosCategoria" type="button">
                            <i class="fa-duotone fa-gas-pump me-1"></i> Todos Abastecimentos
                            <span class="badge bg-warning text-dark ms-1" id="badgeAbastecimentosCategoria">0</span>
                        </button>
                    </li>
                </ul>

                <div class="tab-content" style="padding: 20px;">
                    <!-- Painel Ve√≠culos da Categoria -->
                    <div class="tab-pane fade show active" id="painelVeiculosCategoria">
                        <div class="table-responsive" style="background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); max-height: 400px;">
                            <table class="table table-hover mb-0" id="tabelaVeiculosCategoriaModal">
                                <thead style="background: #e8f5e9; position: sticky; top: 0;">
                                    <tr>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-rectangle-barcode me-1"></i> Placa
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-car me-1"></i> Tipo Ve√≠culo
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-gas-pump me-1"></i> Qtd Abast.
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-droplet me-1"></i> Litros
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-coins me-1"></i> Valor Total
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="corpoTabelaVeiculosCategoria">
                                    <tr>
                                        <td colspan="5" class="text-center py-4">
                                            <i class="fa-duotone fa-spinner-third fa-spin fa-2x text-muted"></i>
                                            <div class="mt-2 text-muted">Carregando...</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Painel Todos Abastecimentos -->
                    <div class="tab-pane fade" id="painelAbastecimentosCategoria">
                        <div class="table-responsive" style="background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); max-height: 400px;">
                            <table class="table table-hover mb-0" id="tabelaAbastecimentosCategoriaModal">
                                <thead style="background: #fff8e1; position: sticky; top: 0;">
                                    <tr>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-calendar me-1"></i> Data
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-rectangle-barcode me-1"></i> Placa
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-car me-1"></i> Ve√≠culo
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; white-space: nowrap;">
                                            <i class="fa-duotone fa-fire-flame me-1"></i> Combust√≠vel
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-droplet me-1"></i> Litros
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-dollar-sign me-1"></i> R$/Litro
                                        </th>
                                        <th style="font-weight: 600; color: #495057; padding: 12px 15px; text-align: right; white-space: nowrap;">
                                            <i class="fa-duotone fa-coins me-1"></i> Total
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="corpoTabelaAbastecimentosCategoria">
                                    <tr>
                                        <td colspan="7" class="text-center py-4">
                                            <i class="fa-duotone fa-spinner-third fa-spin fa-2x text-muted"></i>
                                            <div class="mt-2 text-muted">Carregando...</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="background: white; border-top: 1px solid #dee2e6;">
                <button type="button" class="btn btn-fechar-modal" data-bs-dismiss="modal">
                    <i class="fa-duotone fa-xmark me-1"></i> Fechar
                </button>
            </div>
        </div>
    </div>
</div>

@section ScriptsBlock {
    <!-- Bibliotecas para exporta√ß√£o PDF (usando jsDelivr - mais confi√°vel) -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

    <!-- Syncfusion EJ2 -->
    <script src="https://cdn.syncfusion.com/ej2/23.1.36/ej2-base/dist/global/ej2-base.min.js" asp-append-version="true"></script>
    <script src="https://cdn.syncfusion.com/ej2/23.1.36/ej2-data/dist/global/ej2-data.min.js" asp-append-version="true"></script>
    <script src="https://cdn.syncfusion.com/ej2/23.1.36/ej2-svg-base/dist/global/ej2-svg-base.min.js" asp-append-version="true"></script>
    <script src="https://cdn.syncfusion.com/ej2/23.1.36/ej2-pdf-export/dist/global/ej2-pdf-export.min.js" asp-append-version="true"></script>
    <script src="https://cdn.syncfusion.com/ej2/23.1.36/ej2-file-utils/dist/global/ej2-file-utils.min.js" asp-append-version="true"></script>
    <script src="https://cdn.syncfusion.com/ej2/23.1.36/ej2-compression/dist/global/ej2-compression.min.js" asp-append-version="true"></script>
    <script src="https://cdn.syncfusion.com/ej2/23.1.36/ej2-charts/dist/global/ej2-charts.min.js" asp-append-version="true"></script>
    <script src="https://cdn.syncfusion.com/ej2/23.1.36/ej2-heatmap/dist/global/ej2-heatmap.min.js" asp-append-version="true"></script>
    <script src="~/js/dashboards/dashboard-abastecimento.js" asp-append-version="true"></script>

    <script>
        // ========== EXPORTA√á√ÉO PDF PROFISSIONAL - VISUAL ARROJADO COM √çCONES DUOTONE ==========

        // Cores do tema caramelo
        const PDF_CORES = {
            primary: [168, 120, 76],      // #a8784c
            secondary: [196, 149, 106],   // #c4956a
            accent: [212, 165, 116],      // #d4a574
            dark: [139, 94, 60],          // #8b5e3c
            darker: [109, 71, 44],        // #6d472c
            cream: [245, 235, 224],       // #f5ebe0
            white: [255, 255, 255],
            gray: [100, 100, 100],
            lightGray: [240, 240, 240],
            orange: [255, 107, 53]        // #ff6b35 - cor dos √≠cones duotone
        };

        // =====================================================================
        // √çCONES SVG FONTAWESOME DUOTONE EMBUTIDOS (viewBox 0 0 640 640)
        // =====================================================================
        const PDF_ICONS_DUOTONE = {
            // √çcone: gas-pump (bomba de combust√≠vel) - PRINCIPAL
            gasPump: {
                secondary: 'M96 128L96 529.4C98.5 528.5 101.2 528 104 528L376 528C378.8 528 381.5 528.5 384 529.4L384 128C384 92.7 355.3 64 320 64L160 64C124.7 64 96 92.7 96 128zM160 144C160 135.2 167.2 128 176 128L304 128C312.8 128 320 135.2 320 144L320 240C320 248.8 312.8 256 304 256L176 256C167.2 256 160 248.8 160 240L160 144z',
                primary: 'M480 160L448 128C439.2 119.2 439.2 104.8 448 96C456.8 87.2 471.2 87.2 480 96L557.3 173.3C569.3 185.3 576 201.6 576 218.6L576 440C576 479.8 543.8 512 504 512C464.2 512 432 479.8 432 440L432 408C432 385.9 414.1 368 392 368L384 368L384 320L392 320C440.6 320 480 359.4 480 408L480 440C480 453.3 490.7 464 504 464C517.3 464 528 453.3 528 440L528 286C500.4 278.9 480 253.8 480 224L480 160zM104 528L376 528C389.3 528 400 538.7 400 552C400 565.3 389.3 576 376 576L104 576C90.7 576 80 565.3 80 552C80 538.7 90.7 528 104 528zM176 128L304 128C312.8 128 320 135.2 320 144L320 240C320 248.8 312.8 256 304 256L176 256C167.2 256 160 248.8 160 240L160 144C160 135.2 167.2 128 176 128z'
            },
            // √çcone: chart-line (gr√°fico de linha) - PARA GR√ÅFICOS
            chartLine: {
                secondary: 'M64 128L64 464C64 508.2 99.8 544 144 544L544 544C561.7 544 576 529.7 576 512C576 494.3 561.7 480 544 480L144 480C135.2 480 128 472.8 128 464L128 128C128 110.3 113.7 96 96 96C78.3 96 64 110.3 64 128z',
                primary: 'M534.6 169.4C547.1 181.9 547.1 202.2 534.6 214.7L406.6 342.7C394.1 355.2 373.8 355.2 361.3 342.7L303.9 285.3L230.5 358.7C218 371.2 197.7 371.2 185.2 358.7C172.7 346.2 172.7 325.9 185.2 313.4L281.2 217.4C293.7 204.9 314 204.9 326.5 217.4L384 274.7L489.4 169.4C501.9 156.9 522.2 156.9 534.7 169.4z'
            },
            // √çcone: droplet (gota) - PARA COMBUST√çVEL
            droplet: {
                secondary: 'M128 384C128 292.8 258.2 109.9 294.6 60.5C300.5 52.5 309.8 48 319.8 48L320.2 48C330.2 48 339.5 52.5 345.4 60.5C381.8 109.9 512 292.8 512 384C512 490 426 576 320 576C214 576 128 490 128 384zM192 376C192 451.1 252.9 512 328 512C341.3 512 352 501.3 352 488C352 474.7 341.3 464 328 464C279.4 464 240 424.6 240 376C240 362.7 229.3 352 216 352C202.7 352 192 362.7 192 376z',
                primary: 'M216 352C229.3 352 240 362.7 240 376C240 424.6 279.4 464 328 464C341.3 464 352 474.7 352 488C352 501.3 341.3 512 328 512C252.9 512 192 451.1 192 376C192 362.7 202.7 352 216 352z'
            },
            // √çcone: gauge-high (veloc√≠metro) - PARA CONSUMO
            gaugeHigh: {
                secondary: 'M64 320C64 461.4 178.6 576 320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64C178.6 64 64 178.6 64 320zM192 320C192 337.7 177.7 352 160 352C142.3 352 128 337.7 128 320C128 302.3 142.3 288 160 288C177.7 288 192 302.3 192 320zM240 208C240 225.7 225.7 240 208 240C190.3 240 176 225.7 176 208C176 190.3 190.3 176 208 176C225.7 176 240 190.3 240 208zM256 416C256 380.7 284.7 352 320 352C321.7 352 323.4 352.1 325.1 352.2L394.6 213.3C400.5 201.4 414.9 196.6 426.8 202.6C438.7 208.6 443.5 222.9 437.5 234.8L368 373.7C378 385 384 399.8 384 416C384 451.3 355.3 480 320 480C284.7 480 256 451.3 256 416zM352 160C352 177.7 337.7 192 320 192C302.3 192 288 177.7 288 160C288 142.3 302.3 128 320 128C337.7 128 352 142.3 352 160zM512 320C512 337.7 497.7 352 480 352C462.3 352 448 337.7 448 320C448 302.3 462.3 288 480 288C497.7 288 512 302.3 512 320z',
                primary: 'M394.5 213.3C400.4 201.4 414.8 196.6 426.7 202.6C438.6 208.6 443.4 222.9 437.4 234.8L368 373.7C378 385 384 399.8 384 416C384 451.3 355.3 480 320 480C284.7 480 256 451.3 256 416C256 380.7 284.7 352 320 352C321.7 352 323.4 352.1 325.1 352.2L394.6 213.3z'
            },
            // √çcone: money-bill-trend-up (dinheiro com tend√™ncia) - PARA VALORES
            moneyBillTrendUp: {
                secondary: 'M64 368L64 528C64 554.5 85.5 576 112 576L528 576C554.5 576 576 554.5 576 528L576 368C576 341.5 554.5 320 528 320L112 320C85.5 320 64 341.5 64 368zM112 368L160 368C160 394.5 138.5 416 112 416L112 368zM112 480C138.5 480 160 501.5 160 528L112 528L112 480zM384 448C384 483.3 355.3 512 320 512C284.7 512 256 483.3 256 448C256 412.7 284.7 384 320 384C355.3 384 384 412.7 384 448zM480 368L528 368L528 416C501.5 416 480 394.5 480 368zM480 528C480 501.5 501.5 480 528 480L528 528L480 528z',
                primary: 'M520 48C533.3 48 544 58.7 544 72L544 173.8C544 187.1 533.3 197.8 520 197.8C506.7 197.8 496 187.1 496 173.8L496 129.9L369 256.9C360.1 265.8 345.9 266.3 336.4 258.2L240 175.6L143.6 258.2C133.5 266.8 118.4 265.7 109.8 255.6C101.2 245.5 102.3 230.4 112.4 221.8L224.4 125.8C233.4 118.1 246.6 118.1 255.6 125.8L350.7 207.3L462 96L418.1 96C404.8 96 394.1 85.3 394.1 72C394.1 58.7 404.8 48 418.1 48L520 48z'
            },
            // √çcone: truck (caminh√£o) - PARA VE√çCULOS
            truck: {
                secondary: 'M96 488C96 536.6 135.3 576 184 576.1C232.6 576.1 272 536.7 272 488.1C272 439.5 232.7 400.1 184.1 400.1C135.4 400 96 439.4 96 488zM224 488C224 510.1 206.1 528 184 528C161.9 528 144 510.1 144 488C144 465.9 161.9 448 184 448C206.1 448 224 465.9 224 488zM368 488C368 536.6 407.3 576 456 576.1C504.6 576.1 544 536.7 544 488.1C544 439.5 504.7 400.1 456.1 400.1C407.4 400 368 439.4 368 488zM496 488C496 510.1 478.1 528 456 528C433.9 528 416 510.1 416 488C416 465.9 433.9 448 456 448C478.1 448 496 465.9 496 488z',
                primary: 'M32 160C32 124.7 60.7 96 96 96L384 96C419.3 96 448 124.7 448 160L448 192L498.7 192C515.7 192 532 198.7 544 210.7L589.3 256C601.3 268 608 284.3 608 301.3L608 448C608 483.3 579.3 512 544 512L540.7 512C542.9 504.4 544 496.3 544 488C544 439.4 504.6 400 456 400C407.4 400 368 439.4 368 488C368 496.3 369.2 504.4 371.3 512L268.7 512C270.9 504.4 272 496.3 272 488C272 439.4 232.6 400 184 400C135.4 400 96 439.4 96 488C96 496.3 97.2 504.4 99.3 512L96 512C60.7 512 32 483.3 32 448L32 160zM544 352L544 301.3L498.7 256L448 256L448 352L544 352z'
            },
            // √çcone: coins (moedas) - PARA RESUMO
            coins: {
                secondary: 'M192 144C192 99.8 278 64 384 64C490 64 576 99.8 576 144L576 160C576 190.6 534.7 217.2 474 230.7C471.6 227.9 469.1 225.2 466.6 222.7C451.1 207.4 431.1 195.8 410.2 187.2C368.3 169.7 313.7 160.1 256 160.1C234.1 160.1 212.7 161.5 192.2 164.2C192 162.9 192 161.5 192 160.1L192 144.1zM495 275C510.5 271.1 525 266.4 538.2 260.8C551.4 255.2 564.3 248.6 576 240.5L576 255.9C576 282.7 544.5 306.4 496 320.9L496 287.9C496 283.4 495.6 279.1 495 274.9zM496 370.7C511.1 366.8 525.3 362.2 538.2 356.8C551.4 351.3 564.3 344.6 576 336.5L576 351.9C576 378.7 544.5 402.4 496 416.9L496 370.7z',
                primary: 'M64 288L64 304C64 348.2 150 384 256 384C362 384 448 348.2 448 304L448 288C448 243.8 362 208 256 208C150 208 64 243.8 64 288zM448 384.6C436.4 392.7 423.5 399.3 410.2 404.9C368.3 422.4 313.7 432 256 432C198.3 432 143.7 422.3 101.8 404.9C88.5 399.4 75.6 392.7 64 384.6L64 400C64 444.2 150 480 256 480C362 480 448 444.2 448 400L448 384.6zM448 496L448 480.6C436.4 488.7 423.5 495.3 410.2 500.9C368.3 518.4 313.7 528 256 528C198.3 528 143.7 518.3 101.8 500.9C88.5 495.4 75.6 488.7 64 480.6L64 496C64 540.2 150 576 256 576C362 576 448 540.2 448 496z'
            },
            // √çcone: fire-flame (chama) - PARA MAPA DE CALOR
            fireFlame: {
                secondary: 'M128 385.6C128 490.7 214.8 576 320 576C425.2 576 512 490.7 512 385.6C512 363.4 508.1 341.4 500.5 320.5L499.8 318.6C465.8 224.8 410 140.5 337.1 72.5L333.8 69.5C330.1 66 325.1 64 320 64C314.9 64 309.9 66 306.2 69.5L302.9 72.5C230 140.5 174.2 224.8 140.2 318.6L139.5 320.5C131.9 341.3 128 363.4 128 385.6zM208 375.9C208 354.7 215.8 334.3 229.8 318.5L236.7 310.7C238.8 308.3 241.8 307 245 307C251.1 307 256 311.9 256 318L256 362C256 386.3 275.8 406 300.1 406C324.3 406 344 386.4 344 362.2C344 350.6 339.4 339.4 331.2 331.2L318 318C304 304 296.1 284.9 296.1 265C296.1 248.8 301.4 233 311.1 220.1L316.9 212.3C318.9 209.6 322.1 208 325.4 208C331.3 208 336.1 212.8 336.1 218.7L336.1 230.1C336.1 239 339.7 247.5 346 253.7L397.5 304.4C419.6 326.2 432.1 355.9 432.1 386.9C432.1 447.1 383.3 495.9 323.1 495.9L320.1 495.9C258.2 495.9 208.1 445.8 208.1 383.9L208.1 375.7z',
                primary: 'M311 220L316.8 212.2C318.8 209.5 322 207.9 325.3 207.9C331.2 207.9 336 212.7 336 218.6L336 230C336 238.9 339.6 247.4 345.9 253.6L397.4 304.3C419.5 326.1 432 355.8 432 386.8C432 447 383.2 495.8 323 495.8L320 495.8C258.1 495.8 208 445.7 208 383.8L208 375.6C208 354.4 215.8 334 229.8 318.2L236.7 310.4C238.8 308 241.8 306.7 245 306.7C251.1 306.7 256 311.6 256 317.7L256 361.7C256 386 275.8 405.7 300.1 405.7C324.3 405.7 344 386.1 344 361.9C344 350.3 339.4 339.1 331.2 330.9L318 317.7C304 303.7 296.1 284.6 296.1 264.7C296.1 248.5 301.4 232.7 311.1 219.8z'
            },
            // √çcone: calendar-check (calend√°rio) - PARA DATAS
            calendarCheck: {
                secondary: 'M96 224L544 224L544 496C544 522.5 522.5 544 496 544L144 544C117.5 544 96 522.5 96 496L96 224zM215.1 391.1C205.7 400.5 205.7 415.7 215.1 425L271 481C276 486 282.9 488.5 289.8 487.9C296.7 487.3 303.2 483.8 307.3 478.1L429.5 310.2C437.3 299.5 434.9 284.5 424.2 276.7C413.5 268.9 398.5 271.3 390.7 282L285.1 427.2L249.1 391.2C239.7 381.8 224.5 381.8 215.2 391.2z',
                primary: 'M390.7 281.9C398.5 271.2 413.5 268.8 424.2 276.6C434.9 284.4 437.3 299.4 429.5 310.1L307.4 478.1C303.3 483.8 296.9 487.4 289.9 487.9C282.9 488.4 276 485.9 271.1 481L215.2 425.1C205.8 415.7 205.8 400.5 215.2 391.2C224.6 381.9 239.8 381.8 249.1 391.2L285.1 427.2L390.7 282zM416 64C433.7 64 448 78.3 448 96L448 128L496 128C522.5 128 544 149.5 544 176L544 224L96 224L96 176C96 149.5 117.5 128 144 128L192 128L192 96C192 78.3 206.3 64 224 64C241.7 64 256 78.3 256 96L256 128L384 128L384 96C384 78.3 398.3 64 416 64z'
            },
            // √çcone: file-pdf (arquivo PDF) - PARA RODAP√â
            filePdf: {
                secondary: 'M64 128C64 92.7 92.7 64 128 64L277.5 64C294.5 64 310.8 70.7 322.8 82.7L429.3 189.3C441.3 201.3 448 217.6 448 234.6L448 400.1L272 400.1C236.7 400.1 208 428.8 208 464.1L208 576.1L128 576.1C92.7 576.1 64 547.4 64 512.1L64 128zM272 122.5L272 216C272 229.3 282.7 240 296 240L389.5 240L272 122.5z',
                primary: 'M252 464C252 453 261 444 272 444L304 444C337.1 444 364 470.9 364 504C364 537.1 337.1 564 304 564L292 564L292 592C292 603 283 612 272 612C261 612 252 603 252 592L252 464zM292 524L304 524C315 524 324 515 324 504C324 493 315 484 304 484L292 484L292 524zM380 464C380 453 389 444 400 444L432 444C460.7 444 484 467.3 484 496L484 560C484 588.7 460.7 612 432 612L400 612C389 612 380 603 380 592L380 464zM420 484L420 572L432 572C438.6 572 444 566.6 444 560L444 496C444 489.4 438.6 484 432 484L420 484zM528 444L576 444C587 444 596 453 596 464C596 475 587 484 576 484L548 484L548 508L576 508C587 508 596 517 596 528C596 539 587 548 576 548L548 548L548 592C548 603 539 612 528 612C517 612 508 603 508 592L508 464C508 453 517 444 528 444z'
            }
        };

        // =====================================================================
        // FUN√á√ÉO PARA RENDERIZAR √çCONE DUOTONE EM CANVAS E INSERIR NO PDF
        // =====================================================================
        async function renderizarIconeDuotone(icon, tamanho, corPrimaria, corSecundaria) {
            return new Promise((resolve) => {
                try {
                    const canvas = document.createElement('canvas');
                    const scale = 4; // Alta resolu√ß√£o
                    canvas.width = 640 * scale / 10;
                    canvas.height = 640 * scale / 10;
                    const ctx = canvas.getContext('2d');
                    ctx.scale(scale / 10, scale / 10);

                    // Desenhar camada secund√°ria (com opacidade)
                    ctx.globalAlpha = 0.4;
                    ctx.fillStyle = `rgb(${corSecundaria[0]}, ${corSecundaria[1]}, ${corSecundaria[2]})`;
                    const pathSecondary = new Path2D(icon.secondary);
                    ctx.fill(pathSecondary);

                    // Desenhar camada prim√°ria
                    ctx.globalAlpha = 1.0;
                    ctx.fillStyle = `rgb(${corPrimaria[0]}, ${corPrimaria[1]}, ${corPrimaria[2]})`;
                    const pathPrimary = new Path2D(icon.primary);
                    ctx.fill(pathPrimary);

                    resolve(canvas.toDataURL('image/png'));
                } catch (e) {
                    console.warn('Erro ao renderizar √≠cone:', e);
                    resolve(null);
                }
            });
        }

        // =====================================================================
        // FUN√á√ÉO PRINCIPAL DE EXPORTA√á√ÉO PDF PROFISSIONAL
        // =====================================================================
        async function exportarGraficoPdf(elementId, titulo, forcarOrientacao = null) {
            try {
                AppToast.show('orange', 'Gerando PDF profissional com √≠cones Duotone...', 5000);

                const elemento = document.getElementById(elementId);
                if (!elemento) {
                    throw new Error('Elemento n√£o encontrado: ' + elementId);
                }

                // Para tabelas (Resumo por Ano, Top 15), capturar o container pai
                let elementoCaptura = elemento;
                if (elementId === 'tabelaResumoPorAno' || elementId.includes('tabela') || elementId.includes('Tabela')) {
                    elementoCaptura = elemento.closest('.ftx-grid-tabela') || elemento;
                }

                // ============ EXPANS√ÉO TEMPOR√ÅRIA PARA CAPTURAR TODO O CONTE√öDO ============
                // Salvar estado original do elemento e seus containers com scroll
                const elementosExpandidos = [];

                // Fun√ß√£o para expandir um elemento e seus pais que tenham scroll
                function expandirElemento(el) {
                    if (!el || el === document.body || el === document.documentElement) return;

                    const computedStyle = window.getComputedStyle(el);
                    const hasScroll = computedStyle.overflow === 'auto' ||
                                      computedStyle.overflow === 'scroll' ||
                                      computedStyle.overflowY === 'auto' ||
                                      computedStyle.overflowY === 'scroll' ||
                                      el.scrollHeight > el.clientHeight;

                    if (hasScroll || el.style.maxHeight || el.style.height) {
                        elementosExpandidos.push({
                            element: el,
                            maxHeight: el.style.maxHeight,
                            height: el.style.height,
                            overflow: el.style.overflow,
                            overflowY: el.style.overflowY
                        });

                        // Expandir para mostrar todo o conte√∫do
                        el.style.maxHeight = 'none';
                        el.style.height = 'auto';
                        el.style.overflow = 'visible';
                        el.style.overflowY = 'visible';
                    }

                    // Verificar tamb√©m o pai
                    expandirElemento(el.parentElement);
                }

                // Expandir o elemento de captura e seus containers
                expandirElemento(elementoCaptura);

                // Procurar e expandir elementos internos com scroll (.grid-body, etc.)
                const gridBody = elementoCaptura.querySelector('.grid-body, [class*="scroll"], [style*="overflow"]');
                if (gridBody) {
                    expandirElemento(gridBody);
                }

                // Aguardar rec√°lculo do layout do navegador
                await new Promise(r => setTimeout(r, 150));

                // Usar html2canvas para capturar TODO o conte√∫do expandido
                const canvas = await html2canvas(elementoCaptura, {
                    scale: 2.5,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    logging: false,
                    height: elementoCaptura.scrollHeight,  // Capturar altura total
                    windowHeight: elementoCaptura.scrollHeight + 200
                });

                // ============ RESTAURAR ESTADO ORIGINAL ============
                elementosExpandidos.forEach(item => {
                    item.element.style.maxHeight = item.maxHeight;
                    item.element.style.height = item.height;
                    item.element.style.overflow = item.overflow;
                    item.element.style.overflowY = item.overflowY;
                });

                // Pr√©-renderizar √≠cones duotone - √çCONE PRINCIPAL com ALTO CONTRASTE (branco puro)
                const iconGasPumpGrande = await renderizarIconeDuotone(PDF_ICONS_DUOTONE.gasPump, 24, [255, 255, 255], [220, 200, 180]);

                // √çcones decorativos da barra - 50% maiores e com cores do tema
                const iconDroplet = await renderizarIconeDuotone(PDF_ICONS_DUOTONE.droplet, 14, PDF_CORES.dark, PDF_CORES.secondary);
                const iconGauge = await renderizarIconeDuotone(PDF_ICONS_DUOTONE.gaugeHigh, 14, PDF_CORES.dark, PDF_CORES.secondary);
                const iconMoney = await renderizarIconeDuotone(PDF_ICONS_DUOTONE.moneyBillTrendUp, 14, PDF_CORES.dark, PDF_CORES.secondary);
                const iconTruck = await renderizarIconeDuotone(PDF_ICONS_DUOTONE.truck, 14, PDF_CORES.dark, PDF_CORES.secondary);
                const iconFire = await renderizarIconeDuotone(PDF_ICONS_DUOTONE.fireFlame, 14, PDF_CORES.dark, PDF_CORES.secondary);
                const iconChart = await renderizarIconeDuotone(PDF_ICONS_DUOTONE.chartLine, 14, PDF_CORES.dark, PDF_CORES.secondary);

                // √çcone de calend√°rio para o badge
                const iconCalendar = await renderizarIconeDuotone(PDF_ICONS_DUOTONE.calendarCheck, 12, PDF_CORES.white, PDF_CORES.cream);
                const iconPdf = await renderizarIconeDuotone(PDF_ICONS_DUOTONE.filePdf, 12, PDF_CORES.darker, PDF_CORES.secondary);

                // Criar PDF com jsPDF
                const { jsPDF } = window.jspdf;
                const imgWidth = canvas.width;
                const imgHeight = canvas.height;

                // Determinar orienta√ß√£o: for√ßada ou autom√°tica
                let orientacao;
                if (forcarOrientacao === 'portrait' || forcarOrientacao === 'landscape') {
                    orientacao = forcarOrientacao;
                } else {
                    // Autom√°tico: landscape se imagem for muito larga
                    orientacao = (imgWidth > imgHeight * 1.2) ? 'landscape' : 'portrait';
                }

                const pdf = new jsPDF({
                    orientation: orientacao,
                    unit: 'mm',
                    format: 'a4'
                });

                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const margin = 10;

                // ============ FUN√á√ÉO PARA RENDERIZAR TEXTO COM FONTE OUTFIT ============
                async function renderizarTextoOutfit(texto, tamanhoFonte, cor, negrito = true) {
                    return new Promise((resolve) => {
                        const tempCanvas = document.createElement('canvas');
                        const ctx = tempCanvas.getContext('2d');
                        const scale = 4;

                        // Configurar fonte Outfit (dispon√≠vel na p√°gina)
                        const fontWeight = negrito ? '800' : '600';
                        ctx.font = `${fontWeight} ${tamanhoFonte * scale}px 'Outfit', sans-serif`;

                        // Medir texto
                        const metrics = ctx.measureText(texto);
                        const width = metrics.width + 20;
                        const height = tamanhoFonte * scale * 1.5;

                        tempCanvas.width = width;
                        tempCanvas.height = height;

                        // Redesenhar com dimens√µes corretas
                        ctx.font = `${fontWeight} ${tamanhoFonte * scale}px 'Outfit', sans-serif`;
                        ctx.fillStyle = `rgb(${cor[0]}, ${cor[1]}, ${cor[2]})`;
                        ctx.textBaseline = 'middle';
                        ctx.fillText(texto, 0, height / 2);

                        resolve({
                            dataUrl: tempCanvas.toDataURL('image/png'),
                            width: width / scale,
                            height: height / scale
                        });
                    });
                }

                // Pr√©-renderizar t√≠tulos com fonte Outfit
                // Portrait: t√≠tulo menor para n√£o sobrepor badge | Landscape: t√≠tulo original maior
                const tamanhoTitulo = orientacao === 'portrait' ? 18 : 24;
                const tamanhoSubtitulo = orientacao === 'portrait' ? 11 : 13;
                const tituloImg = await renderizarTextoOutfit('Dashboard de Abastecimentos', tamanhoTitulo, [255, 255, 255], true);
                const subtituloImg = await renderizarTextoOutfit(titulo, tamanhoSubtitulo, [245, 235, 224], true);

                // ============ FUNDO DECORATIVO ============
                // Fundo creme suave
                pdf.setFillColor(...PDF_CORES.cream);
                pdf.rect(0, 0, pageWidth, pageHeight, 'F');

                // Padr√£o de c√≠rculos decorativos no fundo
                pdf.setFillColor(PDF_CORES.accent[0], PDF_CORES.accent[1], PDF_CORES.accent[2]);
                pdf.setGState(new pdf.GState({ opacity: 0.05 }));
                pdf.circle(pageWidth - 15, 25, 40, 'F');
                pdf.circle(20, pageHeight - 20, 30, 'F');
                pdf.circle(pageWidth / 2, pageHeight, 60, 'F');
                pdf.setGState(new pdf.GState({ opacity: 1 }));

                // ============ HEADER PRINCIPAL - COR √öNICA COM BORDAS ARREDONDADAS ============
                const headerHeight = 42;

                // Header com cor √∫nica (primary) e bordas arredondadas em AMBOS os lados
                pdf.setFillColor(...PDF_CORES.primary);
                pdf.roundedRect(margin, margin, pageWidth - (margin * 2), headerHeight, 5, 5, 'F');

                // Brilho decorativo removido - causava barra branca indesejada no header

                // √çcone de bomba de combust√≠vel BEM MAIOR (FontAwesome Duotone)
                if (iconGasPumpGrande) {
                    pdf.addImage(iconGasPumpGrande, 'PNG', margin + 6, margin + 9, 18, 18);
                }

                // T√≠tulo principal com fonte OUTFIT (renderizado como imagem)
                // Sombra do t√≠tulo
                pdf.setGState(new pdf.GState({ opacity: 0.15 }));
                if (tituloImg.dataUrl) {
                    pdf.addImage(tituloImg.dataUrl, 'PNG', margin + 28, margin + 6, tituloImg.width * 0.35, tituloImg.height * 0.35);
                }
                pdf.setGState(new pdf.GState({ opacity: 1 }));
                // T√≠tulo principal
                if (tituloImg.dataUrl) {
                    pdf.addImage(tituloImg.dataUrl, 'PNG', margin + 27, margin + 5, tituloImg.width * 0.35, tituloImg.height * 0.35);
                }

                // Subt√≠tulo com fonte OUTFIT (renderizado como imagem)
                if (subtituloImg.dataUrl) {
                    pdf.addImage(subtituloImg.dataUrl, 'PNG', margin + 27, margin + 22, subtituloImg.width * 0.35, subtituloImg.height * 0.35);
                }

                // Badge da data no canto direito (estilo premium) - AJUSTADO
                const dataGeracao = new Date();
                const dataFormatada = dataGeracao.toLocaleDateString('pt-BR', {
                    day: '2-digit', month: 'short', year: 'numeric'
                });
                const horaFormatada = dataGeracao.toLocaleTimeString('pt-BR', {
                    hour: '2-digit', minute: '2-digit'
                });

                // Fundo do badge - mais alto para acomodar conte√∫do
                const badgeWidth = 52;
                const badgeHeight = 32;
                const badgeX = pageWidth - margin - badgeWidth - 3;
                const badgeY = margin + 5;
                pdf.setFillColor(0, 0, 0);
                pdf.setGState(new pdf.GState({ opacity: 0.35 }));
                pdf.roundedRect(badgeX, badgeY, badgeWidth, badgeHeight, 4, 4, 'F');
                pdf.setGState(new pdf.GState({ opacity: 1 }));

                // Textos do badge - SEM √≠cone sobreposto, fonte mais grossa
                pdf.setTextColor(...PDF_CORES.cream);
                pdf.setFontSize(7);
                pdf.setFont('helvetica', 'bold');
                pdf.text('GERADO EM', badgeX + badgeWidth/2, badgeY + 8, { align: 'center' });

                pdf.setTextColor(...PDF_CORES.white);
                pdf.setFontSize(11);
                pdf.setFont('helvetica', 'bold');
                pdf.text(dataFormatada, badgeX + badgeWidth/2, badgeY + 18, { align: 'center' });

                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'bold');
                pdf.text(horaFormatada, badgeX + badgeWidth/2, badgeY + 27, { align: 'center' });

                // ============ BARRA DE INFORMA√á√ïES - √çCONES 50% MAIORES ============
                const infoBarY = margin + headerHeight + 4;
                const infoBarHeight = 12; // Mais alta para √≠cones maiores

                // Fundo da barra de info - cor creme para manter paleta do dashboard
                pdf.setFillColor(...PDF_CORES.cream);
                pdf.roundedRect(margin, infoBarY, pageWidth - (margin * 2), infoBarHeight, 3, 3, 'F');

                // √çcones decorativos na barra - 50% MAIORES (7.5mm ao inv√©s de 5mm)
                const iconsBar = [iconDroplet, iconGauge, iconMoney, iconTruck, iconFire];
                const iconSize = 7.5; // 50% maior que 5mm
                const iconSpacing = (pageWidth - (margin * 2) - 20) / (iconsBar.length + 1);
                iconsBar.forEach((icon, index) => {
                    if (icon) {
                        pdf.addImage(icon, 'PNG', margin + 10 + (iconSpacing * (index + 1)) - (iconSize/2), infoBarY + (infoBarHeight - iconSize)/2, iconSize, iconSize);
                    }
                });

                // ============ √ÅREA DO GR√ÅFICO ============
                const chartAreaY = infoBarY + infoBarHeight + 5;
                const chartAreaHeight = pageHeight - chartAreaY - 24;

                // Sombra do card
                pdf.setFillColor(150, 150, 150);
                pdf.setGState(new pdf.GState({ opacity: 0.15 }));
                pdf.roundedRect(margin + 3, chartAreaY + 3, pageWidth - (margin * 2), chartAreaHeight, 6, 6, 'F');
                pdf.setGState(new pdf.GState({ opacity: 1 }));

                // Card branco principal
                pdf.setFillColor(...PDF_CORES.white);
                pdf.roundedRect(margin, chartAreaY, pageWidth - (margin * 2), chartAreaHeight, 6, 6, 'F');

                // Borda elegante do card
                pdf.setDrawColor(...PDF_CORES.primary);
                pdf.setLineWidth(0.5);
                pdf.roundedRect(margin, chartAreaY, pageWidth - (margin * 2), chartAreaHeight, 6, 6, 'S');

                // Detalhe decorativo removido - causava ret√¢ngulo marrom indesejado

                // Calcular dimens√µes da imagem
                const disponWidth = pageWidth - (margin * 2) - 12;
                const disponHeight = chartAreaHeight - 10;

                let finalWidth = disponWidth;
                let finalHeight = (imgHeight * disponWidth) / imgWidth;

                if (finalHeight > disponHeight) {
                    finalHeight = disponHeight;
                    finalWidth = (imgWidth * disponHeight) / imgHeight;
                }

                // Centralizar imagem
                const xOffset = margin + ((pageWidth - (margin * 2) - finalWidth) / 2);
                const yOffset = chartAreaY + ((chartAreaHeight - finalHeight) / 2);

                // Adicionar imagem do gr√°fico
                const imgData = canvas.toDataURL('image/png', 1.0);
                pdf.addImage(imgData, 'PNG', xOffset, yOffset, finalWidth, finalHeight);

                // ============ RODAP√â PROFISSIONAL ============
                const footerY = pageHeight - 18;

                // Linha decorativa dupla
                pdf.setDrawColor(...PDF_CORES.primary);
                pdf.setLineWidth(1);
                pdf.line(margin, footerY - 4, pageWidth - margin, footerY - 4);

                pdf.setDrawColor(...PDF_CORES.secondary);
                pdf.setLineWidth(0.3);
                pdf.line(margin + 40, footerY - 2, pageWidth - margin - 40, footerY - 2);

                // Logo FrotiX com √≠cone
                if (iconPdf) {
                    pdf.addImage(iconPdf, 'PNG', margin, footerY + 1, 5, 5);
                }

                pdf.setTextColor(...PDF_CORES.darker);
                pdf.setFontSize(14);
                pdf.setFont('helvetica', 'bold');
                pdf.text('FrotiX', margin + 7, footerY + 6);

                // Separador decorativo
                pdf.setFillColor(...PDF_CORES.primary);
                pdf.circle(margin + 27, footerY + 4, 1, 'F');

                // Subtexto
                pdf.setTextColor(...PDF_CORES.gray);
                pdf.setFontSize(8);
                pdf.setFont('helvetica', 'normal');
                pdf.text('Sistema de Gest√£o de Frotas', margin + 30, footerY + 5);

                // Informa√ß√µes √† direita - TEXTOS ATUALIZADOS
                pdf.setFontSize(7);
                const footerRight = pageWidth - margin;
                pdf.text('C√¢mara dos Deputados / Coordena√ß√£o de Transportes', footerRight, footerY + 2, { align: 'right' });
                pdf.setTextColor(...PDF_CORES.primary);
                pdf.setFont('helvetica', 'bold');
                pdf.text('www.frotix.camara.leg.br', footerRight, footerY + 7, { align: 'right' });

                // ============ MARCA D'√ÅGUA SUTIL ============
                pdf.setTextColor(220, 220, 220);
                pdf.setFontSize(50);
                pdf.setFont('helvetica', 'bold');
                pdf.setGState(new pdf.GState({ opacity: 0.03 }));
                pdf.text('FrotiX', pageWidth / 2, pageHeight / 2, { align: 'center', angle: 30 });
                pdf.setGState(new pdf.GState({ opacity: 1 }));

                // ============ SALVAR PDF ============
                const nomeArquivo = 'FrotiX_Abastecimento_' +
                                   titulo.replace(/[^a-zA-Z0-9√°√©√≠√≥√∫√£√µ√¢√™√Æ√¥√ª√†√®√¨√≤√π√ß√Å√â√ç√ì√ö√É√ï√Ç√ä√é√î√õ√Ä√à√å√í√ô√á ]/g, '').replace(/ /g, '_') + '_' +
                                   dataGeracao.toISOString().slice(0,10) + '.pdf';
                pdf.save(nomeArquivo);

                AppToast.show('green', 'PDF profissional gerado com sucesso!', 4000);

            } catch (error) {
                console.error('Erro ao exportar PDF:', error);
                Alerta.TratamentoErroComLinha('DashboardAbastecimento.cshtml', 'exportarGraficoPdf', error);
            }
        }
    </script>
}
