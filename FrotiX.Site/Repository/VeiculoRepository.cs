/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘ ğŸš€ ARQUIVO: VeiculoRepository.cs                                                                   â•‘
   â•‘ ğŸ“‚ CAMINHO: Repository/                                                                            â•‘
   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
   â•‘ ğŸ¯ OBJETIVO DO ARQUIVO:                                                                            â•‘
   â•‘    RepositÃ³rio para veÃ­culos, com suporte a listagens simples e completas.                         â•‘
   â•‘    Utiliza ViewVeiculos para dados enriquecidos e atualizaÃ§Ã£o direta sem re-busca.                 â•‘
   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
   â•‘ ğŸ“‹ MÃ‰TODOS DISPONÃVEIS:                                                                            â•‘
   â•‘    â€¢ VeiculoRepository(FrotiXDbContext db)                                                          â•‘
   â•‘    â€¢ GetVeiculoListForDropDown()                                                                   â•‘
   â•‘    â€¢ GetVeiculoCompletoListForDropDown()                                                           â•‘
   â•‘    â€¢ Update(Veiculo veiculo)                                                                       â•‘
   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
   â•‘ âš ï¸ OBSERVAÃ‡Ã•ES:                                                                                     â•‘
   â•‘    A listagem completa usa ViewVeiculos e filtra Status == true.                                   â•‘
   â•‘    A atualizaÃ§Ã£o evita re-busca para reduzir conflitos de tracking no EF Core.                     â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using FrotiX.Data;
using FrotiX.Models;
using FrotiX.Repository.IRepository;
using Microsoft.AspNetCore.Mvc.Rendering;

namespace FrotiX.Repository
    {
    /// <summary>
    /// â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
    /// â”‚ ğŸ¯ CLASSE: VeiculoRepository                                                                  â”‚
    /// â”‚ ğŸ“¦ HERDA DE: Repository<Veiculo>                                                              â”‚
    /// â”‚ ğŸ”Œ IMPLEMENTA: IVeiculoRepository                                                             â”‚
    /// â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
    ///
    /// RepositÃ³rio responsÃ¡vel pelas operaÃ§Ãµes de veÃ­culos.
    /// Disponibiliza listagens simples e completas para UI.
    /// </summary>
    public class VeiculoRepository : Repository<Veiculo>, IVeiculoRepository
        {
        private new readonly FrotiXDbContext _db;

        /// <summary>
        /// â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
        /// â”‚ âš¡ MÃ‰TODO: VeiculoRepository                                                            â”‚
        /// â”‚ ğŸ”— RASTREABILIDADE:                                                                      â”‚
        /// â”‚    â¬…ï¸ CHAMADO POR : UnitOfWork, Services, Controllers                                     â”‚
        /// â”‚    â¡ï¸ CHAMA       : base(db)                                                             â”‚
        /// â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
        ///
        /// <para>
        /// ğŸ¯ <b>OBJETIVO:</b><br/>
        ///    Inicializar o repositÃ³rio com o contexto do banco de dados.
        /// </para>
        ///
        /// <para>
        /// ğŸ“¥ <b>PARÃ‚METROS:</b><br/>
        ///    db - Contexto do banco de dados da aplicaÃ§Ã£o.
        /// </para>
        /// </summary>
        /// <param name="db">InstÃ¢ncia de <see cref="FrotiXDbContext"/>.</param>
        public VeiculoRepository(FrotiXDbContext db) : base(db)
            {
            _db = db;
            }

        /// <summary>
        /// â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
        /// â”‚ âš¡ MÃ‰TODO: GetVeiculoListForDropDown                                                    â”‚
        /// â”‚ ğŸ”— RASTREABILIDADE:                                                                      â”‚
        /// â”‚    â¬…ï¸ CHAMADO POR : Controllers, Services, UI (DropDowns)                                â”‚
        /// â”‚    â¡ï¸ CHAMA       : DbContext.Veiculo, OrderBy, Select                                   â”‚
        /// â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
        ///
        /// <para>
        /// ğŸ¯ <b>OBJETIVO:</b><br/>
        ///    Obter lista simples de veÃ­culos para composiÃ§Ã£o de dropdowns.
        ///    Ordena os registros pela placa.
        /// </para>
        ///
        /// <para>
        /// ğŸ“¤ <b>RETORNO:</b><br/>
        ///    IEnumerable&lt;SelectListItem&gt; - Itens prontos para seleÃ§Ã£o em UI.
        /// </para>
        /// </summary>
        /// <returns>Lista de itens de seleÃ§Ã£o com placas.</returns>
        public IEnumerable<SelectListItem> GetVeiculoListForDropDown()
            {
            return _db.Veiculo
            .OrderBy(o => o.Placa)
            .Select(i => new SelectListItem()
                {
                Text = i.Placa,
                Value = i.VeiculoId.ToString()
                }); ;
            }

        /// <summary>
        /// â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
        /// â”‚ âš¡ MÃ‰TODO: GetVeiculoCompletoListForDropDown                                             â”‚
        /// â”‚ ğŸ”— RASTREABILIDADE:                                                                      â”‚
        /// â”‚    â¬…ï¸ CHAMADO POR : Controllers, Services, UI (DropDowns)                                â”‚
        /// â”‚    â¡ï¸ CHAMA       : DbContext.ViewVeiculos, Where, OrderBy, Select                       â”‚
        /// â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
        ///
        /// <para>
        /// ğŸ¯ <b>OBJETIVO:</b><br/>
        ///    Obter lista completa de veÃ­culos para composiÃ§Ã£o de dropdowns.
        ///    Usa ViewVeiculos, filtra ativos e retorna descriÃ§Ã£o completa do veÃ­culo.
        /// </para>
        ///
        /// <para>
        /// ğŸ“¤ <b>RETORNO:</b><br/>
        ///    IEnumerable&lt;SelectListItem&gt; - Itens prontos para seleÃ§Ã£o em UI.
        /// </para>
        /// </summary>
        /// <returns>Lista de itens de seleÃ§Ã£o com dados completos.</returns>
        public IEnumerable<SelectListItem> GetVeiculoCompletoListForDropDown()
        {
            return _db.ViewVeiculos
                .Where(v => v.Status == true)
                .OrderBy(v => v.Placa)
                .Select(v => new SelectListItem()
                {
                    Text = v.VeiculoCompleto,
                    Value = v.VeiculoId.ToString()
                });
        }


        /// <summary>
        /// â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
        /// â”‚ âš¡ MÃ‰TODO: Update                                                                        â”‚
        /// â”‚ ğŸ”— RASTREABILIDADE:                                                                      â”‚
        /// â”‚    â¬…ï¸ CHAMADO POR : Controllers, Services                                                 â”‚
        /// â”‚    â¡ï¸ CHAMA       : _db.Update, _db.SaveChanges                                           â”‚
        /// â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
        ///
        /// <para>
        /// ğŸ¯ <b>OBJETIVO:</b><br/>
        ///    Atualizar os dados de um veÃ­culo sem re-busca no banco.
        ///    Evita conflitos de tracking no EF Core.
        /// </para>
        ///
        /// <para>
        /// ğŸ“¥ <b>PARÃ‚METROS:</b><br/>
        ///    veiculo - Entidade contendo os dados atualizados.
        /// </para>
        /// </summary>
        /// <param name="veiculo">Entidade <see cref="Veiculo"/> com dados atualizados.</param>
        public new void Update(Veiculo veiculo)
            {
            // Atualiza diretamente sem buscar novamente do banco
            // (evita conflito de tracking no EF Core)
            _db.Update(veiculo);
            _db.SaveChanges();
            }


        }
    }
