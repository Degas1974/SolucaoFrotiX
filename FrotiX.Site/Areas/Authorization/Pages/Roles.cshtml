@*
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ğŸ“Œ ARQUIVO: Roles.cshtml                                                                            â•‘
â•‘ ğŸ“‚ CAMINHO: /Areas/Authorization/Pages                                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ğŸ§­ OBJETIVO: PÃ¡gina de gerenciamento de roles com DataTable editÃ¡vel.                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ğŸ—‚ï¸  CONTÃ‰M: Tabela de roles + scripts de CRUD via /api/roles                                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*@

@page
@model RoleModel
@{
    ViewData["Title"] = "Role";
    ViewData["PageName"] = "authorization_roles";
    ViewData["Heading"] = "<i class='fal fa-shield-alt'></i> Authorization: <span class='fw-300'>Roles</span>";
    ViewData["Category1"] = "Authorization";
    ViewData["PageIcon"] = "fa-shield-alt";
}

@section HeadBlock {
    <link rel="stylesheet" media="screen, print" href="~/css/datagrid/datatables/datatables.bundle.css">
    <link rel="stylesheet" media="screen, print" href="~/css/formplugins/select2/select2.bundle.css">
}

<div class="row">
    <div class="col-xl-12">
        <div id="panel-1" class="panel">
            <div class="panel-container show">
                <div class="panel-content">
                    <table id="dt-list" class="table table-bordered table-hover table-striped w-100"></table>
                </div>
            </div>
        </div>
    </div>
</div>

@section ScriptsBlock {
    <script src="~/js/datagrid/datatables/datatables.bundle.js"></script>
    @* <script src="~/js/formplugins/select2/select2.bundle.js"></script> *@
    <script>
        /****************************************************************************************
         * âš¡ FUNÃ‡ÃƒO: InicializaÃ§Ã£o DataTable de Roles (Perfis de Acesso)
         * --------------------------------------------------------------------------------------
         * ğŸ¯ OBJETIVO     : Gerenciar perfis de acesso (Roles) do sistema com CRUD completo
         *                   via DataTable editÃ¡vel (adicionar, editar, deletar roles).
         * ğŸ“¥ ENTRADAS     : Nenhuma (funÃ§Ã£o auto-executÃ¡vel no document.ready).
         * ğŸ“¤ SAÃDAS       : DataTable renderizada na div #dt-list com operaÃ§Ãµes CRUD.
         * ğŸ”— CHAMADA POR  : Evento de UI (document.ready do jQuery).
         * ğŸ”„ CHAMA        : DataTableEdit() (plugin customizado), $.ajax() para API /api/roles.
         * ğŸ“¦ DEPENDÃŠNCIAS : jQuery, DataTables, datatables.bundle.js, plugin DataTableEdit.
         ****************************************************************************************/
        $(function () {
            try {
                const endpoint = "/api/roles";

                // [DOC] Inicializa DataTable com plugin customizado DataTableEdit para operaÃ§Ãµes CRUD
                $('#dt-list').DataTableEdit({
                    ajax: endpoint,
                    columns: [
                        { title: "Id", data: "id", type: "readonly", visible: false, searchable: false },
                        { title: "ConcurrencyStamp", data: "concurrencyStamp", type: "readonly", visible: false, searchable: false },
                        { title: "Name", data: "name", type: "text" },
                        { title: "Normalized", data: "normalizedName", type: "readonly" }
                    ],

                    // [DOC] Callback para adicionar nova role via POST no endpoint
                    onAddRow: function (table, rowdata, success, error) {
                        try {
                            $.ajax({
                                url: endpoint,
                                type: 'POST',
                                data: rowdata,
                                success: success,
                                error: function(xhr, status, errorMsg) {
                                    alerta.erro('Erro ao adicionar role: ' + (xhr.responseJSON?.message || errorMsg));
                                    if (error) error(xhr, status, errorMsg);
                                }
                            });
                        } catch (ex) {
                            alerta.erro('Erro ao processar adiÃ§Ã£o de role: ' + ex.message);
                            console.error('Erro onAddRow:', ex);
                        }
                    },

                    // [DOC] Callback para deletar role existente via DELETE no endpoint
                    onDeleteRow: function (table, rowdata, success, error) {
                        try {
                            $.ajax({
                                url: endpoint,
                                type: 'DELETE',
                                data: rowdata,
                                success: success,
                                error: function(xhr, status, errorMsg) {
                                    alerta.erro('Erro ao deletar role: ' + (xhr.responseJSON?.message || errorMsg));
                                    if (error) error(xhr, status, errorMsg);
                                }
                            });
                        } catch (ex) {
                            alerta.erro('Erro ao processar exclusÃ£o de role: ' + ex.message);
                            console.error('Erro onDeleteRow:', ex);
                        }
                    },

                    // [DOC] Callback para editar role existente via PUT no endpoint
                    onEditRow: function (table, rowdata, success, error) {
                        try {
                            $.ajax({
                                url: endpoint,
                                type: 'PUT',
                                data: rowdata,
                                success: success,
                                error: function(xhr, status, errorMsg) {
                                    alerta.erro('Erro ao editar role: ' + (xhr.responseJSON?.message || errorMsg));
                                    if (error) error(xhr, status, errorMsg);
                                }
                            });
                        } catch (ex) {
                            alerta.erro('Erro ao processar ediÃ§Ã£o de role: ' + ex.message);
                            console.error('Erro onEditRow:', ex);
                        }
                    }
                });
            } catch (erro) {
                alerta.erro('Erro ao inicializar DataTable de Roles: ' + erro.message);
                console.error('Erro na inicializaÃ§Ã£o:', erro);
            }
        });
    </script>
}
