@*
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ğŸ“Œ ARQUIVO: Users.cshtml                                                                            â•‘
â•‘ ğŸ“‚ CAMINHO: /Areas/Authorization/Pages                                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ğŸ§­ OBJETIVO: PÃ¡gina de gerenciamento de usuÃ¡rios com DataTable editÃ¡vel.                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ğŸ—‚ï¸  CONTÃ‰M: Tabela de usuÃ¡rios + scripts de CRUD via /api/users                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*@

@page
@model UserModel
@{
    ViewData["Title"] = "Users";
    ViewData["PageName"] = "authorization_users";
    ViewData["Heading"] = "<i class='fal fa-shield-alt'></i> Authorization: <span class='fw-300'>Users</span>";
    ViewData["Category1"] = "Authorization";
    ViewData["PageIcon"] = "fa-shield-alt";
}

@section HeadBlock {
    <link rel="stylesheet" media="screen, print" href="~/css/datagrid/datatables/datatables.bundle.css">
    <link rel="stylesheet" media="screen, print" href="~/css/formplugins/select2/select2.bundle.css">
}

<div class="row">
    <div class="col-xl-12">
        <div id="panel-1" class="panel">
            <div class="panel-container show">
                <div class="panel-content">
                    <table id="dt-list" class="table table-bordered table-hover table-striped w-100"></table>
                </div>
            </div>
        </div>
    </div>
</div>

@section ScriptsBlock {
    <script src="~/js/datagrid/datatables/datatables.bundle.js"></script>
    @* <script src="~/js/formplugins/select2/select2.bundle.js"></script> *@
    <script>
        /****************************************************************************************
         * âš¡ FUNÃ‡ÃƒO: InicializaÃ§Ã£o DataTable de Users (UsuÃ¡rios do Sistema)
         * --------------------------------------------------------------------------------------
         * ğŸ¯ OBJETIVO     : Gerenciar usuÃ¡rios do sistema (ASP.NET Identity) com CRUD completo
         *                   via DataTable editÃ¡vel, incluindo controle de email confirmado,
         *                   telefone e status de bloqueio (LockOut).
         * ğŸ“¥ ENTRADAS     : Nenhuma (funÃ§Ã£o auto-executÃ¡vel no document.ready).
         * ğŸ“¤ SAÃDAS       : DataTable renderizada na div #dt-list com operaÃ§Ãµes CRUD de usuÃ¡rios.
         * ğŸ”— CHAMADA POR  : Evento de UI (document.ready do jQuery).
         * ğŸ”„ CHAMA        : DataTableEdit() (plugin customizado), $.ajax() para API /api/users.
         * ğŸ“¦ DEPENDÃŠNCIAS : jQuery, DataTables, datatables.bundle.js, plugin DataTableEdit.
         ****************************************************************************************/
        $(function () {
            try {
                const endpoint = "/api/users";
                const trueFalseOptions = ["false", "true"];

                // [DOC] Inicializa DataTable com plugin customizado para gerenciar usuÃ¡rios do Identity
                $('#dt-list').DataTableEdit({
                    ajax: endpoint,
                    columns: [
                        { title: "Id", data: "id", type: "readonly", visible: false, searchable: false },
                        { title: "ConcurrencyStamp", data: "concurrencyStamp", type: "readonly", visible: false, searchable: false },
                        { title: "Nome do UsuÃ¡rio", data: "userName", type: "readonly", searchable: true },
                        { title: "Email", data: "email", searchable: true },
                        {
                            title: "Confirmed",
                            data: "emailConfirmed",
                            className: "text-center col-1",
                            type: "select",
                            options: trueFalseOptions,
                            // [DOC] Renderiza checkbox desabilitado para visualizaÃ§Ã£o de email confirmado
                            render: function (data) {
                                return `<input type="checkbox" name="emailConfirmed" disabled ${data ? "checked" : ""}>`;
                            }
                        },
                        { title: "PhoneNumber", data: "phoneNumber", searchable: true },
                        {
                            title: "LockOut",
                            data: "lockoutEnabled",
                            className: "text-center col-1",
                            type: "select",
                            options: trueFalseOptions,
                            // [DOC] Renderiza checkbox desabilitado para visualizaÃ§Ã£o de status de bloqueio
                            render: function (data) {
                                return `<input type="checkbox" name="lockoutEnabled" disabled ${data ? "checked" : ""}>`;
                            }
                        }
                    ],

                    // [DOC] Callback para adicionar novo usuÃ¡rio via POST no endpoint
                    onAddRow: function (table, rowdata, success, error) {
                        try {
                            $.ajax({
                                url: endpoint,
                                type: 'POST',
                                data: rowdata,
                                success: success,
                                error: function(xhr, status, errorMsg) {
                                    alerta.erro('Erro ao adicionar usuÃ¡rio: ' + (xhr.responseJSON?.message || errorMsg));
                                    if (error) error(xhr, status, errorMsg);
                                }
                            });
                        } catch (ex) {
                            alerta.erro('Erro ao processar adiÃ§Ã£o de usuÃ¡rio: ' + ex.message);
                            console.error('Erro onAddRow:', ex);
                        }
                    },

                    // [DOC] Callback para deletar usuÃ¡rio existente via DELETE no endpoint
                    onDeleteRow: function (table, rowdata, success, error) {
                        try {
                            $.ajax({
                                url: endpoint,
                                type: 'DELETE',
                                data: rowdata,
                                success: success,
                                error: function(xhr, status, errorMsg) {
                                    alerta.erro('Erro ao deletar usuÃ¡rio: ' + (xhr.responseJSON?.message || errorMsg));
                                    if (error) error(xhr, status, errorMsg);
                                }
                            });
                        } catch (ex) {
                            alerta.erro('Erro ao processar exclusÃ£o de usuÃ¡rio: ' + ex.message);
                            console.error('Erro onDeleteRow:', ex);
                        }
                    },

                    // [DOC] Callback para editar usuÃ¡rio existente via PUT no endpoint
                    onEditRow: function (table, rowdata, success, error) {
                        try {
                            $.ajax({
                                url: endpoint,
                                type: 'PUT',
                                data: rowdata,
                                success: success,
                                error: function(xhr, status, errorMsg) {
                                    alerta.erro('Erro ao editar usuÃ¡rio: ' + (xhr.responseJSON?.message || errorMsg));
                                    if (error) error(xhr, status, errorMsg);
                                }
                            });
                        } catch (ex) {
                            alerta.erro('Erro ao processar ediÃ§Ã£o de usuÃ¡rio: ' + ex.message);
                            console.error('Erro onEditRow:', ex);
                        }
                    }
                });
            } catch (erro) {
                alerta.erro('Erro ao inicializar DataTable de UsuÃ¡rios: ' + erro.message);
                console.error('Erro na inicializaÃ§Ã£o:', erro);
            }
        });
    </script>
}
