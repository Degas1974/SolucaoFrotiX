@* ****************************************************************************************
 * ‚ö° ARQUIVO: Pages/Shared/_ToastPartial.cshtml
 * --------------------------------------------------------------------------------------
 * üéØ OBJETIVO     : Partial view para exibir mensagens toast via TempData (padr√£o Post-Redirect-Get),
 *                   deserializa JSON de ToastMessage e chama AppToast.show() para cada mensagem.
 * üì• ENTRADAS     : TempData["ToastMessages"] string JSON (List<ToastMessage> serializada), cada
 *                   ToastMessage com properties { Cor, Texto, Duracao }, DOMContentLoaded event
 * üì§ SA√çDAS       : <script> tag com JavaScript inline chamando AppToast.show() para cada toast
 *                   (delay 300ms entre cada), texto escapado (\, ', ", \n, \r), console.error se
 *                   AppToast n√£o definido, renderiza√ß√£o condicional se messages != null && Any()
 * üîó CHAMADA POR  : Pages/Shared/_Layout.cshtml (provavelmente antes </body>), controllers/PageModels
 *                   setam TempData antes de RedirectToPage: TempData["ToastMessages"] = JsonSerializer.Serialize(toasts)
 * üîÑ CHAMA        : System.Text.Json.JsonSerializer.Deserialize<List<ToastMessage>>(), AppToast.show()
 *                   (global-toast.js), @Html.Raw() (renderiza texto escapado), DOMContentLoaded listener,
 *                   setTimeout() para delay sequencial (300ms * index), console.error fallback
 * üì¶ DEPEND√äNCIAS : ASP.NET Core Razor Pages (TempData, Partial Views), System.Text.Json, FrotiX.Models.ToastMessage
 *                   (model com Cor/Texto/Duracao properties), global-toast.js (AppToast object com
 *                   show() method), JavaScript nativo (DOMContentLoaded, setTimeout, typeof check)
 * üìù OBSERVA√á√ïES  : 46 linhas. Sistema de notifica√ß√µes FrotiX via TempData (persist across redirect).
 *                   JsonSerializer.Deserialize com try-catch (silencioso - ignora erros deserialization).
 *                   Escaping de caracteres especiais manual: \\ \' \" \n \r (Razor @text block).
 *                   Delay 300ms entre toasts (messages.IndexOf(toast) * 300) para n√£o sobrepor.
 *                   Verifica√ß√£o typeof AppToast !== 'undefined' && AppToast.show antes de chamar
 *                   (previne erro se global-toast.js n√£o carregado). Console.error se AppToast missing.
 *                   Uso t√≠pico no controller: TempData["ToastMessages"] = JsonSerializer.Serialize(new[] {
 *                   new ToastMessage { Cor = "success", Texto = "Salvo com sucesso!", Duracao = 3000 } });
 *                   return RedirectToPage("./Index");
 **************************************************************************************** *@

@using System.Text.Json
@using FrotiX.Models

@{
	var toastJson = TempData["ToastMessages"] as string;
	List<ToastMessage> messages = null;

	if (!string.IsNullOrEmpty(toastJson))
	{
		try
		{
			messages = JsonSerializer.Deserialize<List<ToastMessage>>(toastJson);
		}
		catch { }
	}
}

@if (messages != null && messages.Any())
{
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			// Aguarda o AppToast estar dispon√≠vel
			if (typeof AppToast !== 'undefined' && AppToast.show) {
				@foreach (var toast in messages)
				{
						// Escapa caracteres especiais no texto
						var textoEscapado = toast.Texto
								.Replace("\\" , "\\\\")
								.Replace("'" , "\\'")
								.Replace("\"" , "\\\"")
								.Replace("\n" , "\\n")
								.Replace("\r" , "\\r");

						<text>
							setTimeout(function() {
								AppToast.show('@toast.Cor', '@Html.Raw(textoEscapado)', @toast.Duracao);
							}, @(messages.IndexOf(toast) * 300));
						</text>
				}
			} else {
				console.error('AppToast n√£o est√° definido. Verifique se o global-toast.js foi carregado.');
			}
		});
	</script>
}
