<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Importação de Abastecimento | FrotiX</title>
  <style>
    :root { --vinho:#722F37; --vinho-light:#8B3A44; --azul:#325d88; --azul-light:#3d6f9e; --terracota:#A97B6E; --terracota-light:#C08B7E; --verde:#557570; --verde-light:#6A8A85; --cinza:#f5f7fb; --card:#fff; --texto:#1f1f1f; --shadow:0 20px 45px -18px rgba(0,0,0,.35); --radius:14px; --header-bg:#b66a3d; --code-bg:#33465c; }
    @page { size: A4; margin: 16mm; }
    * { box-sizing: border-box; }
    body { margin:0; font-family:"Segoe UI","Inter",system-ui,-apple-system,sans-serif; background: radial-gradient(circle at 12% 20%, rgba(50,93,136,.08), transparent 26%), radial-gradient(circle at 90% 10%, rgba(114,47,55,.10), transparent 30%), var(--cinza); color:var(--texto); padding:22px; display:flex; justify-content:center; }
    .page { width:210mm; max-width:100%; }
    .hero { background:var(--header-bg); color:#fff; padding:22px 24px; border-radius:var(--radius); box-shadow:0 0 0 1px #000, 0 0 0 4px #fff, var(--shadow); display:flex; align-items:center; gap:16px; }
    .hero img { width:50px; height:50px; filter:drop-shadow(0 6px 8px rgba(0,0,0,.25)); }
    h1 { margin:0; font-size:26px; letter-spacing:0.2px; }
    .subtitle { margin:6px 0 0; font-size:13px; opacity:0.92; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:16px; margin-top:18px; }
    .card { background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px 18px; border:1px solid rgba(0,0,0,0.05); }
    .section-title { display:flex; align-items:center; gap:10px; margin:0 0 10px; font-size:15px; font-weight:800; color:var(--vinho); }
    .icon { width:18px; height:18px; vertical-align:middle; filter:drop-shadow(0 2px 4px rgba(0,0,0,.15)); }
    ul { margin:6px 0 0 18px; padding:0; } li { margin-bottom:6px; }
    code { background:var(--code-bg); color:#e9edf5; padding:10px 12px; border-radius:10px; display:block; white-space:pre-wrap; font-size:12px; line-height:1.45; box-shadow: inset 0 1px 0 rgba(255,255,255,0.03); }
    .tag { display:inline-block; padding:2px 8px; border-radius:12px; font-size:11px; font-weight:600; background:#eee; color:#555; margin-right:4px; }
    .tag.green { background:#d1e7dd; color:#0f5132; }
    .tag.blue { background:#cfe2ff; color:#084298; }
    .tag.orange { background:#ffe8cc; color:#995a00; }
    table { width:100%; border-collapse:collapse; font-size:13px; margin-top:10px; }
    th, td { text-align:left; padding:8px; border-bottom:1px solid #eee; }
    th { color:var(--vinho); font-weight:600; }
    .flow-step { border-left:2px solid #ddd; padding-left:15px; margin-left:5px; padding-bottom:15px; position:relative; }
    .flow-step::before { content:''; position:absolute; left:-6px; top:0; width:10px; height:10px; background:var(--terracota); border-radius:50%; }
    .flow-step:last-child { border-left:none; }
  </style>
</head>

<svg style="display:none" aria-hidden="true" focusable="false">
  <symbol id="fa-file-import" viewBox="0 0 512 512"><path opacity=".4" fill="currentColor" d="M128 64c0-35.3 28.7-64 64-64H352V128c0 17.7 14.3 32 32 32H512V448c0 35.3-28.7 64-64 64H192c-35.3 0-64-28.7-64-64V336 302.1l-13.9 4.6C88.6 315.2 60.6 301.9 52.1 276.4s14.7-53.5 40.2-62.1L128 202.7V64z"/><path fill="currentColor" d="M288 248v88c0 13.3-10.7 24-24 24s-24-10.7-24-24V248c0-13.3 10.7-24 24-24s24 10.7 24 24zM16 272c0-13.3 10.7-24 24-24h80c13.3 0 24 10.7 24 24s-10.7 24-24 24H40c-13.3 0-24-10.7-24-24zm0 88c0-13.3 10.7-24 24-24h80c13.3 0 24 10.7 24 24s-10.7 24-24 24H40c-13.3 0-24-10.7-24-24zM384 0c0 0 0 0 0 0s0 0 0 0V128H512c0 0 0 0 0 0s0 0 0 0L384 0z"/></symbol>
  <symbol id="fa-arrows-rotate" viewBox="0 0 512 512"><path opacity=".4" fill="currentColor" d="M142.9 142.9c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5c13.3 0 24-10.7 24-24V19.5c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L403.4 45.6c-87-87.5-228.6-87.5-315.8 0c-24.4 24.4-69.6 96.7-23.7 142.9c45.2 45.6 116.6 17 79-25.6z"/><path fill="currentColor" d="M369.1 369.1c-62.2 62.2-162.7 62.5-225.3 1L185 329c6.9-6.9 8.9-17.2 5.2-26.2s-12.5-14.8-22.2-14.8H48.4c-13.3 0-24 10.7-24 24V492.5c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l43.1-43.1c87 87.5 228.6 87.5 315.8 0c24.4-24.4 69.6-96.7 23.7-142.9c-45.2-45.6-116.6-17-79 25.6z"/></symbol>
  <symbol id="fa-server" viewBox="0 0 512 512"><path opacity=".4" fill="currentColor" d="M64 32C28.7 32 0 60.7 0 96v64c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM64 288c-35.3 0-64 28.7-64 64v64c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V352c0-35.3-28.7-64-64-64H64z"/><path fill="currentColor" d="M0 256c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V192c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v64zM416 432a32 32 0 1 0 0-64 32 32 0 1 0 0 64zM128 400c17.7 0 32 14.3 32 32s-14.3 32-32 32s-32-14.3-32-32s14.3-32 32-32zm288-256a32 32 0 1 0 0-64 32 32 0 1 0 0 64zM128 144c17.7 0 32 14.3 32 32s-14.3 32-32 32s-32-14.3-32-32s14.3-32 32-32zM416 304a32 32 0 1 0 0-64 32 32 0 1 0 0 64zM96 272a32 32 0 1 0 64 0 32 32 0 1 0 -64 0z"/></symbol>
  <symbol id="fa-code" viewBox="0 0 640 640"><path opacity=".4" fill="currentColor" d="M225.2 535.2C220.3 552.2 230.2 569.9 247.2 574.8C264.2 579.7 281.9 569.8 286.8 552.8L414.8 104.8C419.7 87.8 409.8 70.1 392.8 65.2C375.8 60.3 358.1 70.2 353.2 87.2L225.2 535.2z"/><path fill="currentColor" d="M457.4 201.4C444.9 213.9 444.9 234.2 457.4 246.7L530.8 320.1L457.4 393.5C444.9 406 444.9 426.3 457.4 438.8C469.9 451.3 490.2 451.3 502.7 438.8L598.7 342.8C611.2 330.3 611.2 310 598.7 297.5L502.7 201.5C490.2 189 469.9 189 457.4 201.5zM182.7 201.4C170.2 188.9 149.9 188.9 137.4 201.4L41.4 297.4C28.9 309.9 28.9 330.2 41.4 342.7L137.4 438.7C149.9 451.2 170.2 451.2 182.7 438.7C195.2 426.2 195.2 405.9 182.7 393.4L109.3 320L182.6 246.6C195.1 234.1 195.1 213.8 182.6 201.3z"/></symbol>
  <symbol id="fa-triangle-exclamation" viewBox="0 0 512 512"><path opacity=".4" fill="currentColor" d="M256 0C256 0 256 0 256 0c31.3 0 60.7 16.7 76.3 43.8l216 376c15.6 27.1 15.6 60.5 0 87.6S493.3 551.3 462 551.3H50c-31.3 0-60.7-16.7-76.3-43.8s-15.6-60.5 0-87.6l216-376C205.3 16.7 234.7 0 256 0z"/><path fill="currentColor" d="M256 128c13.3 0 24 10.7 24 24V296c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zm32 280a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"/></symbol>
</svg>

<div class="page">
  <header class="hero">
    <svg class="icon" aria-hidden="true" focusable="false"><use href="#fa-file-import"></use></svg>
    <div>
      <h1>Importação de Abastecimento</h1>
      <p class="subtitle">Processamento de arquivos em lote com validação inteligente · Versão 2.1</p>
    </div>
  </header>

  <main class="grid">
    <section class="card">
      <div class="section-title"><svg class="icon" aria-hidden="true" focusable="false"><use href="#fa-file-import"></use></svg>Visão Geral</div>
      <p>Sistema robusto para importação em massa de abastecimentos. Suporta arquivos Excel individuais ou o modo "Dual" (XLSX + CSV) para combinar dados de diferentes fontes.</p>
      <ul>
        <li><span class="tag orange">Dual Import</span> Combina XLSX (Datas) + CSV (Dados) via Join</li>
        <li><span class="tag blue">SignalR</span> Progresso em tempo real para o usuário</li>
        <li><span class="tag green">Validação</span> Checagem automática de KM, consumo e limites</li>
        <li><span class="tag green">Pendências</span> Erros viram tarefas corrigíveis, não falhas totais</li>
      </ul>
    </section>

    <section class="card">
      <div class="section-title"><svg class="icon" aria-hidden="true" focusable="false"><use href="#fa-arrows-rotate"></use></svg>Fluxo de Processamento</div>
      <div style="font-size:12px;color:#555;">
        <div class="flow-step"><strong>1. Upload:</strong> Envio de arquivos via FormData para API.</div>
        <div class="flow-step"><strong>2. Leitura & Join:</strong> Backend lê CSV e XLSX, unindo pela coluna "Autorização".</div>
        <div class="flow-step"><strong>3. Validação:</strong> Verifica Veículo, Motorista, Produto e Consumo (±40% média).</div>
        <div class="flow-step"><strong>4. Persistência:</strong> Salva sucessos e gera "AbastecimentoPendente" para erros.</div>
        <div class="flow-step"><strong>5. Feedback:</strong> Retorna estatísticas e lista de erros com sugestões de correção.</div>
      </div>
    </section>

    <section class="card">
      <div class="section-title"><svg class="icon" aria-hidden="true" focusable="false"><use href="#fa-server"></use></svg>Endpoints Principais</div>
      <table style="margin-bottom:12px">
        <tr><th>Rota</th><th>Função</th></tr>
        <tr><td><code>POST /ImportarNovo</code></td><td>Importação simples (1 arquivo XLSX).</td></tr>
        <tr><td><code>POST /ImportarDual</code></td><td>Importação composta (XLSX + CSV).</td></tr>
        <tr><td><code>GET /ExportarPendencias</code></td><td>Gera Excel com erros para análise.</td></tr>
      </table>
    </section>

    <section class="card">
      <div class="section-title"><svg class="icon" aria-hidden="true" focusable="false"><use href="#fa-triangle-exclamation"></use></svg>Tratamento de Erros Inteligente</div>
      <p>O sistema não apenas rejeita, mas sugere correções:</p>
      <code>
// Ex: KM Negativo ou Consumo Irreal
if (consumoAtual > limiteSuperior) {
    linha.Erros.Add("Consumo excessivo");
    linha.TemSugestao = true;
    linha.ValorSugerido = linha.Km - kmRodadoEsperado;
    // Sugere corrigir KM Anterior
}
      </code>
    </section>

    <section class="card">
      <div class="section-title"><svg class="icon" aria-hidden="true" focusable="false"><use href="#fa-code"></use></svg>Troubleshooting: ModelState</div>
      <p>Correção crítica implementada no backend para evitar validação prematura do ASP.NET em uploads multipart:</p>
      <code>
// Remove validação automática que bloqueava o upload
ModelState.Remove("Veiculo");
ModelState.Remove("Motorista");
// ... campos que só existem após processar o arquivo
      </code>
    </section>
  </main>
</div>
</body>
</html>
