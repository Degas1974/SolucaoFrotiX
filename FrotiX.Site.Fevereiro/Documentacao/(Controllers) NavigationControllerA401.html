<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>NavigationController | FrotiX</title>
  <style>
    :root {
      --vinho: #722F37; --vinho-light: #8B3A44;
      --azul: #325d88; --azul-light: #3d6f9e;
      --terracota: #A97B6E; --terracota-light: #C08B7E;
      --verde: #557570; --verde-light: #6A8A85;
      --cinza: #f5f7fb; --card: #ffffff; --texto: #1f1f1f;
      --shadow: 0 20px 45px -18px rgba(0,0,0,.35);
      --radius: 14px; --header-bg: #b66a3d; --code-bg: #33465c;
    }
    @page { size: A4; margin: 16mm; }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: "Segoe UI","Inter",system-ui,-apple-system,sans-serif;
      background: radial-gradient(circle at 12% 20%, rgba(50,93,136,.08), transparent 26%), radial-gradient(circle at 90% 10%, rgba(114,47,55,.10), transparent 30%), var(--cinza);
      color: var(--texto); padding: 22px; display: flex; justify-content: center;
    }
    .page { width: 210mm; max-width: 100%; }
    .hero {
      background: var(--header-bg); color: #fff; padding: 22px 24px;
      border-radius: var(--radius); box-shadow: 0 0 0 1px #000, 0 0 0 4px #fff, var(--shadow);
      display: flex; align-items: center; gap: 16px;
    }
    .hero img { width: 50px; height: 50px; filter: drop-shadow(0 6px 8px rgba(0,0,0,.25)); }
    h1 { margin: 0; font-size: 26px; letter-spacing: 0.2px; }
    .subtitle { margin: 6px 0 0; font-size: 13px; opacity: 0.92; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; margin-top: 18px; }
    .card {
      background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 16px 18px; border: 1px solid rgba(0,0,0,0.05);
    }
    .section-title { display: flex; align-items: center; gap: 10px; margin: 0 0 10px; font-size: 15px; font-weight: 800; color: var(--vinho); }
    .icon { width: 18px; height: 18px; vertical-align: middle; filter: drop-shadow(0 2px 4px rgba(0,0,0,.15)); }
    ul { margin: 6px 0 0 18px; padding: 0; }
    li { margin-bottom: 6px; }
    code {
      background: var(--code-bg); color: #e9edf5; padding: 10px 12px;
      border-radius: 10px; display: block; white-space: pre-wrap; font-size: 12px; line-height: 1.45;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.03);
    }
  </style>
</head>

  <svg style="display:none" aria-hidden="true" focusable="false">
  <symbol id="fa-sitemap" viewBox="0 0 640 640"><!--! Font Awesome Pro 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2025 Fonticons, Inc. --><path opacity=".4" fill="currentColor" d="M104 376L104 416L152 416L152 376C152 353.9 169.9 336 192 336L296 336L296 416L344 416L344 336L448 336C470.1 336 488 353.9 488 376L488 416L536 416L536 376C536 327.4 496.6 288 448 288L344 288L344 224L296 224L296 288L192 288C143.4 288 104 327.4 104 376z"/><path fill="currentColor" d="M256 128C256 110.3 270.3 96 288 96L352 96C369.7 96 384 110.3 384 128L384 192C384 209.7 369.7 224 352 224L288 224C270.3 224 256 209.7 256 192L256 128zM96 416L160 416C177.7 416 192 430.3 192 448L192 512C192 529.7 177.7 544 160 544L96 544C78.3 544 64 529.7 64 512L64 448C64 430.3 78.3 416 96 416zM288 416L352 416C369.7 416 384 430.3 384 448L384 512C384 529.7 369.7 544 352 544L288 544C270.3 544 256 529.7 256 512L256 448C256 430.3 270.3 416 288 416zM480 416L544 416C561.7 416 576 430.3 576 448L576 512C576 529.7 561.7 544 544 544L480 544C462.3 544 448 529.7 448 512L448 448C448 430.3 462.3 416 480 416z"/></symbol>
  <symbol id="fa-info" viewBox="0 0 640 640"><!--! Font Awesome Pro 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2025 Fonticons, Inc. --><path opacity=".4" fill="currentColor" d="M272 112C272 138.5 293.5 160 320 160C346.5 160 368 138.5 368 112C368 85.5 346.5 64 320 64C293.5 64 272 85.5 272 112z"/><path fill="currentColor" d="M256 224C238.3 224 224 238.3 224 256C224 273.7 238.3 288 256 288L288 288L288 512L256 512C238.3 512 224 526.3 224 544C224 561.7 238.3 576 256 576L384 576C401.7 576 416 561.7 416 544C416 526.3 401.7 512 384 512L352 512L352 256C352 238.3 337.7 224 320 224L256 224z"/></symbol>
  <symbol id="fa-layer-group" viewBox="0 0 640 640"><!--! Font Awesome Pro 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2025 Fonticons, Inc. --><path opacity=".4" fill="currentColor" d="M64 320C64 329.4 69.4 337.9 77.9 341.8C132.8 367.2 205.7 400.9 296.5 442.8C311.4 449.7 328.6 449.7 343.5 442.8C434.3 400.8 507.2 367.2 562.1 341.8C570.6 337.9 576 329.4 576 320C576 310.6 570.6 302.1 562.1 298.2L470.7 256C428.3 275.6 385.9 295.2 343.5 314.8C328.6 321.7 311.4 321.7 296.5 314.8C254.1 295.2 211.7 275.6 169.3 256L77.9 298.2C69.4 302.1 64 310.6 64 320z"/><path fill="currentColor" d="M343.5 69.2C328.6 62.3 311.4 62.3 296.5 69.2L77.9 170.2C69.4 174.1 64 182.6 64 192C64 201.4 69.4 209.9 77.9 213.8L296.5 314.8C311.4 321.7 328.6 321.7 343.5 314.8L562.1 213.8C570.6 209.9 576 201.4 576 192C576 182.6 570.6 174.1 562.1 170.2L343.5 69.2zM77.9 426.2C69.4 430.1 64 438.6 64 448C64 457.4 69.4 465.9 77.9 469.8L296.5 570.8C311.4 577.7 328.6 577.7 343.5 570.8L562.1 469.8C570.6 465.9 576 457.4 576 448C576 438.6 570.6 430.1 562.1 426.2L470.7 384L343.5 442.8C328.6 449.7 311.4 449.7 296.5 442.8L169.3 384L77.9 426.2z"/></symbol>
  <symbol id="fa-route" viewBox="0 0 640 640"><!--! Font Awesome Pro 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2025 Fonticons, Inc. --><path opacity=".4" fill="currentColor" d="M160 576L480 576C533 576 576 533 576 480C576 427 533 384 480 384L384 384C366.3 384 352 369.7 352 352C352 334.3 366.3 320 384 320L480 320C474.9 320 470.1 317.9 466.7 314C458 303.9 439.7 282 422.6 256C409.7 256 396.9 256 384 256C331 256 288 299 288 352C288 405 331 448 384 448L480 448C497.7 448 512 462.3 512 480C512 497.7 497.7 512 480 512L217.4 512C200.3 538 182 560 173.3 570C170 573.9 165.1 576 160 576z"/><path fill="currentColor" d="M384 160C384 214.5 447.8 292.1 466.7 314C470 317.9 474.9 320 480 320C485.1 320 489.9 317.9 493.3 314C512.3 292.1 576 214.4 576 160C576 107 533 64 480 64C427 64 384 107 384 160zM448 160C448 142.3 462.3 128 480 128C497.7 128 512 142.3 512 160C512 177.7 497.7 192 480 192C462.3 192 448 177.7 448 160zM64 416C64 470.5 127.8 548.1 146.7 570C150 573.9 154.9 576 160 576C165.1 576 169.9 573.9 173.3 570C192.3 548.1 256 470.4 256 416C256 363 213 320 160 320C107 320 64 363 64 416zM128 416C128 398.3 142.3 384 160 384C177.7 384 192 398.3 192 416C192 433.7 177.7 448 160 448C142.3 448 128 433.7 128 416z"/></symbol>
  <symbol id="fa-people-arrows" viewBox="0 0 640 640"><!--! Font Awesome Pro 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2025 Fonticons, Inc. --><path opacity=".4" fill="currentColor" d="M64 288L64 352C64 375.7 76.9 396.4 96 407.4L96 528C96 554.5 117.5 576 144 576L176 576C202.5 576 224 554.5 224 528L224 435.9C220.1 433.3 216.5 430.3 213.1 426.9L157.1 370.9C129 342.8 129 297.2 157.1 269.1L201.5 224.7C198.4 224.2 195.2 224 192 224L128 224C92.7 224 64 252.7 64 288zM96 128C96 163.3 124.7 192 160 192C195.3 192 224 163.3 224 128C224 92.7 195.3 64 160 64C124.7 64 96 92.7 96 128zM416 128C416 163.3 444.7 192 480 192C515.3 192 544 163.3 544 128C544 92.7 515.3 64 480 64C444.7 64 416 92.7 416 128zM416 435.9L416 528C416 554.5 437.5 576 464 576L496 576C522.5 576 544 554.5 544 528L544 407.4C563.1 396.3 576 375.7 576 352L576 288C576 252.7 547.3 224 512 224L448 224C444.8 224 441.6 224.2 438.5 224.7L482.9 269.1C511 297.2 511 342.8 482.9 370.9L426.9 426.9C423.5 430.3 419.9 433.3 416 435.9z"/><path fill="currentColor" d="M352 264C352 254.3 357.8 245.5 366.8 241.8C375.8 238.1 386.1 240.1 393 247L449 303C458.4 312.4 458.4 327.6 449 336.9L393 392.9C386.1 399.8 375.8 401.8 366.8 398.1C357.8 394.4 352 385.7 352 376L352 352L288 352L288 376C288 385.7 282.2 394.5 273.2 398.2C264.2 401.9 253.9 399.9 247 393L191 337C181.6 327.6 181.6 312.4 191 303.1L247 247.1C253.9 240.2 264.2 238.2 273.2 241.9C282.2 245.6 288 254.3 288 264L288 288L352 288L352 264z"/></symbol>
  <symbol id="fa-link" viewBox="0 0 640 640"><!--! Font Awesome Pro 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2025 Fonticons, Inc. --><path opacity=".4" fill="currentColor" d="M224 323.5C224 367.4 242.1 407.1 271.2 435.5C286.9 450.8 305.7 462.8 326.7 470.5C343.5 476.6 361.6 480 380.4 480C421.9 480 461.7 463.5 491 434.2L562.1 363.1C591.5 333.7 608 293.9 608 252.5C608 166 538 96 451.5 96C410.1 96 370.3 112.5 340.9 141.8L313.2 169.5C334.1 177.2 353 189.3 368.6 204.6L386.1 187.1C403.4 169.8 427 160 451.5 160C502.6 160 544 201.4 544 252.5C544 277 534.3 300.5 516.9 317.9L445.8 389C428.5 406.3 404.9 416.1 380.3 416.1C355.5 416.1 333 406.3 316.4 390.4C298.9 373.6 287.9 349.9 287.9 323.7C287.9 299.2 297.6 275.7 315 258.3L323.3 250C306.7 234.1 284.3 224.2 259.4 224.2C236.6 252.1 223.9 287.3 223.9 323.7z"/><path fill="currentColor" d="M194.2 251.1C211.5 233.8 235.1 224 259.6 224C310.5 224 352.1 265.7 352.1 316.9C352.1 341.1 342.5 364.4 325.5 381.4L316.6 390.3C333.2 406.2 355.7 416 380.4 416C403.4 388.3 416.1 353.1 416.1 316.9C416.1 230.6 346.2 160 259.6 160C218.1 160 178.3 176.5 149 205.8L77.8 276.9C48.5 306.3 32 346.1 32 387.5C32 474 102 544 188.5 544C229.9 544 269.7 527.5 299.1 498.2L326.7 470.6C305.7 462.9 286.9 450.9 271.2 435.6L253.8 453C236.5 470.3 212.9 480.1 188.4 480.1C137.3 480.1 95.9 438.7 95.9 387.6C95.9 363.1 105.6 339.6 123 322.2L194.1 251.1z"/></symbol>
  <symbol id="fa-bug" viewBox="0 0 640 640"><!--! Font Awesome Pro 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2025 Fonticons, Inc. --><path opacity=".4" fill="currentColor" d="M224 160L224 163.6C224 179.3 236.7 192 252.4 192L387.5 192C403.2 192 415.9 179.3 415.9 163.6L415.9 160C415.9 107 372.9 64 319.9 64C266.9 64 223.9 107 223.9 160zM296 344L296 574.2C303.8 575.4 311.8 576 320 576C328.2 576 336.2 575.4 344 574.2L344 344C344 330.7 333.3 320 320 320C306.7 320 296 330.7 296 344z"/><path fill="currentColor" d="M563.2 217.6C577.3 207 580.2 186.9 569.6 172.8C559 158.7 538.9 155.8 524.8 166.4L416 248C403.7 242.9 390.2 240 376 240L264 240C249.8 240 236.3 242.8 224 248L115.2 166.4C101.1 155.8 81 158.7 70.4 172.8C59.8 186.9 62.7 207 76.8 217.6L174.6 290.9C169.3 299.8 165.3 309.6 162.8 320L64 320C46.3 320 32 334.3 32 352C32 369.7 46.3 384 64 384L160 384L160 416C160 418.6 160.1 421.3 160.2 423.9L76.8 486.4C62.7 497 59.8 517.1 70.4 531.2C81 545.3 101.1 548.2 115.2 537.6L178.3 490.3C201.5 534.5 244.8 566.5 296 574.2L296 344C296 330.7 306.7 320 320 320C333.3 320 344 330.7 344 344L344 574.2C395.2 566.5 438.5 534.5 461.7 490.3L524.8 537.6C538.9 548.2 559 545.3 569.6 531.2C580.2 517.1 577.3 497 563.2 486.4L479.8 423.9C479.9 421.3 480 418.7 480 416L480 384L576 384C593.7 384 608 369.7 608 352C608 334.3 593.7 320 576 320L477.2 320C474.7 309.6 470.7 299.8 465.4 290.9L563.2 217.6z"/></symbol>
</svg>
  <body>
  <svg style="display:none" aria-hidden="true" focusable="false">
  
</svg>
  <div class="page">
    <header class="hero">
      <svg class="icon" aria-hidden="true" focusable="false"><use href="#fa-sitemap"></use></svg>
      <div>
        <h1>NavigationController</h1>
        <p class="subtitle">Pilar da navegação e controle de acesso do FrotiX • Última atualização: 08/01/2026 • Versão 2.0</p>
      </div>
    </header>

    <main class="grid">
      <section class="card">
        <div class="section-title"><svg class="icon" aria-hidden="true" focusable="false"><use href="#fa-info"></use></svg>Visão geral</div>
        <p>Orquestra menus hierárquicos, recursos e permissões. Sincroniza o <code>nav.json</code> legado com a tabela <code>Recurso</code>, expõe árvore para o TreeView Syncfusion, aplica cache e provê catálogo de ícones FontAwesome 7 Pro.</p>
        <ul>
          <li>Gerencia parent/child, ordenação e links das páginas.</li>
          <li>Integra controle de acesso por usuário/role (Recurso + ControleAcesso).</li>
          <li>API crítica: qualquer mudança impacta toda a navegação.</li>
        </ul>
      </section>

      <section class="card">
        <div class="section-title"><svg class="icon" aria-hidden="true" focusable="false"><use href="#fa-layer-group"></use></svg>Arquitetura e arquivos</div>
        <ul>
          <li>Controller parcial em <code>Controllers/NavigationController.cs</code>.</li>
          <li>Página de gestão: <code>Pages/Administracao/GestaoRecursosNavegacao.cshtml</code>.</li>
          <li>ViewComponent: <code>NavigationViewComponent</code> renderiza menu.</li>
          <li>DTOs: <code>RecursoTreeDTO</code>, <code>NavigationItemDTO</code>.</li>
          <li>JSONs: <code>nav.json</code> (legado) e <code>fontawesome-icons.json</code> (catálogo).</li>
          <li>Cache: <code>IMemoryCache</code> para ícones e árvores.</li>
        </ul>
      </section>

      <section class="card">
        <div class="section-title"><svg class="icon" aria-hidden="true" focusable="false"><use href="#fa-route"></use></svg>Endpoints chave</div>
        <ul>
          <li><strong>GET /api/Navigation/GetTree</strong> – lê estrutura do <code>nav.json</code> (legado).</li>
          <li><strong>POST /api/Navigation/SaveTree</strong> – salva árvore e sincroniza JSON ↔ BD.</li>
          <li><strong>GET /api/Navigation/GetTreeFromDb</strong> – árvore diretamente da tabela <code>Recurso</code>.</li>
          <li><strong>GET /api/Navigation/GetTreeAdmin</strong> – visão administrativa completa com permissões.</li>
          <li><strong>GET /api/Navigation/GetIcons</strong> – catálogo hierárquico de ícones FA 7 Pro.</li>
          <li><strong>POST /api/Navigation/SyncJsonToDb</strong> – migração do JSON para banco.</li>
          <li><strong>POST /api/Navigation/Seed</strong> – carga inicial de recursos.</li>
        </ul>
      </section>

      <section class="card">
        <div class="section-title"><svg class="icon" aria-hidden="true" focusable="false"><use href="#fa-people-arrows"></use></svg>Controle de acesso & cache</div>
        <ul>
          <li>Mapeia recursos para usuários/roles via <code>ControleAcesso</code>.</li>
          <li>Cache de árvore e ícones evita leituras repetidas; invalidação ao salvar.</li>
          <li>Menor dependência do <code>nav.json</code>; fonte preferencial é BD.</li>
        </ul>
        <code>
// Exemplo de item salvo<br>
{<br>
  "id": "mnu_viagens", "text": "Viagens", "href": "/Viagens/Index",<br>
  "icon": "fa-duotone fa-route", "parentId": "mnu_principal", "ordem": 20<br>
}
        </code>
      </section>

      <section class="card">
        <div class="section-title"><svg class="icon" aria-hidden="true" focusable="false"><use href="#fa-link"></use></svg>Interconexões</div>
        <ul>
          <li>Chamado pelo componente de menu (ViewComponent) e pela página de gestão.</li>
          <li>Depende de <code>IUnitOfWork.Recurso</code> e <code>ControleAcesso</code> para persistência.</li>
          <li>Usa Syncfusion TreeView no front para editar hierarquia.</li>
          <li>Ícones vêm de <code>FontAwesome/duotone</code> e do JSON traduzido.</li>
        </ul>
      </section>

      <section class="card">
        <div class="section-title"><svg class="icon" aria-hidden="true" focusable="false"><use href="#fa-bug"></use></svg>Troubleshooting</div>
        <ul>
          <li>Menu não aparece: confirmar cache limpo e que <code>GetTreeFromDb</code> está publicado.</li>
          <li>Permissão incorreta: revisar vínculos Recurso ↔ ControleAcesso ↔ Usuário.</li>
          <li>Ícone não renderiza: ver se classe FA existe e caminho de SVG está correto.</li>
          <li>JSON fora de sincronia: executar <code>/SyncJsonToDb</code> ou <code>/Seed</code> após ajustes.</li>
        </ul>
      </section>
    </main>
  </div>
</body>
</html>


