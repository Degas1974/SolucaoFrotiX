@page
@using FrotiX.Repository.IRepository
@using Syncfusion.EJ2
@addTagHelper *, Syncfusion.EJ2

@* ========================================================================================
 * ARQUIVO: Pages/Patrimonio/Index.cshtml
 * OBJETIVO: Pagina de listagem e gestao de patrimonios com Syncfusion TreeGrid hierarquico
 *           (exibe patrimonios com setores patrimoniais aninhados em arvore), filtros de
 *           Secao Patrimonial e Setor Patrimonial via Syncfusion DropDownList, CRUD completo
 *           (criacao/edicao via /Patrimonio/Upsert, exclusao com confirmacao), exportacao Excel/PDF.
 * ENTRADAS: Model FrotiX.Models.Patrimonio (code-behind), ViewData com listas (secoes patrimoniais,
 *           setores patrimoniais carregadas via IUnitOfWork no OnGet), Syncfusion TreeGrid hash tblPatrimonio
 *           com DataSource URL /api/Patrimonio/GetTreeData (retorna JSON hierarquico), filtros
 *           DropDownList (ddlSecao, ddlSetor) com eventos change recarregam TreeGrid via AJAX
 * SAIDAS: TreeGrid Syncfusion renderizado hierarquico (colunas: Codigo, Descricao, Secao, Setor,
 *         Status badge, Acoes com botoes Editar/Excluir), filtros funcionais (mudar secao/setor
 *         filtra TreeGrid via AJAX), botao + Novo Patrimonio redireciona /Patrimonio/Upsert,
 *         exportacoes Excel/PDF via toolbar TreeGrid, exclusao com confirmacao SweetAlert2
 * CHAMADA POR: Route /Patrimonio via diretiva page, navegacao sidebar menu (Cadastros > Patrimonios),
 *              IndexModel.OnGet metodo backend carrega secoes/setores via IUnitOfWork
 * CHAMA: patrimonio.js (arquivo JavaScript externo com handlers TreeGrid, filtros, CRUD),
 *        GET /api/Patrimonio/GetTreeData (retorna JSON hierarquico de patrimonios), POST /api/Patrimonio/Delete
 * DEPENDENCIAS: ASP.NET Core Razor Pages 8.0, Syncfusion EJ2 ASP.NET Core (TreeGrid, DropDownList),
 *               jQuery 3.7.1, Bootstrap 5.3.8, patrimonio.js, Alerta.js, AppToast.js
 * OBSERVACOES: 155 linhas com TreeGrid hierarquico mostrando patrimonios organizados por setores.
 *              Sistema permite gestao de bens patrimoniais do orgao (veiculos, equipamentos,
 *              imoveis) classificados em secoes e setores patrimoniais conforme normas contabeis.
 * REGRA: nunca use o simbolo arroba dentro deste bloco de comentario
 ======================================================================================== *@

@model FrotiX.Models.Patrimonio

@inject IUnitOfWork _unitOfWork

@{
	@functions {
		public void OnGet()
		{
			FrotiX.Pages.Patrimonio.IndexModel.Initialize(_unitOfWork);
		}
	}

	ViewData["Title"] = "PatrimÃ´nios";
	ViewData["PageName"] = "patrimonio_index";
	ViewData["Heading"] = "<i class='fa-duotone fa-print-magnifying-glass'></i> Cadastros: <span class='fw-300'>PatrimÃ´nios</span>";
	ViewData["Category1"] = "Cadastros";
	ViewData["PageIcon"] = "fa-duotone fa-print-magnifying-glass";
}

@section HeadBlock {
	<style>
/* ======== OUTLINE BRANCO NO BOTÃƒO DO HEADER (PadrÃ£o FrotiX) ======== */
		.ftx-card-header .btn-fundo-laranja {
			outline: 2px solid rgba(255, 255, 255, 0.5) !important;
			outline-offset: 1px;
			transition: all 0.2s ease;
		}

		.ftx-card-header .btn-fundo-laranja:hover {
			outline: 2px solid rgba(255, 255, 255, 0.8) !important;
			outline-offset: 2px;
		}

	</style>
}

<div class="row">
	<div class="col-xl-12">
		<div id="panel-1" class="panel">
			<div class="panel-container show">
				<!-- HEADER DO CARD -->
				<div class="ftx-card-header">
					<h2 class="titulo-paginas">
						<i class="fa-duotone fa-pallet-boxes"></i>
						Listagem de PatrimÃ´nios
					</h2>
					<div class="ftx-card-actions">
						<a href="./Patrimonio/Upsert" class="btn btn-fundo-laranja" data-ftx-loading>
							<i class="fa-duotone fa-clone-plus icon-pulse me-1"></i>
							Adicionar PatrimÃ´nio
						</a>
					</div>
				</div>

				<div class="panel-content">
					<div class="box-body">
						<br /><br />
						<div class="col-12 px-3">
							<label class="fw-bold">
								<i class="fa-duotone fa-filter"></i>
								Escolha os filtros desejados para visualizar os PatrimÃ´nios:
							</label>
						</div>

						<br />

						<div class="col-12">
							<div class="form-group row">
								<div class="col-3">
									<ejs-dropdowntree id="ddtMarcaModelo"
													  placeholder="Selecione Marca/Modelo"
													  showCheckBox="true"
													  showClearButton="true"
													  treeSettings="@(new Syncfusion.EJ2.DropDowns.DropDownTreeTreeSettings { AutoCheck = true })">
										<e-dropdowntree-fields dataSource="new List<object>()" text="text" value="value" parentValue="parentValue" hasChildren="hasChildren"></e-dropdowntree-fields>
									</ejs-dropdowntree>
								</div>
								<div class="col-3">
									<ejs-dropdowntree id="ddtSetorSecao"
													  placeholder="Selecione Setor/SeÃ§Ã£o"
													  showCheckBox="true"
													  showClearButton="true"
													  treeSettings="@(new Syncfusion.EJ2.DropDowns.DropDownTreeTreeSettings { AutoCheck = true })">
										<e-dropdowntree-fields dataSource="new List<object>()" text="text" value="value" parentValue="parentValue" hasChildren="hasChildren"></e-dropdowntree-fields>
									</ejs-dropdowntree>
								</div>
								<div class="col-3">
									<ejs-combobox id="cmbSituacao"
												  placeholder="Selecione uma SituaÃ§Ã£o"
												  allowFiltering="true"
												  filterType="Contains"
												  popupHeight="250px"
												  width="100%"
												  showClearButton="true">
										<e-combobox-fields></e-combobox-fields>
									</ejs-combobox>
								</div>
								<div class="col-3 d-flex align-items-end">
									<a class="btn btn-marrom text-white w-100"
									   id="btnFiltrarPatrimonios"
									   data-ejtip="Filtrar os PatrimÃ´nios!"
									   style="cursor:pointer;">
										<i class="fa-duotone fa-filter"></i>
										Filtrar PatrimÃ´nios
									</a>
								</div>
							</div>
							<br />
						</div>

						<br /><br />
						<table id="tblPatrimonio" class="table table-bordered table-striped" width="100%">
							<thead>
								<tr>
									<th>NPR</th>
									<th>Marca</th>
									<th>Modelo</th>
									<th>DescriÃ§Ã£o</th>
									<th>Setor Atual</th>
									<th>SeÃ§Ã£o Atual</th>
									<th>SituaÃ§Ã£o</th>
									<th>AÃ§Ãµes</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- OVERLAY DE LOADING - PADRÃƒO FROTIX -->
<div id="loadingOverlayPatrimonio" class="ftx-spin-overlay" style="z-index: 999999; cursor: wait; display: none;">
    <div class="ftx-spin-box" style="text-align: center; min-width: 300px;">
        <img src="/images/logo_gota_frotix_transparente.png" alt="FrotiX" class="ftx-loading-logo" style="display: block;" />
        <div class="ftx-loading-bar"></div>
        <div class="ftx-loading-text">Carregando PatrimÃ´nios...</div>
        <div class="ftx-loading-subtext">Aguarde, por favor</div>
    </div>
</div>

@section ScriptsBlock {
	
	

	<script src="~/js/cadastros/patrimonio.js" asp-append-version="true"></script>
}

