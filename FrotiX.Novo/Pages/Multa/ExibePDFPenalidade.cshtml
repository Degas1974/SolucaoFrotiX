@* ****************************************************************************************
 * âš¡ ARQUIVO: Pages/Multa/ExibePDFPenalidade.cshtml
 * --------------------------------------------------------------------------------------
 * ðŸŽ¯ OBJETIVO     : PÃ¡gina visualizaÃ§Ã£o PDF comprovante pagamento penalidade - **QUASE IDÃŠNCTICO** a
 *                   ExibePDFComprovante.cshtml (DUPLICAÃ‡ÃƒO! mesmo cÃ³digo, mesmo campo ComprovantePDF, mesmo
 *                   link ListaPenalidade). Syncfusion EJ2 PDFViewer, /DadosEditaveis/Multas/{ComprovantePDF}.
 * ðŸ“¥ ENTRADAS     : @page route /Multa/ExibePDFPenalidade, @model ExibePDFPenalidadeModel (code-behind),
 *                   Model.MultaObj.Multa.NumInfracao, Model.MultaObj.Multa.ComprovantePDF (filename PDF)
 * ðŸ“¤ SAÃDAS       : Panel botÃ£o center absolute btn-voltar ./ListaPenalidade, h2 "Registro de Pagamento da
 *                   InfraÃ§Ã£o nÂº: {NumInfracao}", <ejs-pdfviewer id="pdfViewer" serviceUrl="/api/PdfViewer" height:100%>,
 *                   JavaScript pdfViewer.load(caminho) ou alert danger "PDF nÃ£o disponÃ­vel", Bootstrap 5 CDN
 * ðŸ”— CHAMADA POR  : Link "Ver Penalidade/Comprovante" ListaPenalidade, route /Multa/ExibePDFPenalidade,
 *                   ExibePDFPenalidadeModel.OnGet(id) (code-behind)
 * ðŸ”„ CHAMA        : ExibePDFPenalidadeModel (code-behind), Model.MultaObj.Multa (NumInfracao, ComprovantePDF),
 *                   ./ListaPenalidade (link voltar), /api/PdfViewer (Syncfusion service), /DadosEditaveis/Multas/
 *                   {filename}.pdf, ejs-pdfviewer TagHelper, ej2_instances[0], pdfViewer.load(), AppToast.show,
 *                   Alerta.TratamentoErroComLinha, ViewData, Font Awesome, Bootstrap 5 CDN, AntiForgeryToken,
 *                   stopEnterSubmitting, form enctype multipart/form-data (NÃƒO usado!), data-ftx-loading
 * ðŸ“¦ DEPENDÃŠNCIAS : ASP.NET Core Razor Pages, ExibePDFPenalidadeModel, Syncfusion EJ2 PDFViewer (ejs-pdfviewer,
 *                   /api/PdfViewer, ej2_instances), Bootstrap 5 CDN (REDUNDANTE), Font Awesome Duotone, CSS inline
 *                   (.center absolute), JavaScript DOMContentLoaded, AppToast, Alerta, AntiForgeryToken, data-ftx-loading
 * ðŸ“ OBSERVAÃ‡Ã•ES  : 108 linhas. **DUPLICAÃ‡ÃƒO PROBLEMÃTICA**: ExibePDFPenalidade.cshtml Ã© QUASE IDÃŠNCTICO a
 *                   ExibePDFComprovante.cshtml. **ÃšNICAS DIFERENÃ‡AS** (sÃ³ 3 posiÃ§Ãµes diferentes!):
 *                   1. **Nome arquivo**: ExibePDFPenalidade vs ExibePDFComprovante
 *                   2. **Model**: ExibePDFPenalidadeModel vs ExibePDFComprovanteModel
 *                   3. **AntiForgeryToken posiÃ§Ã£o**: linha 23 (DENTRO form) vs linha 2 (FORA form)
 *                   **TODO O RESTO Ã‰ IDÃŠNCTICO** (linhas 1-108):
 *                   - ViewData: MESMA (Title, PageName, Heading, Category1, PageIcon)
 *                   - CSS inline: MESMA (.center absolute)
 *                   - Form: MESMA (asp-action="Upsert", onkeypress, enctype)
 *                   - BotÃ£o voltar: MESMO (./ListaPenalidade)
 *                   - H2 text: MESMO ("Registro de Pagamento da InfraÃ§Ã£o nÂº")
 *                   - ejs-pdfviewer: MESMO (id, serviceUrl, documentPath)
 *                   - JavaScript: MESMO (stopEnterSubmitting, DOMContentLoaded, arquivoPdf, caminho, ej2_instances,
 *                     pdfViewer.load, AppToast, Alerta) **exceto string error handlers "ExibePDFPenalidade.cshtml"**
 *                   - Bootstrap CDN: MESMO (redundante)
 *                   - **Campo PDF CARREGADO**: MESMO Model.MultaObj?.Multa?.ComprovantePDF!! (NÃƒO diferente!)
 *                   **ANÃLISE**: Provavelmente copypaste error. ExibePDFComprovante e ExibePDFPenalidade deveriam
 *                   carregar MESMOS PDFs (comprovantes pagamento), entÃ£o duplicaÃ§Ã£o Ã© desnecessÃ¡ria. OU um dos arquivos
 *                   deveria carregar campo DIFERENTE (ex: PenalidadePDF, NotificacaoPenalidade, etc) mas estÃ¡
 *                   usando ComprovantePDF nos 2. **AÃ‡ÃƒO RECOMENDADA**: DELETE um dos arquivos (provavelmente
 *                   ExibePDFPenalidade), consolidar em um sÃ³ ExibePDFComprovante, ou corrigir campo carregado
 *                   se devem ser PDFs diferentes. ViewData config (IDÃŠNCTICA ExibePDFComprovante):
 *                   - Title: "Pagamento da Penalidade"
 *                   - PageName: "notificacao_index" (ERRADO! deve ser "multa_exibepdfpenalidade")
 *                   - Heading: "<i class='fa-duotone fa-cash-register'></i> InfraÃ§Ãµes: <span class='fw-300'>Registro de Pagamento da Penalidade - PDF</span>"
 *                   - Category1: "InfraÃ§Ãµes"
 *                   - PageIcon: "fa-duotone fa-cash-register"
 *                   Estrutura IDÃŠNCTICA ExibePDFComprovante (ver documentaÃ§Ã£o completa lÃ¡). **PROBLEMAS IDÃŠNCTICOS**:
 *                   1. PageName "notificacao_index" ERRADO
 *                   2. Form asp-action="Upsert" NÃƒO faz sentido (sÃ³ visualiza)
 *                   3. Enctype multipart/form-data NÃƒO usado
 *                   4. Bootstrap CDN redundante
 *                   5. **DUPLICAÃ‡ÃƒO TOTAL ExibePDFComprovante** (DELETE ou diferenciar)
 **************************************************************************************** *@
@page
@model FrotiX.Pages.Multa.ExibePDFPenalidadeModel

@{
	ViewData["Title"] = "Pagamento da Penalidade";
	ViewData["PageName"] = "notificacao_index";
	ViewData["Heading"] = "<i class='fa-duotone fa-cash-register'></i> InfraÃ§Ãµes: <span class='fw-300'>Registro de Pagamento da Penalidade - PDF</span>";
	ViewData["Category1"] = "InfraÃ§Ãµes";
	ViewData["PageIcon"] = "fa-duotone fa-cash-register";
}

@section HeadBlock {
	<style>
		.center {
			position: absolute;
			left: 50%;
			top: 30px;
			transform: translate(-50%, -50%);
			padding: 10px;
		}
	</style>
}

<form method="post" asp-action="Upsert" onkeypress="stopEnterSubmitting(window.event)" enctype="multipart/form-data">
	@Html.AntiForgeryToken()

	<div class="row">
		<div class="col-xl-12">
			<div id="panel-1" class="panel">
				<div class="panel-container show">
					<br />
					<div class="col-12 col-md-4 center">
						<a asp-page="./ListaPenalidade" class="btn btn-voltar form-control" data-ftx-loading>
							<i class="fa-duotone fa-rotate-left icon-space icon-rotate-left"></i>
							Voltar Ã  Lista
						</a>
					</div>

					<br />
					<div class="col-12 px-3" style="border-bottom:1px solid #325d88">
						<h2 class="text-primary">
							@($"Registro de Pagamento da InfraÃ§Ã£o nÂº: {Model.MultaObj?.Multa?.NumInfracao}")
						</h2>
					</div>

					<div id="divPainel" class="panel-content">
						<div id="pdfContainer" style="height: 800px;">
							<ejs-pdfviewer id="pdfViewer"
										   style="height:100%"
										   serviceUrl="/api/PdfViewer"
										   documentPath="">
							</ejs-pdfviewer>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</form>

@section ScriptsBlock {
	
	

	<script>
		// Evita submit ao pressionar ENTER em inputs
		function stopEnterSubmitting(e) {
			try {
				e = e || window.event;
				if (e && (e.key === "Enter" || e.keyCode === 13)) {
					const src = e.target || e.srcElement;
					if (src && src.tagName && src.tagName.toLowerCase() !== "div") {
						if (e.preventDefault) e.preventDefault();
						else e.returnValue = false;
					}
				}
			}
			catch (error) {
				Alerta.TratamentoErroComLinha("ExibePDFPenalidade.cshtml", "stopEnterSubmitting", error);
			}
		}

		document.addEventListener('DOMContentLoaded', function () {
			try {
				var arquivoPdf = '@(Model.MultaObj?.Multa?.ComprovantePDF ?? "")';

				if (!arquivoPdf) {
					AppToast.show('Arquivo de comprovante nÃ£o encontrado para esta infraÃ§Ã£o.', 'Vermelho', 3000);
					document.getElementById('pdfContainer').innerHTML = "<div class='alert alert-danger text-center mt-5'>PDF nÃ£o disponÃ­vel.</div>";
					return;
				}

				var caminho = "/DadosEditaveis/Multas/" + arquivoPdf;
				var pdfViewer = document.getElementById('pdfViewer').ej2_instances[0];

				if (pdfViewer) {
					pdfViewer.load(caminho, null);
				}
				else {
					AppToast.show('Erro ao inicializar o visualizador de PDF.', 'Vermelho', 3000);
				}
			}
			catch (error) {
				Alerta.TratamentoErroComLinha("ExibePDFPenalidade.cshtml", "DOMContentLoaded", error);
			}
		});
	</script>
}

