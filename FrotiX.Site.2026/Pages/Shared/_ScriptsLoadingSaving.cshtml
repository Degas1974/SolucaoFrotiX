@* ****************************************************************************************
 * ‚ö° ARQUIVO: Pages/Shared/_ScriptsLoadingSaving.cshtml
 * --------------------------------------------------------------------------------------
 * üéØ OBJETIVO     : Script JavaScript inline CR√çTICO para carregar/salvar configura√ß√µes de
 *                   tema (themeSettings) do localStorage ANTES da renderiza√ß√£o para evitar FOUC
 *                   (Flash Of Unstyled Content). Aplica classes CSS e link tema dinamicamente.
 * üì• ENTRADAS     : localStorage.getItem('themeSettings') JSON string { themeURL, themeOptions },
 *                   document.getElementsByTagName("BODY")[0], execu√ß√£o imediata no <body> top
 * üì§ SA√çDAS       : classHolder.className = themeOptions (aplica classes nav-/header-/footer-/mod-/display-
 *                   no body), createElement <link id="mytheme"> com themeURL href (CSS din√¢mico),
 *                   console.log success/warning, fun√ß√µes globais saveSettings() e resetSettings()
 * üîó CHAMADA POR  : Pages/Shared/_Layout.cshtml (OBRIGAT√ìRIO logo ap√≥s <body> tag), executado inline
 *                   antes de qualquer CSS/JS externo para prevenir FOUC
 * üîÑ CHAMA        : localStorage.getItem/setItem/removeItem, JSON.parse/stringify (com try-catch
 *                   tolerante a JSON corrompido), document.createElement('link'), appendChild(<head>),
 *                   getElementById('mytheme'), String.split/filter/join (regex /^(nav|header|footer|mod|display)-/i),
 *                   console.log/warn
 * üì¶ DEPEND√äNCIAS : JavaScript nativo (ES5+), localStorage API, DOM API (createElement, getElementById,
 *                   appendChild), JSON API, Regex, nenhuma depend√™ncia externa (pure JS)
 * üìù OBSERVA√á√ïES  : 62 linhas. Script FUNDAMENTAL SmartAdmin theme system - N√ÉO REMOVER! Comentado
 *                   "should be placed right after body tag for fast execution". 'use strict' mode.
 *                   **CUSTOMIZA√á√ÉO FROTIX**: try-catch com console.warn "‚ö†Ô∏è themeSettings corrompido no localStorage"
 *                   + localStorage.removeItem (linha 15-20) - N√ÉO estava no SmartAdmin original (adi√ß√£o FrotiX
 *                   para robustez). L√≥gica:
 *                   1. Carrega themeSettings JSON do localStorage
 *                   2. Parse com try-catch (se corrompido limpa e volta default)
 *                   3. Aplica classHolder.className = themeOptions (classes CSS tema)
 *                   4. Se themeURL existe cria <link id="mytheme"> ou atualiza href
 *                   5. Exp√µe fun√ß√µes globais saveSettings() e resetSettings()
 *                   saveSettings(): filtra classes body com regex /^(nav|header|footer|mod|display)-/i,
 *                   junta com espa√ßo, salva no localStorage. resetSettings(): limpa localStorage.
 *                   Console logs: verde "‚úî Theme settings loaded" ou vermelho "‚úî Heads up! loading default".
 *                   <link id="mytheme"> carrega CSS din√¢mico (dark/light themes). Pure JavaScript
 *                   (sem jQuery/thirdparty) para velocidade m√°xima.
 **************************************************************************************** *@
<script>
	/**
	 *	This script should be placed right after the body tag for fast execution 
	 *	Note: the script is written in pure javascript and does not depend on thirdparty library
	 **/
	'use strict';
var classHolder = document.getElementsByTagName("BODY")[0],
    /** 
     * Load from localstorage (tolerante a JSON corrompido)
     **/
    rawThemeSettings = localStorage.getItem('themeSettings'),
    themeSettings = {},
    themeURL = '',
    themeOptions = '';

try {
    themeSettings = rawThemeSettings ? JSON.parse(rawThemeSettings) : {};
} catch (e) {
    console.warn("‚ö†Ô∏è themeSettings corrompido no localStorage. Limpando e voltando ao padr√£o.", e);
    localStorage.removeItem('themeSettings');
    themeSettings = {};
}

themeURL = themeSettings.themeURL || '';
themeOptions = themeSettings.themeOptions || '';
	/** 
	 * Load theme options
	 **/
	if (themeSettings.themeOptions) {
		classHolder.className = themeSettings.themeOptions;
		console.log("%c‚úî Theme settings loaded", "color: #148f32");
	} else {
		console.log("%c‚úî Heads up! Theme settings is empty or does not exist, loading default settings...", "color: #ed1c24");
	}
	if (themeSettings.themeURL && !document.getElementById('mytheme') ) {
		var cssfile  = document.createElement('link');
			cssfile.id = 'mytheme';
			cssfile.rel  = 'stylesheet';
			cssfile.href = themeURL;
			document.getElementsByTagName('head')[0].appendChild(cssfile);
	} else if (themeSettings.themeURL && document.getElementById('mytheme')) {
		document.getElementById('mytheme').href = themeSettings.themeURL;
	} 
	/** 
	 * Save to localstorage 
	 **/
	var saveSettings = function (){
		themeSettings.themeOptions =  String(classHolder.className).split(/[^\w-]+/).filter(function(item) {
			return /^(nav|header|footer|mod|display)-/i.test(item);
		}).join(' ');
		if ( document.getElementById('mytheme') ){ 
			themeSettings.themeURL = document.getElementById('mytheme').getAttribute("href"); 
		};
		localStorage.setItem( 'themeSettings', JSON.stringify(themeSettings) );
	}
	/** 
	 * Reset settings
	 **/
	var resetSettings = function (){
		localStorage.setItem("themeSettings", "");
	}
</script>
