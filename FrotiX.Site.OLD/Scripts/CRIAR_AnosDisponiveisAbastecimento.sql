/****************************************************************************************
 * ๐ง SCRIPT: Criar Tabela AnosDisponiveisAbastecimento
 * --------------------------------------------------------------------------------------
 * Descriรงรฃo: Cria a รบnica tabela faltante no banco Frotix
 *
 * Autor: Claude Sonnet 4.5 (FrotiX Team)
 * Data: 13/02/2026
 ****************************************************************************************/

USE Frotix;
GO

SET NOCOUNT ON;
GO

PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';
PRINT '๐ง CRIANDO TABELA: AnosDisponiveisAbastecimento';
PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';
PRINT '';
PRINT 'โฐ Inรญcio: ' + CONVERT(VARCHAR, GETDATE(), 120);
PRINT '';

-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
-- VERIFICAR SE A TABELA Jร EXISTE
-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

IF EXISTS (SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'AnosDisponiveisAbastecimento' AND TABLE_SCHEMA = 'dbo')
BEGIN
    PRINT 'โ Tabela jรก existe: AnosDisponiveisAbastecimento';
    PRINT '';
    PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';
    SET NOCOUNT OFF;
    RETURN;
END

PRINT '๐ง Criando tabela: AnosDisponiveisAbastecimento...';
PRINT '';

-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
-- CRIAR TABELA
-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

CREATE TABLE dbo.AnosDisponiveisAbastecimento (
  Ano int NOT NULL,
  TotalAbastecimentos int NULL,
  PrimeiraData datetime2 NULL,
  UltimaData datetime2 NULL,
  DataUltimaAtualizacao datetime2 NULL,
  CONSTRAINT PK_AnosDisponiveisAbastecimento PRIMARY KEY CLUSTERED (Ano)
)
ON [PRIMARY];

PRINT 'โ Tabela criada: AnosDisponiveisAbastecimento';
PRINT '';

-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
-- CRIAR รNDICE
-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

CREATE INDEX IX_AnosDisponiveisAbastecimento_UltimaData
  ON dbo.AnosDisponiveisAbastecimento (UltimaData DESC)
  INCLUDE (Ano, TotalAbastecimentos)
  ON [PRIMARY];

PRINT 'โ รndice criado: IX_AnosDisponiveisAbastecimento_UltimaData';
PRINT '';

-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
-- VALIDAรรO FINAL
-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

PRINT '๐ Validando criaรงรฃo...';
PRINT '';

DECLARE @ColunasCriadas INT;
SELECT @ColunasCriadas = COUNT(*)
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'AnosDisponiveisAbastecimento'
  AND TABLE_SCHEMA = 'dbo';

PRINT '   ๐ Colunas criadas: ' + CAST(@ColunasCriadas AS VARCHAR) + '/5';

IF @ColunasCriadas = 5
    PRINT '   โ Estrutura validada com sucesso!';
ELSE
    PRINT '   โ๏ธ  ATENรรO: Nรบmero de colunas diferente do esperado!';

PRINT '';

-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
-- RESUMO FINAL
-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';
PRINT 'โ CRIAรรO CONCLUรDA COM SUCESSO!';
PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';
PRINT '';
PRINT '๐ Tabela criada:';
PRINT '   โ dbo.AnosDisponiveisAbastecimento (5 colunas)';
PRINT '   โ PK: PK_AnosDisponiveisAbastecimento';
PRINT '   โ IX: IX_AnosDisponiveisAbastecimento_UltimaData';
PRINT '';
PRINT '๐ Prรณximos passos:';
PRINT '   1. Executar validaรงรฃo das 9 tabelas';
PRINT '   2. Corrigir modelos C# conforme AUDITORIA_BANCO_REAL_VS_MODELOS.md';
PRINT '';
PRINT 'โฐ Fim: ' + CONVERT(VARCHAR, GETDATE(), 120);
PRINT '';
PRINT 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ';

SET NOCOUNT OFF;
GO
