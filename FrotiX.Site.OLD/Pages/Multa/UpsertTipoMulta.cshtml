@* ****************************************************************************************
 * ‚ö° ARQUIVO: Pages/Multa/UpsertTipoMulta.cshtml
 * --------------------------------------------------------------------------------------
 * üéØ OBJETIVO     : Formul√°rio criar/editar tipo de multa/infra√ß√£o (CTB - C√≥digo de Tr√¢nsito Brasileiro)
 * üì• ENTRADAS     : @page, @model UpsertTipoMultaModel, campos: Artigo, Infracao (select gravidade), CodigoDenatran (inputmask 999-9), Desdobramento, Descricao (RTE Syncfusion)
 * üì§ SA√çDAS       : POST (handler=Submit), redirect para ListaTiposMulta
 * üîó CHAMADA POR  : ListaTiposMulta (bot√£o "Nova Infra√ß√£o", editar linha)
 * üîÑ CHAMA        : (assumido) /Multa/UpsertTipoMulta handler, /api/Viagem/SaveImage (RTE upload), ~/js/jquery.inputmask.js, ./ListaTiposMulta
 * üì¶ DEPEND√äNCIAS : Syncfusion.EJ2 (RichTextEditor), jquery.inputmask.js, Bootstrap (impl√≠cito), Font Awesome Duotone, Alerta.TratamentoErroComLinha (custom)
 * üìù OBSERVA√á√ïES  : Total: 133 linhas. LEVE: Arquivo enxuto e bem estruturado - bom exemplo, CSS inline: ZERO (usa classes do layout) - excelente, JavaScript inline m√≠nimo (24 linhas) - apenas inputmask e toolbarClick - aceit√°vel, InputMask no CodigoDenatran (999-9) - padr√£o Denatran correto, RTE Syncfusion: usa toolbarClick para antiforgery token em upload imagem - seguran√ßa OK, Try-catch em todos os handlers - padr√£o de erro consistente, MELHORIAS: Valida√ß√£o client-side do formato Denatran (al√©m do inputmask), Select Infra√ß√£o: hardcoded 4 op√ß√µes (Grav√≠ssima, Grave, M√©dia, Leve) - correto para CTB
 **************************************************************************************** *@
@page
@addTagHelper*, Microsoft.AspNetCore.Mvc.TagHelpers
@using Syncfusion.EJ2

@model FrotiX.Pages.Multa.UpsertTipoMultaModel

@{
    var isEdit = Model.TipoMultaObj.TipoMultaId != Guid.Empty;
    ViewData["Title"] = "C√≥digo de Tr√¢nsito Brasileiro";
    ViewData["PageName"] = "multa_upserttipomulta";
    ViewData["Heading"] = "<i class='fa-duotone fa-ballot-check'></i> Cadastros: <span class='fw-300'>C√≥digo de Tr√¢nsito - Tipos de Multa</span>";
    ViewData["Category1"] = "Cadastros";
    ViewData["PageIcon"] = "fa-duotone fa-ballot-check";
}

<form method="post" asp-action="Upsert">
    @Html.AntiForgeryToken()

    <div class="row">
        <div class="col-xl-12">
            <div id="panel-1" class="panel">
                <div class="panel-container show">

                    <!-- HEADER PADR√ÉO FROTIX -->
                    <div class="ftx-card-header">
                        <h2 class="titulo-paginas">
                            <i class="fa-duotone fa-ballot-check"></i>
                            @(isEdit ? "Editar" : "Nova") Infra√ß√£o de Tr√¢nsito
                        </h2>
                        <div class="ftx-card-actions">
                            <a asp-page="./ListaTiposMulta" class="btn btn-fundo-laranja" data-ftx-loading>
                                <i class="fa-duotone fa-rotate-left icon-space icon-rotate-left"></i>
                                Voltar √† Lista
                            </a>
                        </div>
                    </div>

                    <!-- CONTE√öDO -->
                    <div class="panel-content">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                        @if (isEdit)
                        {
                            <input type="hidden" asp-for="TipoMultaObj.TipoMultaId" />
                        }

                        <div class="row g-3">
                            <!-- Artigo -->
                            <div class="col-md-9">
                                <div class="form-group">
                                    <label class="form-label fw-bold" asp-for="TipoMultaObj.Artigo"></label>
                                    <span class="text-danger" asp-validation-for="TipoMultaObj.Artigo"></span>
                                    <input class="form-control" asp-for="TipoMultaObj.Artigo" data-ejtip="Artigo do C√≥digo de Tr√¢nsito" />
                                </div>
                            </div>

                            <!-- Infra√ß√£o -->
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label fw-bold" asp-for="TipoMultaObj.Infracao"></label>
                                    <span class="text-danger" asp-validation-for="TipoMultaObj.Infracao"></span>
                                    <select class="form-control" asp-for="TipoMultaObj.Infracao" data-ejtip="Gravidade da Infra√ß√£o">
                                        <option value="">-- Infra√ß√£o --</option>
                                        <option value="Grav√≠ssima">Grav√≠ssima</option>
                                        <option value="Grave">Grave</option>
                                        <option value="M√©dia">M√©dia</option>
                                        <option value="Leve">Leve</option>
                                    </select>
                                </div>
                            </div>

                            <!-- C√≥digo Denatran -->
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label fw-bold" asp-for="TipoMultaObj.CodigoDenatran"></label>
                                    <span class="text-danger" asp-validation-for="TipoMultaObj.CodigoDenatran"></span>
                                    <input id="txtDenatran" class="form-control" asp-for="TipoMultaObj.CodigoDenatran" data-ejtip="C√≥digo Denatran" />
                                </div>
                            </div>

                            <!-- Desdobramento -->
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label fw-bold" asp-for="TipoMultaObj.Desdobramento"></label>
                                    <span class="text-danger" asp-validation-for="TipoMultaObj.Desdobramento"></span>
                                    <input class="form-control" asp-for="TipoMultaObj.Desdobramento" data-ejtip="Desdobramento da Infra√ß√£o" />
                                </div>
                            </div>

                            <!-- Descri√ß√£o -->
                            <div class="col-12">
                                <div class="form-group">
                                    <label class="form-label fw-bold">Descri√ß√£o da Multa</label>
                                    <textarea id="rte" name="TipoMultaObj.Descricao" style="width: 100%; height: 200px;">@(Model.TipoMultaObj?.Descricao ?? "")</textarea>
                                    <div id="errorMessage">
                                        <span class="text-danger" asp-validation-for="@Model.TipoMultaObj.Descricao"></span>
                                    </div>
                                </div>
                            </div>

                            <!-- Bot√µes -->
                            <div class="col-12 mt-4">
                                <div class="d-flex gap-2">
                                    <button type="submit" value="Submit" asp-page-handler="Submit" class="btn btn-azul btn-submit-spin px-4">
                                        <i class="fa-duotone fa-floppy-disk icon-space icon-pulse"></i>
                                        @(isEdit ? "Atualizar Infra√ß√£o" : "Criar Infra√ß√£o")
                                    </button>
                                    <a asp-page="./ListaTiposMulta" class="btn btn-ftx-fechar px-4" data-ftx-loading>
                                        <i class="fa-duotone fa-circle-xmark icon-space icon-pulse"></i>
                                        Cancelar Opera√ß√£o
                                    </a>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

@section ScriptsBlock {
    <script src="~/js/jquery.inputmask.js" asp-append-version="true"></script>

    <script asp-append-version="true">
        $(document).ready(function () {
            try {
                $("#txtDenatran").inputmask("999-9");
            } catch (error) {
                Alerta.TratamentoErroComLinha("UpsertTipoMulta.cshtml", "document.ready", error);
            }
        });

        function toolbarClick(e) {
            // [KENDO] Fun√ß√£o mantida como stub vazio - n√£o √© mais necess√°ria com Kendo Editor
        }

        // [KENDO] Inicializa√ß√£o do Kendo Editor para descri√ß√£o do tipo de multa
        $("#rte").kendoEditor({
            tools: ["bold","italic","underline","strikethrough","separator","justifyLeft","justifyCenter","justifyRight","justifyFull","separator","insertUnorderedList","insertOrderedList","separator","indent","outdent","separator","createLink","unlink","separator","fontName","fontSize","separator","foreColor","backColor","separator","cleanFormatting","separator","viewHtml"],
            resizable: { content: true, toolbar: false }
        });
    </script>
}
