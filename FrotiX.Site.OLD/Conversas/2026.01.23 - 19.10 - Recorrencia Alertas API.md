# Conversa: Recorrência de Alertas via API (Tipos 4-8)

> **Data/Hora Início**: 23/01/2026 - 19:10
> **Data/Hora Término**: 23/01/2026 - 19:40
> **Participantes**: Usuário + GitHub Copilot (GPT-5.2-Codex)

---

## Resumo Executivo

Padronizada a geração de alertas recorrentes via API para os tipos 4–8, alinhando a lógica com o padrão da Agenda e com o armazenamento de dias da semana por colunas booleanas (Monday…Sunday). Agora, o endpoint cria um alerta por data gerada e vincula a série pelo `RecorrenciaAlertaId`.

---

## Solicitação do Usuário

- Usar a API para salvar a recorrência.
- Explicar os tipos 4–7.
- Confirmar se os dias seguem string ou boolean como na Agenda.

---

## Arquivos Criados/Modificados

### Modificados

1. **Controllers/AlertasFrotiXController.cs**
   - Implementada geração de datas para tipos 4–8.
   - Criação de um alerta por data (incluindo `RecorrenciaAlertaId`).
   - `DiasSemana` no DTO agora aceita lista de inteiros e converte para string CSV.
   - Flags booleanas de dias (Monday…Sunday) aplicadas conforme a recorrência.

2. **Documentacao/Controllers/AlertasFrotiXController.md**
   - Documentada a recorrência na API (tipos 4–8) e o formato de `DiasSemana`.

3. **Documentacao/Pages/AlertasFrotiX - Upsert.md**
   - Atualização da lógica de backend para refletir a recorrência via API.
   - Registro no log de modificações.

---

## Decisões Técnicas

- **Recorrência via API**: unificou o comportamento para tipos 4–8, gerando datas no backend.
- **Dias da semana**: seguiu o padrão da Agenda/Viagem (colunas booleanas), armazenando também CSV em `DiasSemana`.
- **Sem alteração de banco**: o schema já contém colunas necessárias.

---

## Testes Necessários

- [ ] Criar alerta recorrente diário (tipo 4) e verificar criação em série.
- [ ] Criar alerta semanal (tipo 5) com dias específicos.
- [ ] Criar alerta quinzenal (tipo 6) e validar intervalo.
- [ ] Criar alerta mensal (tipo 7) com dia fixo do mês.
- [ ] Criar alerta de dias variados (tipo 8).
- [ ] Verificar criação de vínculos por `RecorrenciaAlertaId`.
- [ ] Verificar badges/SignalR após criação em lote.

---

## Observações

- O frontend já envia `DiasSemana` como lista de inteiros (0=Dom, 1=Seg, ... 6=Sáb).
- O backend converte para CSV e aplica flags booleanas.

---

**Última atualização**: 23/01/2026 - 19:40
**Status**: ✅ Concluído
**Versão**: 1.0
