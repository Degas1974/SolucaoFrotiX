# 2026.01.18 - Data Final Recorrência no Modal de Agendamento

## Resumo Executivo

- Corrigido o preenchimento da Data Final Recorrência no primeiro load do modal de edição, com fallback para campo texto readonly em todos os tipos de recorrência.
- Ajustado o reset do modal para restaurar o wrapper do DatePicker após fechar/limpar.
- Atualizada documentação técnica e gerada versão HTML A4 das páginas alteradas.
- Adicionado toggle global para forçar texto readonly ou DatePicker no preenchimento da Data Final Recorrência.
- Centralizada a configuração do toggle no `state.js`, com suporte a variáveis de ambiente e botão dev-only.
- Reforçada a ocultação do DatePicker em `recorrencia-logic.js` e ajustado o CSS do texto readonly para centralização real.
- Reavaliada a visibilidade do DatePicker ao exibir recorrência nas funções de configuração de `exibe-viagem.js`.
- Forçado texto readonly em modo edição e alinhamento à esquerda no modal.
- Adicionada classe de ocultação para impedir o wrapper Syncfusion de reaparecer no HTML final.
- Adicionado MutationObserver para manter o wrapper oculto mesmo após re-render do Syncfusion.
- Reduzida a largura do campo `txtFinalRecorrenciaTexto` para 50%.
- Ajustada validação para ler `txtFinalRecorrenciaTexto` em modo edição.
- Restringida a validação por texto readonly apenas para edição; novo agendamento volta a exigir o DatePicker.
- Corrigido fluxo de novo agendamento para ocultar `txtFinalRecorrenciaTexto` e restaurar DatePicker ao abrir o modal.
- Adicionado reset extra na criação de novo agendamento para evitar sobreposição após edição.
- Adicionada classe dedicada para ocultar o texto readonly e reforçar a troca edição → novo.

## Arquivos Alterados

- `wwwroot/js/agendamento/components/exibe-viagem.js` — helper unificado `preencherDataFinalRecorrencia` + aplicação em todos os fluxos de recorrência.
- `wwwroot/js/agendamento/components/modal-viagem-novo.js` — restauração do wrapper `.e-input-group` ao limpar o modal.
- `Documentacao/JavaScript/exibe-viagem.md` — log de mudança e versão 1.4.
- `Documentacao/JavaScript/modal-viagem-novo.md` — log de mudança e versão 1.8.
- `Documentacao/(JavaScript) exibe-viagem.jsA401.html` — documentação visual A4.
- `Documentacao/(JavaScript) modal-viagem-novo.jsA401.html` — documentação visual A4.
- `Pages/Agenda/Index.cshtml` — script de config global e botão dev-only no modal.
- `Pages/Agenda/Index.cshtml` — ajuste de CSS do campo `txtFinalRecorrenciaTexto`.
- `wwwroot/js/agendamento/components/recorrencia-logic.js` — alternância DatePicker/texto em `mostrarTxtFinalRecorrencia()`.
- `Documentacao/Pages/Agenda - Index.md` — log de mudança e versão 4.8.
- `Documentacao/Pages/Agenda - IndexA401.html` — documentação visual A4 da agenda.
- `Documentacao/JavaScript/exibe-viagem.md` — log de mudança e versão 1.6.
- `Documentacao/JavaScript/exibe-viagem.md` — log de mudança e versão 1.7.
- `wwwroot/js/agendamento/components/exibe-viagem.js` — chamada de `mostrarTxtFinalRecorrencia()` após exibir `divFinalRecorrencia`.
- `wwwroot/js/agendamento/components/exibe-viagem.js` — `preencherDataFinalRecorrencia()` prioriza texto em edição.
- `Pages/Agenda/Index.cshtml` — ajuste do alinhamento do campo `txtFinalRecorrenciaTexto`.
- `Documentacao/Pages/Agenda - Index.md` — log de mudança e versão 4.9.
- `Documentacao/Pages/Agenda - IndexA401.html` — atualização visual do alinhamento.
- `wwwroot/js/agendamento/components/exibe-viagem.js` — classe `ftx-ocultar-recorrencia-date` aplicada/removida.
- `wwwroot/js/agendamento/components/modal-viagem-novo.js` — limpeza da classe ao fechar modal.
- `Pages/Agenda/Index.cshtml` — CSS da classe de ocultação.
- `Documentacao/Pages/Agenda - Index.md` — log de mudança e versão 5.0.
- `Documentacao/JavaScript/exibe-viagem.md` — log de mudança e versão 1.9.
- `wwwroot/js/agendamento/components/exibe-viagem.js` — observer de ocultação persistente.
- `wwwroot/js/agendamento/components/modal-viagem-novo.js` — desativa observer ao fechar.
- `Documentacao/Pages/Agenda - Index.md` — log de mudança e versão 5.1.
- `Documentacao/JavaScript/exibe-viagem.md` — log de mudança e versão 2.0.
- `Pages/Agenda/Index.cshtml` — largura do texto readonly ajustada para 50%.
- `Documentacao/Pages/Agenda - Index.md` — log de mudança e versão 5.2.
- `Documentacao/JavaScript/exibe-viagem.md` — log de mudança e versão 2.1.
- `Documentacao/Pages/Agenda - IndexA401.html` — atualização visual de largura.
- `wwwroot/js/agendamento/components/validacao.js` — validação usa texto readonly em edição.
- `Documentacao/JavaScript/validacao.js.md` — log de mudança e versão 1.2.
- `Documentacao/Pages/Agenda - Index.md` — log de mudança e versão 5.3.
- `wwwroot/js/agendamento/components/validacao.js` — texto readonly só em edição.
- `Documentacao/JavaScript/validacao.js.md` — log de mudança e versão 1.3.
- `wwwroot/js/agendamento/components/modal-viagem-novo.js` — reset de campo texto/DatePicker ao abrir novo agendamento.
- `Documentacao/JavaScript/modal-viagem-novo.md` — log de mudança e versão 1.9.
- `Documentacao/(JavaScript) modal-viagem-novo.jsA401.html` — atualização visual.
- `wwwroot/js/agendamento/components/exibe-viagem.js` — reset de recorrência no fluxo de novo agendamento.
- `Documentacao/JavaScript/exibe-viagem.md` — log de mudança e versão 2.2.
- `Pages/Agenda/Index.cshtml` — classe `.ftx-ocultar-recorrencia-texto` aplicada ao campo texto readonly.
- `wwwroot/js/agendamento/components/exibe-viagem.js` — toggles da classe de ocultação do texto.
- `wwwroot/js/agendamento/components/modal-viagem-novo.js` — ocultação reforçada do texto em modo novo.
- `Documentacao/Pages/Agenda - Index.md` — log de mudança e versão 5.4.
- `Documentacao/JavaScript/exibe-viagem.md` — log de mudança e versão 2.3.
- `Documentacao/JavaScript/modal-viagem-novo.md` — log de mudança e versão 1.10.
- `Documentacao/Pages/Agenda - IndexA401.html` — atualização visual da nova classe.
- `Documentacao/(JavaScript) exibe-viagem.jsA401.html` — atualização visual.
- `Documentacao/(JavaScript) modal-viagem-novo.jsA401.html` — atualização visual.
- `wwwroot/js/agendamento/core/state.js` — leitura de config e handler do toggle.
- `Startup.cs` — leitura de variáveis de ambiente.

## Decisões Técnicas

- Preferir campo texto readonly em modo edição para garantir estabilidade visual quando o DatePicker Syncfusion não está pronto.
- Centralizar lógica de preenchimento em helper para reduzir duplicação e inconsistência entre tipos de recorrência.

## Pendências/Observações

- Monitorar se o DatePicker permanece único após alternar edição → novo.
