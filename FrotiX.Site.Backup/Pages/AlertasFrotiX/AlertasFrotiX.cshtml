@* ****************************************************************************************
 * âš¡ ARQUIVO: Pages/AlertasFrotiX/AlertasFrotiX.cshtml (850 linhas + JavaScript inline)
 * --------------------------------------------------------------------------------------
 * ğŸ¯ OBJETIVO     : Dashboard principal para gestÃ£o de alertas do sistema FrotiX com trÃªs abas (Inativos, Ativos, Meus Alertas)
 * ğŸ“¥ ENTRADAS     : @page, @model IndexModel, ViewData, SignalR Hub, API /api/Alertas/BuscaAlerta/{id}
 * ğŸ“¤ SAÃDAS       : HTML (trÃªs DataTables), modal visualizaÃ§Ã£o, SignalR notificaÃ§Ãµes toast, redirects /AlertasFrotiX/Upsert
 * ğŸ”— CHAMADA POR  : NavegaÃ§Ã£o principal (menu Cadastros), links diretos, notificaÃ§Ãµes de alertas
 * ğŸ”„ CHAMA        : ~/js/cadastros/alertas_gestao.js, /api/Alertas/BuscaAlerta (AJAX), /alertasHub (SignalR), /AlertasFrotiX/Upsert?id={AlertaId}
 * ğŸ“¦ DEPENDÃŠNCIAS : jQuery, DataTables, Bootstrap 5, Font Awesome Duotone, SignalR (@microsoft/signalr), Google Fonts Outfit, Alerta.TratamentoErroComLinha()
 * ğŸ“ OBSERVAÃ‡Ã•ES  : Total: 850 linhas. ISSUES: JavaScript inline ~150 linhas (deveria estar em alertas_gestao.js), tabs customizados sem acessibilidade (aria-selected, role="tabpanel"), CSS inline ~250 linhas duplicado, SignalR sem retry logic, DataTables sem state saving, modal statistics overflow sem limite altura
 *****************************************************************************************@
@page

@model FrotiX.Pages.AlertasFrotiX.IndexModel
@{
	ViewData["Title"] = "GestÃ£o de Alertas";
	ViewData["PageName"] = "alertasfrotix_alertasfrotix";
	ViewData["Heading"] = "<i class='fa-duotone fa-bell'></i> Sistema: <span class='fw-300'>Alertas</span>";
	ViewData["Category1"] = "Alertas";
	ViewData["PageIcon"] = "fa-duotone fa-bell";
}

@section HeadBlock {
	<style>
		/* ======== OUTLINE BRANCO NO BOTÃƒO DO HEADER (PadrÃ£o FrotiX) ======== */
		.ftx-card-header .btn-fundo-laranja {
			outline: 2px solid rgba(255, 255, 255, 0.5) !important;
			outline-offset: 1px;
			transition: all 0.2s ease;
		}

		.ftx-card-header .btn-fundo-laranja:hover {
			outline: 2px solid rgba(255, 255, 255, 0.8) !important;
			outline-offset: 2px;
		}

		/* BotÃ£o azul */
		.btn-azul {
			background-color: #0ea5e9;
			color: white;
			border: none;
			transition: all 0.3s ease;
		}

		.btn-azul:hover {
			background-color: #0284c7;
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
		}

		/* TÃ­tulo da pÃ¡gina */
		.titulo-pagina {
			color: #325d88;
			font-weight: 600;
		}

		/* Badges de tipo */
		.badge-tipo {
			font-size: 0.75rem;
			padding: 0.25rem 0.5rem;
			border-radius: 0.25rem;
			font-weight: 500;
		}

		.badge-agendamento {
			background-color: #0ea5e9;
			color: white;
		}

		.badge-manutencao {
			background-color: #f59e0b;
			color: white;
		}

		.badge-motorista {
			background-color: #14b8a6;
			color: white;
		}

		.badge-veiculo {
			background-color: #7c3aed;
			color: white;
		}

		.badge-anuncio {
			background-color: #dc2626;
			color: white;
		}

		.badge-aniversario {
			background-color: #ec4899;
			color: white;
		}

		/* Prioridades - PADRÃƒO BADGE */
		.badge-prioridade-ftx {
			font-size: 0.7rem;
			padding: 0.25rem 0.6rem;
			border-radius: 4px;
			font-weight: 700;
			text-transform: uppercase;
			display: inline-block;
			letter-spacing: 0.5px;
		}

		.prioridade-baixa {
			background-color: #dcfce7 !important;
			/* Verde mais claro */
			color: #166534 !important;
		}

		.prioridade-media {
			background-color: #fef3c7 !important;
			/* Creme mais escuro */
			color: #92400e !important;
		}

		.prioridade-alta {
			background-color: #722f37 !important;
			/* Vermelho vinho */
			color: white !important;
		}

		/* Custom Tab Badges */
		.badge-verde-militar {
			background-color: #5d6d31 !important;
			color: white !important;
		}

		.badge-laranja-sobrio {
			background-color: #d97706 !important;
			color: white !important;
		}

		/* BotÃ£o Olho (Azul PetrÃ³leo) */
		.btn-eye-frotix {
			background-color: #325d88 !important;
			color: white !important;
			border: none !important;
			transition: all 0.2s ease;
		}

		.btn-eye-frotix:hover {
			background-color: #264666 !important;
			color: white !important;
			transform: scale(1.05);
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
		}

		/* TABS CUSTOMIZADO - SEM DEPENDÃŠNCIA DE BOOTSTRAP JS */
		.nav-tabs-custom {
			border-bottom: 2px solid #e5e7eb;
			margin-bottom: 1.5rem;
		}

		.nav-tabs-custom .nav-link {
			color: #6b7280;
			border: none;
			padding: 0.75rem 1.5rem;
			font-weight: 500;
			transition: all 0.3s ease;
			border-bottom: 3px solid transparent;
			background: transparent;
			cursor: pointer;
		}

		.nav-tabs-custom .nav-link:hover {
			color: #0284c7;
			border-color: transparent;
			background: transparent;
		}

		.nav-tabs-custom .nav-link.active {
			color: #0ea5e9;
			border-bottom: 3px solid #0ea5e9;
			background: transparent;
		}

		/* Badges nas abas - COMPACTO */
		.nav-tabs-custom .badge {
			font-size: 0.7rem;
			padding: 0.15rem 0.4rem;
			margin-left: 0.5rem;
		}

		/* Tab panes */
		.tab-pane {
			display: none;
		}

		.tab-pane.active {
			display: block;
		}

		/* DataTable - COMPACTO */
		#tblAlertasLidos_wrapper .dataTables_filter input,
		#tblAlertasInativos_wrapper .dataTables_filter input,
		#tblMeusAlertas_wrapper .dataTables_filter input {
			border-radius: 0.25rem;
			border: 1px solid #d1d5db;
			padding: 0.375rem 0.75rem;
		}

		#tblAlertasLidos td,
		#tblAlertasLidos th,
		#tblAlertasInativos td,
		#tblAlertasInativos th,
		#tblMeusAlertas td,
		#tblMeusAlertas th {
			padding: 0.5rem;
			vertical-align: middle;
		}

		/* Borda colorida nos cards */
		.border-left-4 {
			border-left: 4px solid;
		}

		/* Timeline */
		.timeline-vertical {
			position: relative;
			padding-left: 40px;
		}

		.timeline-vertical::before {
			content: '';
			position: absolute;
			left: 15px;
			top: 0;
			bottom: 0;
			width: 2px;
			background: #dee2e6;
		}

		.timeline-item {
			position: relative;
			padding-bottom: 20px;
		}

		.timeline-item::before {
			content: '';
			position: absolute;
			left: -29px;
			top: 5px;
			width: 12px;
			height: 12px;
			border-radius: 50%;
			background: #fff;
			border: 2px solid #007bff;
		}

		.timeline-item.lido::before {
			background: #28a745;
			border-color: #28a745;
		}

		.timeline-item.nao-lido::before {
			background: #ffc107;
			border-color: #ffc107;
		}

		.timeline-item.apagado::before {
			background: #dc3545;
			border-color: #dc3545;
		}

		/* Cards */
		.card {
			transition: transform 0.3s ease, box-shadow 0.3s ease;
		}

		.card:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2) !important;
		}

		/* Progress bar */
		.progress-bar {
			transition: width 1s ease, background 0.3s ease;
		}

		.progress-bar.bg-danger {
			background: linear-gradient(90deg, #dc3545 0%, #c82333 100%);
		}

		.progress-bar.bg-warning {
			background: linear-gradient(90deg, #ffc107 0%, #e0a800 100%);
		}

		.progress-bar.bg-success {
			background: linear-gradient(90deg, #28a745 0%, #218838 100%);
		}

		/* Progress bar no modal - FINO */
		#progressoLeitura {
			height: 20px !important;
			line-height: 20px !important;
			font-size: 12px !important;
		}

		/* Remover card roxo do modal */
		.modal-body .card {
			background: none !important;
			box-shadow: none !important;
			border: none !important;
		}

		.modal-body .card-body {
			padding: 0 !important;
		}

		.modal-body .progress {
			height: 20px !important;
			background-color: #e9ecef !important;
		}

		/* BotÃ£o cor vinho */
		.btn-vinho-wine {
			background-color: #722f37 !important;
			border-color: #5a252c !important;
			color: white !important;
		}

		.btn-vinho-wine:hover {
			background-color: #5a252c !important;
			border-color: #4a1f24 !important;
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(114, 47, 55, 0.3);
		}

		.btn-vinho-wine:active,
		.btn-vinho-wine:focus {
			background-color: #4a1f24 !important;
			border-color: #3a1820 !important;
			box-shadow: 0 0 0 0.2rem rgba(114, 47, 55, 0.25);
		}

		/* Melhorar visual do botÃ£o fechar */
		#modalDetalhesAlerta .btn-vinho {
			background-color: #722f37;
			border-color: #722f37;
		}

		#modalDetalhesAlerta .btn-vinho:hover {
			background-color: #5a252c;
			border-color: #4a1f24;
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
		}
	</style>
}

<div class="row">
	<div class="col-xl-12">
		<div id="panel-1" class="panel">
			<!-- ===== HEADER FROTIX ===== -->
			<div class="ftx-card-header">
				<h2 class="titulo-paginas">
					<i class="fa-duotone fa-bell"></i>
					GestÃ£o de Alertas
				</h2>
				<div class="ftx-card-actions">
					<a href="./AlertasFrotiX/Upsert" class="btn btn-fundo-laranja" data-ftx-loading>
						<i class="fa-duotone fa-file-plus icon-pulse me-1"></i> Novo Alerta
					</a>
				</div>
			</div>

			<div class="panel-container show pt-4">
				<!-- Campo oculto com ID do usuÃ¡rio atual -->
				<input type="hidden" id="usuarioAtualId"
					value="@User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value" />

				<!-- TABS MANUAIS - SEM BOOTSTRAP JS -->
				<div class="px-3 mt-3">
					<!-- Nav tabs -->
					<ul class="nav nav-tabs nav-tabs-custom" id="alertasTabs" role="tablist">
						<li class="nav-item" role="presentation">
							<a class="nav-link active" href="#tabInativos" data-tab="tabInativos"
								data-ejtip="Alertas que jÃ¡ foram finalizados">
								<i class="fa-duotone fa-history me-2"></i>
								Alertas Inativos
								<span class="badge bg-secondary" id="badgeInativos">0</span>
							</a>
						</li>
						<li class="nav-item" role="presentation">
							<a class="nav-link" href="#tabAtivos" data-tab="tabAtivos"
								data-ejtip="Alertas atualmente ativos no sistema">
								<i class="fa-duotone fa-bell-on me-2"></i>
								Alertas Ativos
								<span class="badge badge-verde-militar" id="badgeAtivos">0</span>
							</a>
						</li>
						<li class="nav-item" role="presentation">
							<a class="nav-link" href="#tabMeusAlertas" data-tab="tabMeusAlertas"
								data-ejtip="Alertas que vocÃª recebeu">
								<i class="fa-duotone fa-user-circle me-2"></i>
								Meus Alertas
								<span class="badge badge-laranja-sobrio" id="badgeMeusAlertas">0</span>
							</a>
						</li>
					</ul>

					<!-- Tab panes -->
					<div class="tab-content" id="alertasTabsContent">
						<!-- Tab Alertas Inativos -->
						<div class="tab-pane active" id="tabInativos" role="tabpanel">
							<div class="panel-content pt-3">
								<div class="box-body">
									<table id="tblAlertasInativos" class="table table-bordered table-striped"
										width="100%">
										<thead>
											<tr>
												<th width="10%">Data InserÃ§Ã£o</th>
												<th width="3%">Ãcone</th>
												<th width="15%">TÃ­tulo</th>
												<th width="35%">DescriÃ§Ã£o</th>
												<th width="7%">Tipo</th>
												<th width="7%">Prioridade</th>
												<th width="10%">Data Baixa</th>
												<th width="8%">% Leitura</th>
												<th width="5%">AÃ§Ãµes</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>
							</div>
						</div>

						<!-- Tab Alertas Ativos -->
						<div class="tab-pane" id="tabAtivos" role="tabpanel">
							<div class="panel-content pt-3">
								<div class="box-body">
									<div id="alertasAtivosContainer" class="row">
										<!-- Cards de alertas ativos serÃ£o inseridos aqui via JavaScript -->
									</div>
								</div>
							</div>
						</div>

						<!-- Tab Meus Alertas -->
						<div class="tab-pane" id="tabMeusAlertas" role="tabpanel">
							<div class="panel-content pt-3">
								<div class="box-body">
									<table id="tblMeusAlertas" class="table table-bordered table-striped" width="100%">
										<thead>
											<tr>
												<th width="10%">Inserido Em</th>
												<th width="3%">Ãcone</th>
												<th width="15%">TÃ­tulo</th>
												<th width="25%">DescriÃ§Ã£o</th>
												<th width="7%">Tipo</th>
												<th width="7%">Notificado</th>
												<th width="10%">Notificado Em</th>
												<th width="7%">Lido</th>
												<th width="10%">Lido Em</th>
												<th width="6%">AÃ§Ãµes</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Modal Detalhes do Alerta -->
<div class="modal fade" id="modalDetalhesAlerta" tabindex="-1" role="dialog" aria-labelledby="modalDetalhesAlertaLabel"
	aria-hidden="true">
	<div class="modal-dialog modal-xl" role="document">
		<div class="modal-content">
			<!-- Header -->
			<div class="modal-header modal-header-terracota" id="alertaCabecalho">
				<div class="d-flex align-items-center w-100">
					<i class="fa-duotone fa-bell fa-3x text-primary mr-3" id="iconeAlerta"></i>
					<div class="flex-grow-1">
						<h5 class="modal-title mb-1" id="tituloAlerta">Carregando...</h5>
						<div>
							<span class="badge badge-primary mr-2" id="badgeTipo">Tipo</span>
							<span class="badge badge-danger mr-2" id="badgePrioridade">Prioridade</span>
							<span id="badgeStatus"></span>
						</div>
					</div>
				</div>
				<button type="button" class="close" data-bs-dismiss="modal" aria-label="Fechar"
					data-ejtip="Fechar Modal">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<!-- Body -->
			<div class="modal-body">
				<!-- Loader -->
				<div id="loaderDetalhes" class="text-center py-5">
					<i class="fa-duotone fa-spinner fa-spin fa-3x text-primary mb-3"></i>
					<p>Carregando detalhes do alerta...</p>
				</div>

				<!-- ConteÃºdo Principal -->
				<div id="conteudoDetalhes" style="display: none;">
					<!-- DescriÃ§Ã£o -->
					<div class="card mb-3">
						<div class="card-header bg-light">
							<i class="fa-duotone fa-info-circle"></i> DescriÃ§Ã£o
						</div>
						<div class="card-body">
							<p id="descricaoAlerta" class="mb-0"></p>
						</div>
					</div>

					<!-- InformaÃ§Ãµes Gerais -->
					<div class="row mb-3">
						<div class="col-md-6">
							<div class="card h-100">
								<div class="card-header bg-light">
									<i class="fa-duotone fa-calendar-alt"></i> InformaÃ§Ãµes Gerais
								</div>
								<div class="card-body">
									<p><strong>Data de CriaÃ§Ã£o:</strong> <span id="dataCriacao"></span></p>
									<p><strong>Data de ExibiÃ§Ã£o:</strong> <span id="dataExibicao"></span></p>
									<p><strong>Criado Por:</strong> <span id="criadoPor"></span></p>
									<p class="mb-0"><strong>Tempo no Ar:</strong> <span id="tempoNoAr"></span></p>
								</div>
							</div>
						</div>

						<div class="col-md-6">
							<div class="card h-100">
								<div class="card-header bg-light">
									<i class="fa-duotone fa-chart-bar"></i> Resumo das EstatÃ­sticas
								</div>
								<div class="card-body">
									<div class="row">
										<div class="col-6">
											<p class="mb-2">
												<i class="fa-duotone fa-users text-primary"></i>
												<strong>DestinatÃ¡rios:</strong> <span
													id="totalDestinatariosResumo">0</span>
											</p>
											<p class="mb-2">
												<i class="fa-duotone fa-bell text-info"></i>
												<strong>Notificados:</strong> <span id="totalNotificadosResumo">0</span>
											</p>
											<p class="mb-0">
												<i class="fa-duotone fa-clock text-warning"></i>
												<strong>Aguardando:</strong> <span
													id="aguardandoNotificacaoResumo">0</span>
											</p>
										</div>
										<div class="col-6">
											<p class="mb-2">
												<i class="fa-duotone fa-check-circle text-success"></i>
												<strong>Leram:</strong> <span id="usuariosLeramResumo">0</span>
											</p>
											<p class="mb-2">
												<i class="fa-duotone fa-times-circle text-danger"></i>
												<strong>NÃ£o Leram:</strong> <span id="usuariosNaoLeramResumo">0</span>
											</p>
											<p class="mb-0">
												<i class="fa-duotone fa-trash text-secondary"></i>
												<strong>Apagaram:</strong> <span id="usuariosApagaramResumo">0</span>
											</p>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- EstatÃ­sticas Detalhadas - 6 Cards -->
					<div class="mb-4">
						<h6 class="fw-bold mb-3">
							<i class="fa-duotone fa-chart-line"></i> EstatÃ­sticas Detalhadas
						</h6>
						<div class="row g-3">
							<!-- Total DestinatÃ¡rios -->
							<div class="col-md-4 col-lg-2">
								<div class="card border-primary shadow-sm h-100">
									<div class="card-body text-center py-3">
										<i class="fa-duotone fa-users fa-2x text-primary mb-2"></i>
										<h6 class="card-subtitle mb-2 text-muted small">Total DestinatÃ¡rios</h6>
										<h3 class="card-title mb-0" id="totalDestinatarios">0</h3>
									</div>
								</div>
							</div>

							<!-- Total Notificados -->
							<div class="col-md-4 col-lg-2">
								<div class="card border-info shadow-sm h-100">
									<div class="card-body text-center py-3">
										<i class="fa-duotone fa-bell fa-2x text-info mb-2"></i>
										<h6 class="card-subtitle mb-2 text-muted small">JÃ¡ Notificados</h6>
										<h3 class="card-title mb-0" id="totalNotificados">0</h3>
									</div>
								</div>
							</div>

							<!-- Aguardando NotificaÃ§Ã£o -->
							<div class="col-md-4 col-lg-2">
								<div class="card border-warning shadow-sm h-100">
									<div class="card-body text-center py-3">
										<i class="fa-duotone fa-clock fa-2x text-warning mb-2"></i>
										<h6 class="card-subtitle mb-2 text-muted small">Aguardando</h6>
										<h3 class="card-title mb-0" id="aguardandoNotificacao">0</h3>
									</div>
								</div>
							</div>

							<!-- Leram -->
							<div class="col-md-4 col-lg-2">
								<div class="card border-success shadow-sm h-100">
									<div class="card-body text-center py-3">
										<i class="fa-duotone fa-check-circle fa-2x text-success mb-2"></i>
										<h6 class="card-subtitle mb-2 text-muted small">Leram</h6>
										<h3 class="card-title mb-0" id="usuariosLeram">0</h3>
									</div>
								</div>
							</div>

							<!-- NÃ£o Leram -->
							<div class="col-md-4 col-lg-2">
								<div class="card border-danger shadow-sm h-100">
									<div class="card-body text-center py-3">
										<i class="fa-duotone fa-times-circle fa-2x text-danger mb-2"></i>
										<h6 class="card-subtitle mb-2 text-muted small">NÃ£o Leram</h6>
										<h3 class="card-title mb-0" id="usuariosNaoLeram">0</h3>
									</div>
								</div>
							</div>

							<!-- Apagaram -->
							<div class="col-md-4 col-lg-2">
								<div class="card border-secondary shadow-sm h-100">
									<div class="card-body text-center py-3">
										<i class="fa-duotone fa-trash fa-2x text-secondary mb-2"></i>
										<h6 class="card-subtitle mb-2 text-muted small">Apagaram</h6>
										<h3 class="card-title mb-0" id="usuariosApagaram">0</h3>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Progresso de Leitura -->
					<div class="card mb-3">
						<div class="card-header bg-light">
							<i class="fa-duotone fa-chart-line"></i> Progresso de Leitura
						</div>
						<div class="card-body">
							<div class="mb-2">
								<small class="text-muted" id="infoLeitores">Carregando...</small>
							</div>
							<div class="progress" style="height: 30px;">
								<div class="progress-bar progress-bar-striped progress-bar-animated"
									id="progressoLeitura" role="progressbar" aria-valuenow="0" aria-valuemin="0"
									aria-valuemax="100" style="width: 0%;">
									<span id="textoProgressoBarra">0%</span>
								</div>
							</div>
						</div>
					</div>

					<!-- Links Relacionados (se houver) -->
					<div class="card mb-3" id="linksRelacionados" style="display: none;">
						<div class="card-header bg-light">
							<i class="fa-duotone fa-link"></i> Links Relacionados
						</div>
						<div class="card-body" id="conteudoLinks">
							<!-- Links serÃ£o inseridos aqui via JS -->
						</div>
					</div>

					<!-- Tabela de UsuÃ¡rios que Receberam o Alerta -->
					<div class="card">
						<div class="card-header bg-light d-flex justify-content-between align-items-center">
							<span>
								<i class="fa-duotone fa-users"></i>
								UsuÃ¡rios que Receberam o Alerta
							</span>
							<button class="btn btn-sm btn-verde" id="btnExportarDetalhes" style="display: none;"
								data-ejtip="Exportar para Excel">
								<i class="fa-duotone fa-file-excel"></i> Exportar Excel
							</button>
						</div>
						<div class="card-body p-0">
							<div class="table-responsive">
								<table class="table table-striped table-sm table-hover mb-0">
									<thead class="table-dark">
										<tr>
											<th>UsuÃ¡rio</th>
											<th class="text-center">Notificado</th>
											<th class="text-center">Status Leitura</th>
											<th class="text-center">Data NotificaÃ§Ã£o</th>
											<th class="text-center">Data Leitura</th>
											<th class="text-center">Tempo atÃ© Leitura</th>
										</tr>
									</thead>
									<tbody id="tabelaUsuarios">
										<tr>
											<td colspan="6" class="text-center py-4">
												<div class="spinner-border spinner-border-sm text-primary"
													role="status">
													<span class="visually-hidden">Carregando...</span>
												</div>
												<span class="ms-2 text-muted">Carregando usuÃ¡rios...</span>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Footer com botÃµes -->
			<div class="modal-footer d-flex justify-content-between">
				<!-- BotÃ£o Baixa no Alerta - Esquerda -->
				<button type="button" class="btn btn-azul form-control" id="btnBaixaAlerta" style="max-width: 250px;"
					data-ejtip="Finalizar este alerta">
					<i class="fa-duotone fa-file-plus icon-space icon-pulse"></i>
					Dar Baixa no Alerta
				</button>

				<!-- BotÃµes Direita -->
				<div>
					<button type="button" class="btn btn-vinho form-control" data-bs-dismiss="modal"
						data-ejtip="Fechar Modal" style="max-width: 150px;">
						<i class="fa-duotone fa-circle-xmark icon-space"></i>
						Fechar
					</button>
				</div>
			</div>
		</div>
	</div>
</div>

@section ScriptsBlock {
	<script src="~/lib/microsoft-signalr/signalr.min.js" asp-append-version="true"></script>
	<script src="~/js/alertas/alertas_gestao.js" asp-append-version="true"></script>

	<script>
			/**
			 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
			 * SISTEMA DE TABS MANUAL - GESTÃƒO DE ALERTAS
			 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
			 * @@description Sistema de navegaÃ§Ã£o por tabs sem dependÃªncia de Bootstrap JS.
			 * Controla a exibiÃ§Ã£o de Alertas Inativos, Ativos e Meus Alertas.
			 * Carrega DataTables e alertas sob demanda conforme a tab visitada.
			 * @@requires alertas_gestao.js - FunÃ§Ãµes de carregamento de alertas
			* @@requires signalr.min.js - Para notificaÃ§Ãµes em tempo real
				*/
					(function () {
						'use strict';

				/**
				 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
				 * CONTROLE DE ESTADO DAS TABS
				 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
				 * @@description Rastreia quais tabs jÃ¡ foram visitadas para evitar
							* reinicializaÃ§Ã£o desnecessÃ¡ria de DataTables
								* @@type { Object.< string, boolean>}
						*/
				var tabsVisitadas = {
			tabInativos: false,
			tabAtivos: false,
			tabMeusAlertas: false
		};

				/**
				 * Alterna entre as tabs de alertas
				 * @@description Remove estado ativo das outras tabs, esconde seus painÃ©is,
				 * e ativa a tab selecionada.Carrega alertas ativos sob demanda.
				 * @@param { string } tabId - ID da tab a ser ativada(tabInativos, tabAtivos, tabMeusAlertas)
			*/
		function switchTab(tabId) {
			try {
				console.log('Trocando para tab:', tabId);

				// Remover active de todos os links
				document.querySelectorAll('.nav-tabs-custom .nav-link').forEach(function (link) {
					link.classList.remove('active');
				});

				// Esconder todos os tab-panes
				document.querySelectorAll('.tab-pane').forEach(function (pane) {
					pane.classList.remove('active');
				});

				// Ativar o link clicado
				var clickedLink = document.querySelector('.nav-link[data-tab="' + tabId + '"]');
				if (clickedLink) {
					clickedLink.classList.add('active');
				}

				// Mostrar o tab-pane correspondente
				var targetPane = document.getElementById(tabId);
				if (targetPane) {
					targetPane.classList.add('active');
				}

				// Carrega alertas ativos via AJAX quando a tab correspondente Ã© selecionada
				// NÃƒO recarregar DataTables automaticamente para evitar erro "abort"
				console.log('Tab ativada:', tabId);

				if (tabId === 'tabAtivos') {
					// SÃ³ os alertas ativos precisam recarregar
					if (typeof carregarAlertasGestao === 'function') {
						console.log('Carregando alertas ativos...');
						setTimeout(function () {
							carregarAlertasGestao();
						}, 150);
					}
				}

				// Registra a primeira visita Ã  tab (para controle de inicializaÃ§Ã£o)
				if (tabsVisitadas.hasOwnProperty(tabId)) {
					if (!tabsVisitadas[tabId]) {
						console.log('Primeira visita Ã  tab:', tabId);
						tabsVisitadas[tabId] = true;
					}
				}

				// DataTables NÃƒO serÃ£o recarregadas automaticamente
				// Elas jÃ¡ carregam na inicializaÃ§Ã£o e o usuÃ¡rio pode usar os controles da tabela
				// Isso evita o erro "abort" completamente
			} catch (error) {
				console.error('Erro ao trocar tab:', error);
				if (typeof Alerta !== 'undefined' && typeof Alerta.TratamentoErroComLinha === 'function') {
					Alerta.TratamentoErroComLinha("AlertasFrotiX.cshtml", "switchTab", error);
				}
			}
		}

				/**
				 * Inicializa o sistema de tabs manual
				 * @@description Marca a primeira tab como visitada e adiciona event listeners
			* a todos os links de navegaÃ§Ã£o para tratar cliques.
				 * Previne comportamento padrÃ£o do link e chama switchTab().
				 */
		function initTabs() {
			try {
				console.log('Inicializando sistema de tabs manual...');

				// Marcar primeira tab como visitada
				tabsVisitadas.tabInativos = true;

				// Adicionar event listeners nos links
				document.querySelectorAll('.nav-tabs-custom .nav-link').forEach(function (link) {
					link.addEventListener('click', function (e) {
						e.preventDefault();
						var tabId = this.getAttribute('data-tab');
						if (tabId) {
							switchTab(tabId);
						}
					});
				});

				console.log('âœ… Sistema de tabs manual inicializado!');
				console.log('âœ… Event listeners adicionados a', document.querySelectorAll('.nav-tabs-custom .nav-link').length, 'tabs');
			} catch (error) {
				console.error('Erro ao inicializar tabs:', error);
				if (typeof Alerta !== 'undefined' && typeof Alerta.TratamentoErroComLinha === 'function') {
					Alerta.TratamentoErroComLinha("AlertasFrotiX.cshtml", "initTabs", error);
				}
			}
		}

				/**
				 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
				 * INICIALIZAÃ‡ÃƒO DO SISTEMA DE TABS
				 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
				 * @@description Executa initTabs() quando o DOM estiver pronto ou
			* imediatamente se jÃ¡ estiver carregado.TambÃ©m adiciona
				* fallback no evento window.load para garantir inicializaÃ§Ã£o.
				 */
		// Executar quando o DOM estiver pronto
		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', initTabs);
		} else {
			initTabs();
		}

		// TambÃ©m executar quando a pÃ¡gina carregar completamente (fallback)
		window.addEventListener('load', function () {
			// Verificar se jÃ¡ foi inicializado
			var initialized = document.querySelector('.nav-tabs-custom .nav-link[data-initialized]');
			if (!initialized) {
				initTabs();
			}
		});
			}) ();
	</script>
}