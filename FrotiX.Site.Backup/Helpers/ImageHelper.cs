/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘ ğŸš€ ARQUIVO: ImageHelper.cs                                                                         â•‘
   â•‘ ğŸ“‚ CAMINHO: Helpers/                                                                              â•‘
   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
   â•‘ ğŸ¯ OBJETIVO DO ARQUIVO:                                                                            â•‘
   â•‘    UtilitÃ¡rios de manipulaÃ§Ã£o de imagens usando System.Drawing. Valida imagem e                   â•‘
   â•‘    redimensiona JPEG/PNG para dimensÃµes especÃ­ficas.                                               â•‘
   â•‘    âš ï¸ ATENÃ‡ÃƒO: [SupportedOSPlatform(\"windows\")] - funciona apenas em Windows.                    â•‘
   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
   â•‘ ğŸ“‹ MÃ‰TODOS DISPONÃVEIS:                                                                            â•‘
   â•‘    â€¢ IsImageValid(byte[] imageData)                                                                â•‘
   â•‘    â€¢ ResizeImage(byte[] imageData, int width, int height)                                          â•‘
   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
   â•‘ ğŸ”— DEPENDÃŠNCIAS: System.Drawing, System.Drawing.Drawing2D, System.Drawing.Imaging                  â•‘
   â•‘ ğŸ“… ATUALIZAÃ‡ÃƒO: 31/01/2026 | ğŸ‘¤ AUTOR: Copilot | ğŸ“ VERSÃƒO: 2.0                                    â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/

using System;
using System.Drawing;
using System.Drawing.Drawing2D;
using System.Drawing.Imaging;
using System.IO;
using System.Runtime.Versioning;

namespace FrotiX.Helpers
    {
    [SupportedOSPlatform("windows")]
    
    // â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
    // â”‚ ğŸ¯ CLASSE: ImageHelper                                                                       â”‚
    // â”‚ ğŸ“¦ TIPO: EstÃ¡tica                                                                             â”‚
    // â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
    
    
    // ğŸ¯ OBJETIVO:
    // Oferecer validaÃ§Ã£o e redimensionamento de imagens no backend (Windows-only).
    
    
    
    // ğŸ”— RASTREABILIDADE:
    // â¬…ï¸ CHAMADO POR : Uploads e fluxos de processamento de imagem
    // â¡ï¸ CHAMA       : System.Drawing (Image, Bitmap, Graphics)
    
    
    
    // âš ï¸ ATENÃ‡ÃƒO:
    // CompatÃ­vel apenas com Windows devido ao uso de System.Drawing.
    
    
    public static class ImageHelper
        {
        
        // â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
        // â”‚ âš¡ MÃ‰TODO: IsImageValid                                                             â”‚
        // â”‚ ğŸ”— RASTREABILIDADE:                                                                      â”‚
        // â”‚    â¬…ï¸ CHAMADO POR : ResizeImage()                                                       â”‚
        // â”‚    â¡ï¸ CHAMA       : Image.FromStream()                                                   â”‚
        // â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
        
        
        // ğŸ¯ OBJETIVO:
        // Verificar se um array de bytes representa uma imagem vÃ¡lida.
        
        
        
        // ğŸ“¥ PARÃ‚METROS:
        // imageData - Bytes da imagem.
        
        
        
        // ğŸ“¤ RETORNO:
        // bool - True se a imagem for vÃ¡lida; caso contrÃ¡rio, false.
        
        
        // Param imageData: Bytes da imagem.
        // Returns: True se a imagem for vÃ¡lida; caso contrÃ¡rio, false.
        public static bool IsImageValid(byte[] imageData)
            {
            try
                {
                using var ms = new MemoryStream(imageData);
                using var img = Image.FromStream(ms, false, true);
                return true;
                }
            catch
                {
                return false;
                }
            }

        
        // â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
        // â”‚ âš¡ MÃ‰TODO: ResizeImage                                                             â”‚
        // â”‚ ğŸ”— RASTREABILIDADE:                                                                      â”‚
        // â”‚    â¬…ï¸ CHAMADO POR : Uploads e fluxos de imagens                                         â”‚
        // â”‚    â¡ï¸ CHAMA       : IsImageValid(), Image.FromStream(), Bitmap.Save()                   â”‚
        // â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
        
        
        // ğŸ¯ OBJETIVO:
        // Redimensionar uma imagem JPEG/PNG e retornar o byte[] resultante.
        
        
        
        // ğŸ“¥ PARÃ‚METROS:
        // imageData - Bytes da imagem original
        // width - Largura desejada
        // height - Altura desejada
        
        
        
        // ğŸ“¤ RETORNO:
        // byte[] - Imagem redimensionada em formato JPEG, ou null se invÃ¡lida.
        
        
        // Param imageData: Bytes da imagem original.
        // Param width: Largura desejada.
        // Param height: Altura desejada.
        // Returns: Imagem redimensionada em formato JPEG, ou null se invÃ¡lida.
        public static byte[] ResizeImage(byte[] imageData, int width, int height)
            {
            if (imageData == null || imageData.Length == 0 || !IsImageValid(imageData))
                return null;

            try
                {
                using var inputStream = new MemoryStream(imageData);
                using var originalImage = Image.FromStream(inputStream);
                using var resizedImage = new Bitmap(width, height);
                using var graphics = Graphics.FromImage(resizedImage);

                graphics.CompositingQuality = CompositingQuality.HighSpeed;
                graphics.InterpolationMode = InterpolationMode.Low;
                graphics.CompositingMode = CompositingMode.SourceCopy;
                graphics.DrawImage(originalImage, 0, 0, width, height);

                using var outputStream = new MemoryStream();
                resizedImage.Save(outputStream, ImageFormat.Jpeg);
                return outputStream.ToArray();
                }
            catch (Exception ex)
                {
                Console.WriteLine($"[ImageHelper] Erro ao redimensionar imagem: {ex.Message}");
                return null;
                }
            }
        }
    }
