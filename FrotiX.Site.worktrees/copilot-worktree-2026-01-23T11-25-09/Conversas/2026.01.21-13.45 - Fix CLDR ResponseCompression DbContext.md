# Conversa: Fix CLDR, ResponseCompression e DbContext

> **Data:** 21/01/2026 13:45
> **Assunto:** Correções de erros de execução - CLDR Syncfusion, ResponseCompression e sintaxe

---

## Resumo

Sessão de correções de múltiplos erros que impediam a execução da aplicação:

### 1. CLDR Syncfusion pt-BR Completo
**Problema:** Erro "Format options or type given must be invalid" nos componentes DatePicker/Calendar Syncfusion na página AlertasFrotiX/Upsert.

**Solução:**
- Adicionada estrutura CLDR completa em `_ScriptsBasePlugins.cshtml` com:
  - `dayPeriods` (AM/PM, manhã, tarde, noite, madrugada)
  - `eras` (a.C., d.C., antes/depois de Cristo)
  - Formatos `narrow`, `short`, `wide` para meses e dias
  - `availableFormats` completo para formatação de datas
- Corrigido path do locale de `/../../locale/pt-BR.json` para `/locale/pt-BR.json` em `_Layout.cshtml`

### 2. ObjectDisposedException em Alerta.cs
**Problema:** `Cannot access a disposed object. Object name: 'LoggerFactory'` durante encerramento da aplicação.

**Solução:** Adicionado try-catch para `ObjectDisposedException` ao criar logger em `Alerta.cs`.

### 3. CS0111 - OnModelCreating Duplicado
**Problema:** Método `OnModelCreating` definido duas vezes em classe partial `FrotiXDbContext`.

**Solução:**
- Removido `OnModelCreating` duplicado de `FrotiXDbContext.ModelConfiguration.cs`
- Mantido apenas `ApplyDecimalPrecisionDefaults` que é chamado pelo `OnModelCreating` principal

### 4. Sintaxe try-catch em Program.cs
**Problema:** Bloco `catch` mal posicionado (dentro de bloco anônimo `{}`).

**Solução:** Corrigida estrutura do try-catch e adicionado `using FrotiX.Helpers`.

### 5. ResponseCompression em Development
**Problema:** `Unable to resolve service for type 'IResponseCompressionProvider'` em ambiente Development.

**Causa:** `AddResponseCompression` só era registrado em não-Development, mas `UseResponseCompression` era chamado sempre.

**Solução:** Condicionado `UseResponseCompression` para executar apenas em não-Development:
```csharp
if (!_environment.IsDevelopment())
{
    app.UseResponseCompression();
}
```

---

## Arquivos Modificados

| Arquivo | Alteração |
|---------|-----------|
| `Pages/Shared/_ScriptsBasePlugins.cshtml` | CLDR pt-BR completo |
| `Pages/Shared/_Layout.cshtml` | Path locale corrigido |
| `Helpers/Alerta.cs` | try-catch ObjectDisposedException |
| `Data/FrotiXDbContext.cs` | Chamada ApplyDecimalPrecisionDefaults |
| `Data/FrotiXDbContext.ModelConfiguration.cs` | Novo arquivo (método extraído) |
| `wwwroot/js/alertasfrotix/alertas_recorrencia.js` | Verificação disponibilidade Syncfusion |
| `Program.cs` | Sintaxe try-catch + using |
| `Startup.cs` | UseResponseCompression condicional |

---

## Commits

1. `dfd5353b` - fix: corrigir CLDR Syncfusion, ObjectDisposedException e DbContext duplicado
2. `ccdc41d7` - docs: adiciona conversa de correções CLDR Syncfusion
3. `d7c820dc` - fix: corrigir sintaxe try-catch em Program.cs
4. `33713404` - fix: condicionar UseResponseCompression para não-Development

---

**Status:** ✅ Concluído
