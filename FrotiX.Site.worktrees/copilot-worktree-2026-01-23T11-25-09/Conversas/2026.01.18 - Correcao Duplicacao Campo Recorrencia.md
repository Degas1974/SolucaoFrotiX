# 2026.01.18 - Correção de Duplicação Visual no Modal de Agendamento

**Data:** 18/01/2026 05:40
**Responsável:** Jules
**Contexto:** Correção de bug visual na Agenda de Viagens (Modal de Agendamento)

## Problema
Ao alternar entre edição de um agendamento e criação de um novo agendamento, o campo "Data Final Recorrência" aparecia duplicado:
1. Um `input` text readonly (usado para exibir a data em modo de edição)
2. Um `DatePicker` Syncfusion (usado para selecionar a data em modo de criação)

Isso ocorria porque a limpeza do modal não estava garantindo a ocultação do campo de texto e a restauração do DatePicker de forma robusta contra re-renderizações do Syncfusion.

## Solução Implementada

### 1. CSS Dedicado
Criada uma classe CSS com `!important` para garantir a ocultação visual, independente de estilos inline aplicados pelo JavaScript ou pelo framework Syncfusion.

*Arquivo:* `Pages/Agenda/Index.cshtml`
```css
.ftx-ocultar-recorrencia-texto {
    display: none !important;
}
```

### 2. Refatoração da Lógica de Reset (Novo Agendamento)
No arquivo `modal-viagem-novo.js`, a função `limparCamposModalViagens` foi atualizada para:
- Adicionar a classe `.ftx-ocultar-recorrencia-texto` ao campo de texto readonly.
- Remover a classe `.ftx-ocultar-recorrencia-date` do DatePicker.
- Garantir que o wrapper do Syncfusion (caso exista) seja exibido como `flex`.

*Arquivo:* `wwwroot/js/agendamento/components/modal-viagem-novo.js`

### 3. Refatoração da Lógica de Edição
No arquivo `exibe-viagem.js`, as funções de configuração de recorrência (`configurarRecorrenciaSemanal`, etc.) foram atualizadas para:
- Remover a classe `.ftx-ocultar-recorrencia-texto` do campo de texto readonly.
- Adicionar a classe `.ftx-ocultar-recorrencia-date` ao DatePicker.
- Usar `sed` para aplicar as mudanças de forma global e consistente em todas as funções de recorrência (Semanal, Mensal, Restaurar, etc.).

*Arquivo:* `wwwroot/js/agendamento/components/exibe-viagem.js`

## Arquivos Alterados
1. `Pages/Agenda/Index.cshtml`
2. `wwwroot/js/agendamento/components/modal-viagem-novo.js`
3. `wwwroot/js/agendamento/components/exibe-viagem.js`

## Resultado
O campo "Data Final Recorrência" agora alterna corretamente entre modo de texto (edição) e DatePicker (novo), sem duplicação visual, mesmo após múltiplas alternâncias de estado.
