/*
*  #################################################################################################
*  #                                                                                               #
*  #   โโโโโโโโโโโโโโโ  โโโโโโโ โโโโโโโโโโโโโโโ  โโโ    โโโโโโโ  โโโโโโโ โโโโโโโ  โโโโโโโ          #
*  #   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          #
*  #   โโโโโโ  โโโโโโโโโโโ   โโโ   โโโ   โโโ โโโโโโ      โโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ          #
*  #   โโโโโโ  โโโโโโโโโโโ   โโโ   โโโ   โโโ โโโโโโ     โโโโโโโ โโโโโโโโโโโโโโโโ โโโโโโโโโ          #
*  #   โโโ     โโโ  โโโโโโโโโโโโ   โโโ   โโโโโโโ โโโ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ          #
*  #   โโโ     โโโ  โโโ โโโโโโโ    โโโ   โโโโโโ  โโโ    โโโโโโโโ โโโโโโโ โโโโโโโโ โโโโโโโ           #
*  #                                                                                               #
*  #   PROJETO: FROTIX - GESTรO DE FROTAS                                                          #
*  #   MODULO:  RELATรRIOS (SETOR SOLICITANTE)                                                     #
*  #   DATA:    2026 (Modernizaรงรฃo FrotiX 2026)                                                   #
*  #                                                                                               #
*  #################################################################################################
*/

using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Stimulsoft.Report;
using Stimulsoft.Report.Mvc;
using FrotiX.Helpers;
using FrotiX.Services;

namespace FrotiX.Controllers
{
    /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    /// โ ๐ NOME: RelatorioSetorSolicitanteController                               โ
    /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
    /// โ ๐ DESCRIรรO:                                                                โ
    /// โ    Geraรงรฃo e exibiรงรฃo de relatรณrio de Setores Solicitantes (Stimulsoft).     โ
    /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
    /// โ ๐ ESCOPO: MVC                                                               โ
    /// โ    โข Rota base: /SetorSolicitante/RelatorioSetorSolicitante                  โ
    /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    [Route("SetorSolicitante/RelatorioSetorSolicitante")]
    public class RelatorioSetorSolicitanteController : Controller
    {
        private readonly ILogService _log;

        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        /// โ ๐ NOME: RelatorioSetorSolicitanteController (Construtor Estรกtico)       โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
        /// โ ๐ DESCRIรรO:                                                                โ
        /// โ    Configura a licenรงa global da Stimulsoft para geraรงรฃo de relatรณrios.     โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        static RelatorioSetorSolicitanteController()
        {
            try
            {
                // [REGRA] Licenรงa Stimulsoft.
                Stimulsoft.Base.StiLicense.Key = "6vJhGtLLLz2GNviWmUTrhSqnOItdDwjBylQzQcAOiHkgpgFGkUl79uxVs8X+uspx6K+tqdtOB5G1S6PFPRrlVNvMUiSiNYl724EZbrUAWwAYHlGLRbvxMviMExTh2l9xZJ2xc4K1z3ZVudRpQpuDdFq+fe0wKXSKlB6okl0hUd2ikQHfyzsAN8fJltqvGRa5LI8BFkA/f7tffwK6jzW5xYYhHxQpU3hy4fmKo/BSg6yKAoUq3yMZTG6tWeKnWcI6ftCDxEHd30EjMISNn1LCdLN0/4YmedTjM7x+0dMiI2Qif/yI+y8gmdbostOE8S2ZjrpKsgxVv2AAZPdzHEkzYSzx81RHDzZBhKRZc5mwWAmXsWBFRQol9PdSQ8BZYLqvJ4Jzrcrext+t1ZD7HE1RZPLPAqErO9eo+7Zn9Cvu5O73+b9dxhE2sRyAv9Tl1lV2WqMezWRsO55Q3LntawkPq0HvBkd9f8uVuq9zk7VKegetCDLb0wszBAs1mjWzN+ACVHiPVKIk94/QlCkj31dWCg8YTrT5btsKcLibxog7pv1+2e4yocZKWsposmcJbgG0";
            }
            catch (Exception ex)
            {
                Alerta.TratamentoErroComLinha("RelatorioSetorSolicitanteController.cs", "Static Constructor", ex);
            }
        }

        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        /// โ ๐ NOME: RelatorioSetorSolicitanteController (Construtor)                โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
        /// โ ๐ DESCRIรรO:                                                                โ
        /// โ    Inicializa o controlador com o serviรงo de logs.                          โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
        /// โ ๐ฅ PARรMETROS:                                                               โ
        /// โ    โข log (ILogService): Serviรงo de log centralizado.                         โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        public RelatorioSetorSolicitanteController(ILogService log)
        {
            try
            {
                _log = log;
            }
            catch (Exception ex)
            {
                Alerta.TratamentoErroComLinha("RelatorioSetorSolicitanteController.cs", "Constructor", ex);
            }
        }

        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        /// โ ๐ NOME: Index                                                            โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
        /// โ ๐ DESCRIรรO:                                                                โ
        /// โ    Carrega a pรกgina principal do visualizador de relatรณrios.                โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
        /// โ ๐ค RETORNO:                                                                  โ
        /// โ    โข IActionResult: View do relatรณrio.                                      โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        [IgnoreAntiforgeryToken]
        public IActionResult Index()
        {
            try
            {
                // [RETORNO] View principal.
                return View();
            }
            catch (Exception ex)
            {
                _log.Error("RelatorioSetorSolicitanteController.Index", ex);
                Alerta.TratamentoErroComLinha("RelatorioSetorSolicitanteController.cs", "Index", ex);
                // [RETORNO] View fallback.
                return View();
            }
        }

        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        /// โ ๐ NOME: GetReport                                                        โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
        /// โ ๐ DESCRIรรO:                                                                โ
        /// โ    Carrega o arquivo .mrt do relatรณrio de Setores Solicitantes.             โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
        /// โ ๐ค RETORNO:                                                                  โ
        /// โ    โข IActionResult: Resultado do relatรณrio Stimulsoft.                       โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        [Route("GetReport")]
        public IActionResult GetReport()
        {
            try
            {
                // [LOG] Inรญcio do carregamento.
                _log.Info("RelatorioSetorSolicitanteController.GetReport: Carregando relatรณrio de Setores Solicitantes.");
                // [DADOS] Instancia relatรณrio.
                StiReport report = new StiReport();
                // [REGRA] Limpa data store.
                report.Dictionary.DataStore.Clear();
                // [ARQUIVO] Carrega template .mrt.
                report.Load(StiNetCoreHelper.MapPath(this, "Reports/SetoresSolicitantes.mrt"));

                // [RETORNO] Resultado do relatรณrio.
                return StiNetCoreViewer.GetReportResult(this, report);
            }
            catch (Exception ex)
            {
                _log.Error("RelatorioSetorSolicitanteController.GetReport", ex);
                Alerta.TratamentoErroComLinha("RelatorioSetorSolicitanteController.cs", "GetReport", ex);
                // [RETORNO] View fallback.
                return View();
            }
        }

        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        /// โ ๐ NOME: ViewerEvent                                                      โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
        /// โ ๐ DESCRIรรO:                                                                โ
        /// โ    Gerencia eventos do visualizador (zoom, impressรฃo, navegaรงรฃo).           โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
        /// โ ๐ค RETORNO:                                                                  โ
        /// โ    โข IActionResult: Resultado do evento do viewer.                          โ
        /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        [Route("ViewerEvent")]
        public IActionResult ViewerEvent()
        {
            try
            {
                // [RETORNO] Evento do viewer.
                return StiNetCoreViewer.ViewerEventResult(this);
            }
            catch (Exception ex)
            {
                _log.Error("RelatorioSetorSolicitanteController.ViewerEvent", ex);
                Alerta.TratamentoErroComLinha("RelatorioSetorSolicitanteController.cs", "ViewerEvent", ex);
                // [RETORNO] View fallback.
                return View();
            }
        }
    }
}
