// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘                                                                                                   â•‘
// â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â•‘
// â•‘   â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—    â•‘
// â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘    â•‘
// â•‘   â–ˆâ–ˆâ•”â•â•â•  â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘    â•‘
// â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â•‘
// â•‘   â•šâ•â•â•â•â•â•â•  â•šâ•â•â•â•  â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•    â•šâ•â•â•â•â•â•     â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•      â•šâ•â•â•â•â•â•     â•‘
// â•‘                                                                                                   â•‘
// â•‘   ğŸ“‹ ARQUIVO: EventoRepository.cs                                                                 â•‘
// â•‘   ğŸ“‚ LOCALIZAÃ‡ÃƒO: Repository/                                                                     â•‘
// â•‘   ğŸ“… DOCUMENTADO EM: 2026-01-14                                                                   â•‘
// â•‘   ğŸ‘¤ AUTOR: GitHub Copilot (DocumentaÃ§Ã£o INTRA-CODE)                                              â•‘
// â•‘   âš™ï¸ TECNOLOGIAS: C#, .NET 10, EF Core, Repository Pattern                                       â•‘
// â•‘                                                                                                   â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘ ğŸ“– DESCRIÃ‡ÃƒO GERAL                                                                                â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘                                                                                                   â•‘
// â•‘ Gerencia eventos corporativos/governamentais (seminÃ¡rios, reuniÃµes, deslocamentos especiais).    â•‘
// â•‘ Eventos agregam mÃºltiplas VIAGENS e permitem rastreamento de custos consolidados.                â•‘
// â•‘                                                                                                   â•‘
// â•‘ CAMPOS PRINCIPAIS:                                                                                â•‘
// â•‘ â€¢ EventoId (PK), Nome, Descricao                                                                  â•‘
// â•‘ â€¢ DataInicial, DataFinal (perÃ­odo do evento)                                                      â•‘
// â•‘ â€¢ QtdParticipantes (estimativa de pessoas)                                                        â•‘
// â•‘ â€¢ Status (Planejado/Em Andamento/Finalizado/Cancelado)                                           â•‘
// â•‘ â€¢ RequisitanteId, SetorSolicitanteId (FK)                                                        â•‘
// â•‘                                                                                                   â•‘
// â•‘ RELACIONAMENTOS:                                                                                  â•‘
// â•‘ Evento (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) Viagem   â†’ Um evento pode ter mÃºltiplas viagens associadas          â•‘
// â•‘ Evento (N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (1) Requisitante â†’ Quem solicitou o evento                               â•‘
// â•‘ Evento (N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (1) SetorSolicitante â†’ Setor responsÃ¡vel                                 â•‘
// â•‘                                                                                                   â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘ ğŸ¯ FUNCIONALIDADES PRINCIPAIS                                                                     â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘                                                                                                   â•‘
// â•‘ âœ… GetEventoListForDropDown()                                                                     â•‘
// â•‘    â€¢ Retorna SelectListItem para dropdowns MVC                                                    â•‘
// â•‘    â€¢ OrdenaÃ§Ã£o: Nome ASC                                                                          â•‘
// â•‘                                                                                                   â•‘
// â•‘ âœ… Update(Evento)                                                                                 â•‘
// â•‘    â€¢ âš ï¸ QUEBRA UNIT OF WORK: Chama _db.Update() + SaveChanges()                                  â•‘
// â•‘    â€¢ Atualiza registro completo do evento                                                         â•‘
// â•‘                                                                                                   â•‘
// â•‘ âœ… GetEventosPaginadoAsync() â­ QUERY OTIMIZADA                                                   â•‘
// â•‘    â€¢ Consulta paginada com JOIN (Requisitante + SetorSolicitante)                                â•‘
// â•‘    â€¢ CÃLCULO DE CUSTOS: SUM de todos custos das viagens do evento                                â•‘
// â•‘    â€¢ Filtro por Status (opcional)                                                                 â•‘
// â•‘    â€¢ Retorna: (List<EventoListDto>, int totalItems) para paginaÃ§Ã£o                                â•‘
// â•‘    â€¢ PERFORMANCE: 3 etapas otimizadas com Stopwatch (logs de performance)                        â•‘
// â•‘                                                                                                   â•‘
// â•‘ ETAPAS DE GetEventosPaginadoAsync:                                                                â•‘
// â•‘ 1. QUERY EVENTOS: JOIN com Requisitante + SetorSolicitante, paginaÃ§Ã£o                            â•‘
// â•‘ 2. CUSTOS BATCH: GroupBy em Viagem para somar custos por EventoId (1 query)                      â•‘
// â•‘ 3. FORMATAÃ‡Ã•ES: ConvertHtml, formataÃ§Ã£o monetÃ¡ria, padding QtdParticipantes                      â•‘
// â•‘                                                                                                   â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘ âš ï¸ PROBLEMAS IDENTIFICADOS                                                                        â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘                                                                                                   â•‘
// â•‘ âŒ PROBLEMA: Update() quebra Unit of Work                                                         â•‘
// â•‘    â†’ Chama _db.Update() + SaveChanges() diretamente                                               â•‘
// â•‘    â†’ Impede transaÃ§Ãµes coordenadas pelo Controller/Service                                        â•‘
// â•‘    â†’ SOLUÃ‡ÃƒO: Remover SaveChanges(), deixar para UnitOfWork                                       â•‘
// â•‘                                                                                                   â•‘
// â•‘ âš ï¸ OBSERVAÃ‡ÃƒO: GetEventoListForDropDown() simples                                                 â•‘
// â•‘    â†’ Retorna apenas EventoId + Nome                                                               â•‘
// â•‘    â†’ NÃ£o filtra por Status (retorna TODOS os eventos, inclusive cancelados)                      â•‘
// â•‘    â†’ SUGESTÃƒO: Adicionar filtro ".Where(x => x.Status != 'Cancelado')"                            â•‘
// â•‘                                                                                                   â•‘
// â•‘ âœ… BOA PRÃTICA: GetEventosPaginadoAsync com logs de performance                                   â•‘
// â•‘    â†’ Stopwatch em cada etapa (Query, Custos, FormataÃ§Ãµes)                                        â•‘
// â•‘    â†’ Console.WriteLine para debug (Ãºtil em desenvolvimento)                                       â•‘
// â•‘    â†’ Tratamento de erro com Alerta.TratamentoErroComLinha                                         â•‘
// â•‘                                                                                                   â•‘
// â•‘ âœ… BOA PRÃTICA: AsNoTracking() em queries de leitura                                              â•‘
// â•‘    â†’ Performance otimizada (nÃ£o rastreia mudanÃ§as no contexto)                                    â•‘
// â•‘                                                                                                   â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘ ğŸ“Š CÃLCULO DE CUSTOS                                                                              â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘                                                                                                   â•‘
// â•‘ CustoTotal = SUM(Viagem.CustoCombustivel) +                                                       â•‘
// â•‘              SUM(Viagem.CustoMotorista) +                                                         â•‘
// â•‘              SUM(Viagem.CustoVeiculo) +                                                           â•‘
// â•‘              SUM(Viagem.CustoOperador) +                                                          â•‘
// â•‘              SUM(Viagem.CustoLavador)                                                             â•‘
// â•‘                                                                                                   â•‘
// â•‘ Agrupado por: Viagem.EventoId                                                                     â•‘
// â•‘ Filtro: WHERE EventoId IN (ids dos eventos da pÃ¡gina)                                             â•‘
// â•‘ Performance: 1 query batch para mÃºltiplos eventos (evita N+1)                                     â•‘
// â•‘                                                                                                   â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using FrotiX.Data;
using FrotiX.Models;
using FrotiX.Repository.IRepository;
using FrotiX.Services;
using Microsoft.AspNetCore.Mvc.Rendering;

namespace FrotiX.Repository
{
    public class EventoRepository : Repository<Evento>, IEventoRepository
    {
        private new readonly FrotiXDbContext _db;

        public EventoRepository(FrotiXDbContext db) : base(db)
        {
            _db = db;
        }

        // [ETAPA] Busca eventos para popular dropdown
        // Retorna SelectListItem com EventoId (GUID) e Nome
        // OrdenaÃ§Ã£o: Nome ASC
        // âš ï¸ PROBLEMA: NÃ£o filtra por Status (retorna TODOS, inclusive cancelados)
        // TODO: Adicionar filtro ".Where(x => x.Status != 'Cancelado')"
        public IEnumerable<SelectListItem> GetEventoListForDropDown()
        {
            return _db.Evento
                .OrderBy(o => o.Nome)
                .Select(i => new SelectListItem()
                {
                    Text = i.Nome,
                    Value = i.EventoId.ToString()
                });
        }

        // [ETAPA] Atualiza evento existente
        // âš ï¸ QUEBRA UNIT OF WORK: Chama _db.Update() + SaveChanges() diretamente
        // Atualiza registro completo (todos os campos modificados sÃ£o detectados)
        // TODO: Remover SaveChanges() para respeitar Unit of Work pattern
        public new void Update(Evento evento)
        {
            _db.Update(evento);
            _db.SaveChanges();
        }

        // [ETAPA] âš¡ QUERY OTIMIZADA: Busca eventos paginados com custos consolidados
        //
        // PERFORMANCE: 3 etapas otimizadas com Stopwatch (logs de debug)
        //
        // ETAPA 1 - QUERY EVENTOS:
        // â€¢ JOIN com Requisitante + SetorSolicitante (LEFT JOIN via DefaultIfEmpty)
        // â€¢ Filtro opcional por Status
        // â€¢ PaginaÃ§Ã£o: Skip + Take
        // â€¢ AsNoTracking() para performance
        //
        // ETAPA 2 - CUSTOS BATCH:
        // â€¢ GroupBy em Viagem.EventoId para somar custos
        // â€¢ SUM de: CustoCombustivel + CustoMotorista + CustoVeiculo + CustoOperador + CustoLavador
        // â€¢ WHERE Viagem.EventoId IN (ids dos eventos da pÃ¡gina) â†’ Evita N+1
        // â€¢ Resultado armazenado em Dictionary para lookup rÃ¡pido
        //
        // ETAPA 3 - FORMATAÃ‡Ã•ES:
        // â€¢ ConvertHtml() no nome do requisitante (escaping de caracteres especiais)
        // â€¢ FormataÃ§Ã£o monetÃ¡ria: "R$ 0,00"
        // â€¢ Padding em QtdParticipantes: "001", "015", "100"
        //
        // RETORNO: (List<EventoListDto>, int totalItems) para paginaÃ§Ã£o no frontend
        //
        // LOGS: Console.WriteLine em cada etapa (Ãºtil para profiling)
        //
        // TRATAMENTO DE ERROS: Try-catch com Alerta.TratamentoErroComLinha
        /// <summary>
        /// âš¡ Query otimizada para listar eventos com paginaÃ§Ã£o
        /// </summary>
        public async Task<(List<EventoListDto> eventos, int totalItems)> GetEventosPaginadoAsync(
            int page,
            int pageSize,
            string filtroStatus = null
        )
        {
            try
            {
                var swTotal = System.Diagnostics.Stopwatch.StartNew();

                Console.WriteLine("=== INÃCIO GetEventosPaginadoAsync ===");

                // ====================================
                // ETAPA 1: Buscar dados dos eventos
                // ====================================
                var swEventos = System.Diagnostics.Stopwatch.StartNew();

                var query = from e in _db.Evento
                            join r in _db.Requisitante on e.RequisitanteId equals r.RequisitanteId into reqJoin
                            from req in reqJoin.DefaultIfEmpty()
                            join s in _db.SetorSolicitante on e.SetorSolicitanteId equals s.SetorSolicitanteId into setorJoin
                            from setor in setorJoin.DefaultIfEmpty()
                            select new
                            {
                                e.EventoId,
                                e.Nome,
                                e.Descricao,
                                e.DataInicial,
                                e.DataFinal,
                                e.QtdParticipantes,
                                e.Status,
                                NomeRequisitante = req != null ? req.Nome : "",
                                NomeSetor = setor != null ? setor.Nome : ""
                            };

                // Aplicar filtro de status se fornecido
                if (!string.IsNullOrEmpty(filtroStatus))
                {
                    query = query.Where(x => x.Status == filtroStatus);
                }

                // Count total
                var totalItems = await query.CountAsync();

                if (totalItems == 0)
                {
                    Console.WriteLine("=== FIM (sem dados) ===\n");
                    return (new List<EventoListDto>(), 0);
                }

                // PaginaÃ§Ã£o
                var eventos = await query
                    .OrderByDescending(x => x.DataInicial)
                    .Skip((page - 1) * pageSize)
                    .Take(pageSize)
                    .AsNoTracking()
                    .ToListAsync();

                swEventos.Stop();
                Console.WriteLine($"[QUERY EVENTOS] {eventos.Count}/{totalItems} registros - {swEventos.ElapsedMilliseconds}ms");

                // ====================================
                // ETAPA 2: Calcular custos (batch)
                // ====================================
                var swCustos = System.Diagnostics.Stopwatch.StartNew();

                var eventoIds = eventos.Select(x => x.EventoId).ToList();

                var custosPorEvento = await _db.Viagem
                    .Where(v => eventoIds.Contains(v.EventoId.Value))
                    .GroupBy(v => v.EventoId.Value)
                    .Select(g => new
                    {
                        EventoId = g.Key,
                        CustoTotal = (decimal)(
                            g.Sum(v => (double)(v.CustoCombustivel ?? 0)) +
                            g.Sum(v => (double)(v.CustoMotorista ?? 0)) +
                            g.Sum(v => (double)(v.CustoVeiculo ?? 0)) +
                            g.Sum(v => (double)(v.CustoOperador ?? 0)) +
                            g.Sum(v => (double)(v.CustoLavador ?? 0))
                        )
                    })
                    .AsNoTracking()
                    .ToListAsync();

                var custosDict = custosPorEvento.ToDictionary(x => x.EventoId, x => x.CustoTotal);

                swCustos.Stop();
                Console.WriteLine($"[CUSTOS] {custosPorEvento.Count} eventos com custos - {swCustos.ElapsedMilliseconds}ms");

                // ====================================
                // ETAPA 3: Processar formataÃ§Ãµes
                // ====================================
                var swFormato = System.Diagnostics.Stopwatch.StartNew();

                var result = eventos.Select(x =>
                {
                    var custo = custosDict.ContainsKey(x.EventoId) ? custosDict[x.EventoId] : 0;

                    return new EventoListDto
                    {
                        EventoId = x.EventoId,
                        Nome = x.Nome,
                        Descricao = x.Descricao,
                        DataInicial = x.DataInicial,
                        DataFinal = x.DataFinal,
                        QtdParticipantes = (x.QtdParticipantes ?? 0).ToString().PadLeft(3, '0'),
                        Status = x.Status,
                        NomeRequisitante = x.NomeRequisitante,
                        NomeRequisitanteHTML = Servicos.ConvertHtml(x.NomeRequisitante ?? ""),
                        NomeSetor = x.NomeSetor,
                        CustoViagem = string.Format("R$ {0:N2}", custo),
                        CustoViagemNaoFormatado = custo
                    };
                }).ToList();

                swFormato.Stop();
                Console.WriteLine($"[FORMATO] {result.Count} registros - {swFormato.ElapsedMilliseconds}ms");

                swTotal.Stop();
                Console.WriteLine($"[TOTAL REPOSITORY] {swTotal.ElapsedMilliseconds}ms");
                Console.WriteLine("=== FIM GetEventosPaginadoAsync ===\n");

                return (result, totalItems);
            }
            catch (Exception error)
            {
                Console.WriteLine($"[ERRO REPOSITORY] {error.Message}");
                Console.WriteLine($"[STACK] {error.StackTrace}");
                Alerta.TratamentoErroComLinha("EventoRepository.cs", "GetEventosPaginadoAsync", error);
                throw;
            }
        }
    }
}
