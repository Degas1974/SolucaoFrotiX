// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘                                                                                                   â•‘
// â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—           â•‘
// â•‘   â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—          â•‘
// â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•          â•‘
// â•‘   â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—          â•‘
// â•‘   â–ˆâ–ˆâ•‘     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘          â•‘
// â•‘   â•šâ•â•      â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•          â•‘
// â•‘                                                                                                   â•‘
// â•‘   ğŸ“‹ ARQUIVO: FornecedorRepository.cs                                                             â•‘
// â•‘   ğŸ“‚ LOCALIZAÃ‡ÃƒO: Repository/                                                                     â•‘
// â•‘   ğŸ“… DOCUMENTADO EM: 2026-01-14                                                                   â•‘
// â•‘   ğŸ‘¤ AUTOR: GitHub Copilot (DocumentaÃ§Ã£o INTRA-CODE)                                              â•‘
// â•‘   âš™ï¸ TECNOLOGIAS: C#, .NET 10, EF Core, Repository Pattern                                       â•‘
// â•‘                                                                                                   â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘ ğŸ“– DESCRIÃ‡ÃƒO GERAL                                                                                â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘                                                                                                   â•‘
// â•‘ Gerencia fornecedores de produtos/serviÃ§os para a frota (postos de combustÃ­vel, oficinas, etc.). â•‘
// â•‘ RepositÃ³rio simples com apenas 2 mÃ©todos: GetListForDropDown e Update.                           â•‘
// â•‘                                                                                                   â•‘
// â•‘ CAMPOS PRINCIPAIS:                                                                                â•‘
// â•‘ â€¢ FornecedorId (PK), DescricaoFornecedor (Nome)                                                  â•‘
// â•‘ â€¢ Status (bool) - Ativo/Inativo                                                                   â•‘
// â•‘ â€¢ Provavelmente: CNPJ, Endereco, Telefone, etc. (ver Model)                                      â•‘
// â•‘                                                                                                   â•‘
// â•‘ RELACIONAMENTOS:                                                                                  â•‘
// â•‘ Fornecedor (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) NotaFiscal                                                       â•‘
// â•‘ Fornecedor (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) Abastecimento (postos de combustÃ­vel)                            â•‘
// â•‘                                                                                                   â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘ ğŸ¯ FUNCIONALIDADES PRINCIPAIS                                                                     â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘                                                                                                   â•‘
// â•‘ âœ… GetFornecedorListForDropDown()                                                                 â•‘
// â•‘    â€¢ Retorna SelectListItem para dropdowns MVC                                                    â•‘
// â•‘    â€¢ Filtro: Status = true (apenas ativos)                                                        â•‘
// â•‘    â€¢ OrdenaÃ§Ã£o: DescricaoFornecedor ASC                                                           â•‘
// â•‘                                                                                                   â•‘
// â•‘ âœ… Update(Fornecedor)                                                                             â•‘
// â•‘    â€¢ âš ï¸ QUEBRA UNIT OF WORK: Chama _db.Update() + SaveChanges()                                  â•‘
// â•‘    â€¢ Atualiza registro completo do fornecedor                                                     â•‘
// â•‘                                                                                                   â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘ âš ï¸ PROBLEMAS IDENTIFICADOS                                                                        â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘                                                                                                   â•‘
// â•‘ âŒ PROBLEMA: Update() quebra Unit of Work                                                         â•‘
// â•‘    â†’ Chama _db.Update() + SaveChanges() diretamente                                               â•‘
// â•‘    â†’ Impede transaÃ§Ãµes coordenadas pelo Controller/Service                                        â•‘
// â•‘    â†’ SOLUÃ‡ÃƒO: Remover SaveChanges(), deixar para UnitOfWork                                       â•‘
// â•‘                                                                                                   â•‘
// â•‘ âš ï¸ CÃ“DIGO MORTO: objFromDb buscado mas nÃ£o utilizado                                              â•‘
// â•‘    â†’ Linha: var objFromDb = _db.Fornecedor.AsTracking().FirstOrDefault(...)                      â•‘
// â•‘    â†’ NÃ£o faz nada com objFromDb (dead code)                                                       â•‘
// â•‘    â†’ SOLUÃ‡ÃƒO: Remover linha ou usar para update manual de campos                                  â•‘
// â•‘                                                                                                   â•‘
// â•‘ âœ… BOA PRÃTICA: GetFornecedorListForDropDown filtra por Status = true                            â•‘
// â•‘    â†’ Evita exibir fornecedores inativos nos dropdowns                                             â•‘
// â•‘                                                                                                   â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using FrotiX.Data;
using FrotiX.Models;
using FrotiX.Repository.IRepository;
using Microsoft.AspNetCore.Mvc.Rendering;

namespace FrotiX.Repository
{
    public class FornecedorRepository : Repository<Fornecedor>, IFornecedorRepository
    {
        private new readonly FrotiXDbContext _db;

        public FornecedorRepository(FrotiXDbContext db) : base(db)
        {
            _db = db;
        }

        // [ETAPA] Busca fornecedores ATIVOS para popular dropdown
        // Retorna SelectListItem com FornecedorId (GUID) e DescricaoFornecedor
        // Filtro: Status = true (apenas ativos)
        // OrdenaÃ§Ã£o: DescricaoFornecedor ASC
        public IEnumerable<SelectListItem> GetFornecedorListForDropDown()
        {

            return _db.Fornecedor
            .Where(f => f.Status == true)
            .OrderBy(o => o.DescricaoFornecedor)
            .Select(i => new SelectListItem()
            {
                Text = i.DescricaoFornecedor,
                Value = i.FornecedorId.ToString()
            }); ;
        }

        // [ETAPA] Atualiza fornecedor existente
        // âš ï¸ CÃ“DIGO MORTO: objFromDb buscado mas nÃ£o utilizado
        // âš ï¸ QUEBRA UNIT OF WORK: Chama _db.Update() + SaveChanges() diretamente
        // TODO: Remover objFromDb (dead code) OU usÃ¡-lo para update manual de campos
        // TODO: Remover SaveChanges() para respeitar Unit of Work pattern
        public new void Update(Fornecedor fornecedor)
        {
            var objFromDb = _db.Fornecedor.AsTracking().FirstOrDefault(s => s.FornecedorId == fornecedor.FornecedorId);

            _db.Update(fornecedor);
            _db.SaveChanges();

        }


    }
}


