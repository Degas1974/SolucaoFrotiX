// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘                                                                                                   â•‘
// â•‘   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â•‘
// â•‘   â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—    â•‘
// â•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘    â•‘
// â•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘    â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘    â•‘
// â•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â•‘
// â•‘   â•šâ•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•â•šâ•â•     â•šâ•â•      â•šâ•â•â•â•  â•šâ•â•â•â•â•â•â•â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â•     â•‘
// â•‘                                   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—                                        â•‘
// â•‘                                  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—                                       â•‘
// â•‘                                  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘                                       â•‘
// â•‘                                  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘                                       â•‘
// â•‘                                  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘                                       â•‘
// â•‘                                  â•šâ•â•  â•šâ•â•   â•šâ•â•   â•šâ•â•  â•šâ•â•                                       â•‘
// â•‘                                                                                                   â•‘
// â•‘   ğŸ“‹ ARQUIVO: ItemVeiculoAtaRepository.cs                                                         â•‘
// â•‘   ğŸ“‚ LOCALIZAÃ‡ÃƒO: Repository/                                                                     â•‘
// â•‘   ğŸ“… DOCUMENTADO EM: 2026-01-19                                                                   â•‘
// â•‘   ğŸ‘¤ AUTOR: GitHub Copilot (DocumentaÃ§Ã£o INTRA-CODE)                                              â•‘
// â•‘   âš™ï¸ TECNOLOGIAS: C#, .NET 10, EF Core, Repository Pattern                                       â•‘
// â•‘                                                                                                   â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘ ğŸ“– DESCRIÃ‡ÃƒO GERAL                                                                                â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘                                                                                                   â•‘
// â•‘ Gerencia itens de veÃ­culos cadastrados em Atas de Registro de PreÃ§os.                            â•‘
// â•‘ Relaciona tipos/categorias de veÃ­culos com atas (ex: Sedan, SUV, Van, CaminhÃ£o, etc.).           â•‘
// â•‘ RepositÃ³rio simples com apenas 2 mÃ©todos: GetListForDropDown e Update.                           â•‘
// â•‘                                                                                                   â•‘
// â•‘ CAMPOS PRINCIPAIS:                                                                                â•‘
// â•‘ â€¢ ItemVeiculoAtaId (PK), Descricao (tipo do veÃ­culo)                                             â•‘
// â•‘ â€¢ Provavelmente: AtaRegistroPrecosId (FK), ValorUnitario, Quantidade                             â•‘
// â•‘                                                                                                   â•‘
// â•‘ RELACIONAMENTOS:                                                                                  â•‘
// â•‘ ItemVeiculoAta (N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (1) AtaRegistroPrecos                                            â•‘
// â•‘ ItemVeiculoAta (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) Veiculo (categoria/tipo do veÃ­culo)                          â•‘
// â•‘                                                                                                   â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘ ğŸ¯ FUNCIONALIDADES PRINCIPAIS                                                                     â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘                                                                                                   â•‘
// â•‘ âœ… GetItemVeiculoAtaListForDropDown()                                                             â•‘
// â•‘    â€¢ Retorna SelectListItem para dropdowns MVC                                                    â•‘
// â•‘    â€¢ OrdenaÃ§Ã£o: Descricao ASC                                                                     â•‘
// â•‘    â€¢ âš ï¸ NÃ£o filtra por Status/Ativo (retorna TODOS os registros)                                 â•‘
// â•‘                                                                                                   â•‘
// â•‘ âœ… Update(ItemVeiculoAta)                                                                         â•‘
// â•‘    â€¢ âš ï¸ QUEBRA UNIT OF WORK: Chama _db.Update() + SaveChanges()                                  â•‘
// â•‘    â€¢ Atualiza registro completo do item                                                           â•‘
// â•‘                                                                                                   â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘ âš ï¸ PROBLEMAS IDENTIFICADOS                                                                        â•‘
// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
// â•‘                                                                                                   â•‘
// â•‘ âŒ PROBLEMA: Update() quebra Unit of Work                                                         â•‘
// â•‘    â†’ Chama _db.Update() + SaveChanges() diretamente                                               â•‘
// â•‘    â†’ Impede transaÃ§Ãµes coordenadas pelo Controller/Service                                        â•‘
// â•‘    â†’ SOLUÃ‡ÃƒO: Remover SaveChanges(), deixar para UnitOfWork                                       â•‘
// â•‘                                                                                                   â•‘
// â•‘ âš ï¸ CÃ“DIGO MORTO: objFromDb buscado mas nÃ£o utilizado                                              â•‘
// â•‘    â†’ Linha: var objFromDb = _db.ItemVeiculoAta.AsTracking().FirstOrDefault(...)                  â•‘
// â•‘    â†’ NÃ£o faz nada com objFromDb (dead code)                                                       â•‘
// â•‘    â†’ SOLUÃ‡ÃƒO: Remover linha ou usar para update manual de campos                                  â•‘
// â•‘                                                                                                   â•‘
// â•‘ âš ï¸ OBSERVAÃ‡ÃƒO: GetItemVeiculoAtaListForDropDown() sem filtro                                      â•‘
// â•‘    â†’ Retorna TODOS os itens (inclusive inativos, se houver campo Status)                         â•‘
// â•‘    â†’ SUGESTÃƒO: Adicionar filtro ".Where(x => x.Ativo)" se campo existir                           â•‘
// â•‘                                                                                                   â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using FrotiX.Data;
using FrotiX.Models;
using FrotiX.Repository.IRepository;
using Microsoft.AspNetCore.Mvc.Rendering;

namespace FrotiX.Repository
{
    public class ItemVeiculoAtaRepository : Repository<ItemVeiculoAta>, IItemVeiculoAtaRepository
    {
        private new readonly FrotiXDbContext _db;

        public ItemVeiculoAtaRepository(FrotiXDbContext db) : base(db)
        {
            _db = db;
        }

        // [ETAPA] Busca itens de veÃ­culo da ata para popular dropdown
        // Retorna SelectListItem com ItemVeiculoAtaId (GUID) e Descricao
        // OrdenaÃ§Ã£o: Descricao ASC
        // âš ï¸ PROBLEMA: NÃ£o filtra por Status/Ativo (retorna TODOS os registros)
        // TODO: Adicionar filtro ".Where(x => x.Ativo)" se campo existir
        public IEnumerable<SelectListItem> GetItemVeiculoAtaListForDropDown()
        {
            return _db.ItemVeiculoAta
                .OrderBy(o => o.Descricao)
                .Select(i => new SelectListItem()
                {
                    Text = i.Descricao,
                    Value = i.ItemVeiculoAtaId.ToString()
                });
        }

        // [ETAPA] Atualiza item de veÃ­culo da ata existente
        // âš ï¸ CÃ“DIGO MORTO: objFromDb buscado mas nÃ£o utilizado
        // âš ï¸ QUEBRA UNIT OF WORK: Chama _db.Update() + SaveChanges() diretamente
        // TODO: Remover objFromDb (dead code) OU usÃ¡-lo para update manual de campos
        // TODO: Remover SaveChanges() para respeitar Unit of Work pattern
        public new void Update(ItemVeiculoAta itemveiculoata)
        {
            var objFromDb = _db.ItemVeiculoAta.AsTracking().FirstOrDefault(s => s.ItemVeiculoAtaId == itemveiculoata.ItemVeiculoAtaId);

            _db.Update(itemveiculoata);
            _db.SaveChanges();

        }


    }
}


