/*
*  #################################################################################################
*  #   PROJETO: FROTIX - SOLUÃ‡ÃƒO INTEGRADA DE GESTÃƒO DE FROTAS                                    #
*  #   MODULO:  FILTERS - DESABILITAÃ‡ÃƒO DE VALIDAÃ‡ÃƒO DE MODELO                                     #
*  #   DATA:    2026 (ModernizaÃ§Ã£o FrotiX 2026)                                                   #
*  #################################################################################################
*/

using System;
using System.Linq;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.Filters;
using Microsoft.AspNetCore.Mvc.ModelBinding;

namespace FrotiX.Filters
{
    /// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    /// â•‘ ğŸ“Œ NOME: DisableModelValidationAttribute                                     â•‘
    /// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    /// â•‘ ğŸ“ DESCRIÃ‡ÃƒO:                                                                â•‘
    /// â•‘    Atributo de filtro para desabilitar validaÃ§Ã£o automÃ¡tica do ModelState   â•‘
    /// â•‘    em endpoints especÃ­ficos. Executa ANTES da validaÃ§Ã£o do [ApiController]. â•‘
    /// â•‘                                                                              â•‘
    /// â•‘ ğŸ¯ USO:                                                                      â•‘
    /// â•‘    Quando se precisa validaÃ§Ã£o manual personalizada ao invÃ©s da automÃ¡tica  â•‘
    /// â•‘    do [ApiController]. Ãštil para APIs com regras complexas de validaÃ§Ã£o.    â•‘
    /// â•‘                                                                              â•‘
    /// â•‘ âš ï¸  IMPORTANTE:                                                              â•‘
    /// â•‘    Este filtro Ã© IResourceFilter (executa ANTES de IActionFilter).          â•‘
    /// â•‘    Isso garante que limpa ModelState antes da validaÃ§Ã£o automÃ¡tica.         â•‘
    /// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    /// â•‘ ğŸ’¡ EXEMPLO DE USO:                                                           â•‘
    /// â•‘    [HttpPost]                                                                â•‘
    /// â•‘    [DisableModelValidation]                                                  â•‘
    /// â•‘    public IActionResult Save([FromBody] ComplexDto dto) { ... }              â•‘
    /// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    /// â•‘ ğŸ”— ESCOPO: AplicÃ¡vel em Method ou Class                                      â•‘
    /// â•‘    â€¢ Arquivos relacionados: [ApiController], ModelState                     â•‘
    /// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    [AttributeUsage(AttributeTargets.Method | AttributeTargets.Class, AllowMultiple = false)]
    public class DisableModelValidationAttribute : Attribute, IResourceFilter
    {
        /// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        /// â•‘ ğŸ“Œ NOME: OnResourceExecuting                                                 â•‘
        /// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        /// â•‘ ğŸ“ DESCRIÃ‡ÃƒO:                                                                â•‘
        /// â•‘    Executa ANTES da validaÃ§Ã£o automÃ¡tica do [ApiController].                 â•‘
        /// â•‘    Limpa completamente o ModelState para desabilitar validaÃ§Ã£o.              â•‘
        /// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        public void OnResourceExecuting(ResourceExecutingContext context)
        {
            // [REGRA] Desabilita completamente o ModelState para este request
            context.ModelState.Clear();

            // [REGRA] Remove todas as validaÃ§Ãµes pendentes (garantia extra)
            foreach (var key in context.ModelState.Keys.ToList())
            {
                context.ModelState.Remove(key);
            }
        }

        /// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        /// â•‘ ğŸ“Œ NOME: OnResourceExecuted                                                  â•‘
        /// â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        /// â•‘ ğŸ“ DESCRIÃ‡ÃƒO: Executa DEPOIS da action. Sem aÃ§Ã£o necessÃ¡ria.                 â•‘
        /// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        public void OnResourceExecuted(ResourceExecutedContext context)
        {
            // [INFO] Nada a fazer aqui - validaÃ§Ã£o jÃ¡ foi desabilitada no executing
        }
    }
}
