@* ****************************************************************************************
 * ‚ö° ARQUIVO: Pages/Shared/_ImagemFichaVistoriaAmarela.cshtml
 * --------------------------------------------------------------------------------------
 * üéØ OBJETIVO     : Partial view para upload e preview de Ficha de Vistoria com imagem amarela
 *                   padr√£o ou base64 do banco. Upload via input file, preview imagem, bot√£o inserir.
 * üì• ENTRADAS     : @model FrotiX.Pages.Viagens.UpsertModel, Model.ViagemObj.Viagem.FichaVistoria
 *                   (byte[] - blob banco), input file #txtFile (onchange="VisualizaImagem(this)"),
 *                   clique bot√£o #btnFicha (asp-page-handler="InsereFicha")
 * üì§ SA√çDAS       : Layout 3 colunas: input file type="file" asp-for="FotoUpload" (col-5), preview
 *                   #imgViewer (col-5, 1500x1500px object-fit contain border), bot√£o "Insere Ficha"
 *                   btn-azul w-100 (col-2), imagem src data:image/jpeg;base64 ou default FichaAmarelaNova.JPG
 * üîó CHAMADA POR  : Pages/Viagens/Upsert.cshtml (provavelmente antes se√ß√£o Ocorr√™ncias ou Finaliza√ß√£o),
 *                   <partial name="_ImagemFichaVistoriaAmarela"/> ou @await Html.PartialAsync
 * üîÑ CHAMA        : Viagens.UpsertModel.OnPostInsereFicha (PageHandler backend), JavaScript function
 *                   VisualizaImagem(this) (atualiza preview #imgViewer.src com FileReader base64),
 *                   ~/Images/FichaAmarelaNova.JPG (imagem padr√£o template), Url.Content() (resolve ~),
 *                   Convert.ToBase64String() (converte byte[] banco), asp-route-id ViagemId
 * üì¶ DEPEND√äNCIAS : ASP.NET Core Razor Pages (Partial Views), Model UpsertModel (PageModel context),
 *                   JavaScript function VisualizaImagem() (provavelmente em viagens.js ou inline),
 *                   Bootstrap 5 (row, col-md-6 col-lg-5 col-lg-2, d-flex align-items-start/end, mb-3),
 *                   Tag Helpers (asp-for, asp-page-handler, asp-route-id), CSS btn-azul w-100,
 *                   arquivo ~/Images/FichaAmarelaNova.JPG (imagem template amarelo)
 * üìù OBSERVA√á√ïES  : 54 linhas. Sistema upload ficha vistoria com PREVIEW instant√¢neo. L√≥gica C#:
 *                   hasBytes = FichaVistoria != null; se true carrega base64 do banco (data:image/jpeg;base64,)
 *                   sen√£o usa default FichaAmarelaNova.JPG + cachebuster ?t=Ticks. Imagem 1500x1500px
 *                   (dimens√£o fixa n√£o responsiva!), object-fit: contain (mant√©m aspect ratio), border 1px.
 *                   Input file asp-for="FotoUpload" onchange="VisualizaImagem(this)" atualiza preview
 *                   dinamicamente antes do submit. Bot√£o "Insere Ficha" asp-page-handler="InsereFicha"
 *                   asp-route-id ViagemId (POST handler UpsertModel.OnPostInsereFicha). Layout 3 colunas:
 *                   input (col-5) + preview (col-5) + bot√£o (col-2). margin-top: 2rem (bottom-space).
 *                   Classe .bottom-space custom (provavelmente margin-bottom tamb√©m). Para mobile:
 *                   colunas empilham (col-md-6 col-lg-5). Bot√£o d-flex align-items-end (alinha base com imagem).
 *                   Imagem FichaAmarelaNova.JPG sugere template f√≠sico de vistoria C√¢mara dos Deputados.
 **************************************************************************************** *@
@model FrotiX.Pages.Viagens.UpsertModel

@{
    bool hasBytes = Model.ViagemObj.Viagem.FichaVistoria != null;
    string defaultImg = Url.Content("~/Images/FichaAmarelaNova.JPG") + "?t=" + DateTime.Now.Ticks;

    // Pr√©-calcula src e tamanho
    string imgSrc;
    int imgWidth;
    int imgHeight;

    if (hasBytes)
    {
        imgSrc = "data:image/jpeg;base64,"
                 + Convert.ToBase64String(Model.ViagemObj.Viagem.FichaVistoria);
        // ajuste conforme necessidade
        imgWidth = imgHeight = 1500;
    }
    else
    {
        imgSrc = defaultImg;
        // tamanho "√≠cone"
        imgWidth = imgHeight = 1500;
    }
}

<div class="row bottom-space" style="margin-top: 2rem;">
    <div class="col-md-6 col-lg-5">
        <label class="d-block label font-weight-bold">Ficha de Vistoria</label>
        <input asp-for="FotoUpload"
               type="file"
               id="txtFile"
               class="form-control mb-3"
               onchange="VisualizaImagem(this)" />
    </div>

    <div class="col-md-6 col-lg-5 d-flex align-items-start">
        <img id="imgViewer"
             src="@imgSrc"
             width="@imgWidth"
             height="@imgHeight"
             style="object-fit:contain; border:1px solid #000; margin-top:0.5rem;" />
    </div>

    <div class="col-12 col-lg-2 d-flex align-items-end">
        <button id="btnFicha"
                type="button"
                asp-page-handler="InsereFicha"
                asp-route-id="@Model.ViagemObj.Viagem.ViagemId"
                class="btn btn-azul w-100">
            Insere Ficha
        </button>
    </div>
</div>
