@* ****************************************************************************************
 * ‚ö° ARQUIVO: Pages/Multa/ExibePDFAutuacao.cshtml
 * --------------------------------------------------------------------------------------
 * üéØ OBJETIVO     : P√°gina de visualiza√ß√£o PDF notifica√ß√£o de autua√ß√£o multa (VARIANTE ExibePDFComprovante)
 *                   com Syncfusion EJ2 PDFViewer, carrega /DadosEditaveis/Multas/{AutuacaoPDF} (campo DIFERENTE!),
 *                   bot√£o voltar ./ListaAutuacao (n√£o ListaPenalidade), CSS .fundo-chocolate adicional.
 * üì• ENTRADAS     : @page route /Multa/ExibePDFAutuacao, @model ExibePDFAutuacaoModel (code-behind),
 *                   Model.MultaObj.Multa.NumInfracao, Model.MultaObj.Multa.AutuacaoPDF (string filename PDF**DIFERENTE!**)
 * üì§ SA√çDAS       : Panel bot√£o center absolute btn-voltar ./ListaAutuacao (n√£o ListaPenalidade), h2 text-primary
 *                   "Autua√ß√£o da Infra√ß√£o n¬∫: {NumInfracao}", <ejs-pdfviewer id="pdfViewer" serviceUrl="/api/PdfViewer"
 *                   height:100%>, JavaScript pdfViewer.load(/DadosEditaveis/Multas/{AutuacaoPDF}) ou alert danger
 *                   "PDF n√£o dispon√≠vel", Bootstrap 5 CDN (REDUNDANTE!)
 * üîó CHAMADA POR  : Link "Ver Autua√ß√£o" em ListaAutuacao DataTable a√ß√£o, route /Multa/ExibePDFAutuacao,
 *                   ExibePDFAutuacaoModel.OnGet(id) (code-behind)
 * üîÑ CHAMA        : ExibePDFAutuacaoModel (code-behind Multa/ExibePDFAutuacao.cshtml.cs), Model.MultaObj.Multa
 *                   (NumInfracao, **AutuacaoPDF** campo DIFERENTE ExibePDFComprovante que usa ComprovantePDF),
 *                   ./ListaAutuacao (link voltar DIFERENTE), /api/PdfViewer (Syncfusion service), /DadosEditaveis/Multas/
 *                   {filename}.pdf, ejs-pdfviewer TagHelper, ej2_instances[0], pdfViewer.load(), AppToast.show
 *                   (mensagem DIFERENTE "Arquivo de autua√ß√£o n√£o encontrado"), Alerta.TratamentoErroComLinha
 *                   ("ExibePDFAutuacao.cshtml" DIFERENTE), ViewData, Font Awesome (fa-pen-to-square DIFERENTE),
 *                   Bootstrap 5 CDN, AntiForgeryToken (linha 27 DENTRO form), stopEnterSubmitting, form enctype,
 *                   CSS inline (.center + .fundo-chocolate #7B3F00 ADICIONAL N√ÉO usado!)
 * üì¶ DEPEND√äNCIAS : ASP.NET Core Razor Pages, ExibePDFAutuacaoModel, Syncfusion EJ2 PDFViewer (ejs-pdfviewer,
 *                   /api/PdfViewer, ej2_instances), Bootstrap 5 CDN (REDUNDANTE), Font Awesome Duotone, CSS inline
 *                   (.center + .fundo-chocolate), JavaScript DOMContentLoaded, AppToast, Alerta, AntiForgeryToken
 * üìù OBSERVA√á√ïES  : 113 linhas. P√°gina visualiza√ß√£o PDF notifica√ß√£o autua√ß√£o (VARIANTE ExibePDFComprovante).
 *                   **DIFEREN√áAS vs ExibePDFComprovante** (estrutura 95% id√™ntica):
 *                   1. **ViewData Title**: "Notifica√ß√µes" vs "Pagamento da Penalidade"
 *                   2. **ViewData PageName**: "notificacao_index" (MESMO ERRADO! ambos usam "notificacao_index")
 *                   3. **ViewData Heading icon**: fa-pen-to-square vs fa-cash-register
 *                   4. **ViewData Heading text**: "Notifica√ß√£o de Autua√ß√£o - PDF" vs "Registro de Pagamento da Penalidade - PDF"
 *                   5. **ViewData PageIcon**: fa-pen-to-square vs fa-cash-register
 *                   6. **CSS inline**: .fundo-chocolate {background:#7B3F00; color:#fff;} **ADICIONAL** (N√ÉO usado!)
 *                   7. **Link voltar**: ./ListaAutuacao vs ./ListaPenalidade
 *                   8. **H2 text**: "Autua√ß√£o da Infra√ß√£o n¬∫" vs "Registro de Pagamento da Infra√ß√£o n¬∫"
 *                   9. **Campo PDF**: Model.MultaObj?.Multa?.AutuacaoPDF vs ComprovantePDF  (DIFEREN√áA CR√çTICA!)
 *                   10. **AppToast mensagem**: "Arquivo de autua√ß√£o n√£o encontrado" vs "Arquivo de comprovante"
 *                   11. **Alerta string**: "ExibePDFAutuacao.cshtml" vs "ExibePDFComprovante.cshtml"
 *                   **TODO O RESTO ID√äNCTICO**: Form asp-action "Upsert" (N√ÉO faz sentido), enctype multipart/form-data
 *                   (N√ÉO usado), stopEnterSubmitting, ejs-pdfviewer config, JavaScript structure, Bootstrap CDN redundante.
 *                   ViewData config:
 *                   - Title: "Notifica√ß√µes"
 *                   - PageName: "notificacao_index" (ERRADO! deve ser "multa_exibepdfautuacao" - mesmo bug
 *                     ExibePDFComprovante/Penalidade todos 3 usam "notificacao_index"!)
 *                   - Heading: "<i class='fa-duotone fa-pen-to-square'></i> Cadastros: <span class='fw-300'>Notifica√ß√£o de Autua√ß√£o - PDF</span>"
 *                   - Category1: "Cadastros"
 *                   - PageIcon: "fa-duotone fa-pen-to-square"
 *                   CSS inline: .center {position:absolute; left:50%; top:30px; transform:translate(-50%,-50%);
 *                   padding:10px;} + .fundo-chocolate {background-color:#7B3F00; color:#fff;} **N√ÉO usado!**
 *                   (adicional esta p√°gina - remover). Estrutura ID√äNCTICA ExibePDFComprovante exceto diferen√ßas
 *                   listadas acima. **PROBLEMAS ID√äNCTICOS ExibePDFComprovante**:
 *                   1. PageName "notificacao_index" ERRADO (todos 3 arquivos ExibePDF* usam mesmo PageName bug)
 *                   2. Form asp-action "Upsert" N√ÉO faz sentido (remover)
 *                   3. Enctype multipart/form-data N√ÉO usado
 *                   4. Bootstrap CDN redundante
 *                   5. CSS .fundo-chocolate N√ÉO usado (remover)
 *                   **CORRETO neste arquivo**: Campo AutuacaoPDF APROPRIADO (n√£o ComprovantePDF), link ./ListaAutuacao
 *                   APROPRIADO, mensagens erro contextualizadas. **ARQUIVOS RELACIONADOS**: ExibePDFComprovante.cshtml
 *                   (comprovante pagamento), ExibePDFPenalidade.cshtml (DUPLICADO ExibePDFComprovante - mesmo campo!).
 **************************************************************************************** *@
@page
@model FrotiX.Pages.Multa.ExibePDFAutuacaoModel

@{
	ViewData["Title"] = "Notifica√ß√µes";
	ViewData["PageName"] = "notificacao_index";
	ViewData["Heading"] = "<i class='fa-duotone fa-pen-to-square'></i> Cadastros: <span class='fw-300'>Notifica√ß√£o de Autua√ß√£o - PDF</span>";
	ViewData["Category1"] = "Cadastros";
	ViewData["PageIcon"] = "fa-duotone fa-pen-to-square";
}

@section HeadBlock {
	<style>
		.center {
			position: absolute;
			left: 50%;
			top: 30px;
			transform: translate(-50%, -50%);
			padding: 10px;
		}

		.fundo-chocolate {
			background-color: #7B3F00;
			color: #fff;
		}
	</style>
}

<form method="post" asp-action="Upsert" onkeypress="stopEnterSubmitting(window.event)" enctype="multipart/form-data">
	@Html.AntiForgeryToken()

	<div class="row">
		<div class="col-xl-12">
			<div id="panel-1" class="panel">
				<div class="panel-container show">
					<br />
					<div class="col-12 col-md-4 center">
						<a asp-page="./ListaAutuacao" class="btn btn-voltar form-control" data-ftx-loading>
							<i class="fa-duotone fa-rotate-left icon-space icon-rotate-left"></i>
							Voltar √† Lista
						</a>
					</div>

					<br />
					<div class="col-12 px-3" style="border-bottom:1px solid #325d88">
						<h2 class="text-primary">
							@($"Autua√ß√£o da Infra√ß√£o n¬∫: {Model.MultaObj?.Multa?.NumInfracao}")
						</h2>
					</div>

					<div id="divPainel" class="panel-content">
						<div id="pdfContainer" style="height: 800px;">
							<ejs-pdfviewer id="pdfViewer"
										   style="height:100%"
										   serviceUrl="/api/PdfViewer"
										   documentPath="">
							</ejs-pdfviewer>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</form>

@section ScriptsBlock {
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" crossorigin="anonymous" />
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

	<script>
		// Evita submit com ENTER em campos de formul√°rio
		function stopEnterSubmitting(e) {
			try {
				e = e || window.event;
				if (e && (e.key === 'Enter' || e.keyCode === 13)) {
					const src = e.target || e.srcElement;
					if (src && src.tagName && src.tagName.toLowerCase() !== "div") {
						if (e.preventDefault) e.preventDefault();
						else e.returnValue = false;
					}
				}
			}
			catch (error) {
				Alerta.TratamentoErroComLinha("ExibePDFAutuacao.cshtml", "stopEnterSubmitting", error);
			}
		}

		document.addEventListener('DOMContentLoaded', function () {
			try {
				var arquivoPdf = '@(Model.MultaObj?.Multa?.AutuacaoPDF ?? "")';

				if (!arquivoPdf) {
					AppToast.show('Arquivo de autua√ß√£o n√£o encontrado para esta infra√ß√£o.', 'Vermelho', 3000);
					document.getElementById('pdfContainer').innerHTML = "<div class='alert alert-danger text-center mt-5'>PDF n√£o dispon√≠vel.</div>";
					return;
				}

				var caminho = "/DadosEditaveis/Multas/" + arquivoPdf;
				var pdfViewer = document.getElementById('pdfViewer').ej2_instances[0];

				if (pdfViewer) {
					pdfViewer.load(caminho, null);
				}
				else {
					AppToast.show('Erro ao inicializar o visualizador de PDF.', 'Vermelho', 3000);
				}
			}
			catch (error) {
				Alerta.TratamentoErroComLinha("ExibePDFAutuacao.cshtml", "DOMContentLoaded", error);
			}
		});
	</script>
}
