<Window x:Class="DeepSeekIDE.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        mc:Ignorable="d"
        Title="DeepSeek IDE"
        Height="900" Width="1400"
        MinHeight="600" MinWidth="800"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        Background="#1e1e1e">

    <Window.Resources>
        <!-- Cores do tema escuro estilo VS Code -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="#1e1e1e"/>
        <SolidColorBrush x:Key="SidebarBrush" Color="#252526"/>
        <SolidColorBrush x:Key="ActivityBarBrush" Color="#333333"/>
        <SolidColorBrush x:Key="StatusBarBrush" Color="#007acc"/>
        <SolidColorBrush x:Key="TitleBarBrush" Color="#3c3c3c"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#3c3c3c"/>
        <SolidColorBrush x:Key="TextBrush" Color="#cccccc"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#007acc"/>

        <!-- Estilo dos botões da Activity Bar -->
        <Style x:Key="ActivityBarButton" TargetType="Button">
            <Setter Property="Width" Value="48"/>
            <Setter Property="Height" Value="48"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#808080"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}"
                                BorderThickness="2,0,0,0" BorderBrush="Transparent">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#ffffff"/>
                            </Trigger>
                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=Tag}" Value="Active">
                                <Setter Property="Foreground" Value="#ffffff"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#007acc"/>
                            </DataTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <!-- Title Bar -->
            <RowDefinition Height="30"/>
            <!-- Main Content -->
            <RowDefinition Height="*"/>
            <!-- Status Bar -->
            <RowDefinition Height="22"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <Border Grid.Row="0" Background="{StaticResource TitleBarBrush}" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Logo e Menu -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="10,0,0,0">
                    <TextBlock Text="DeepSeek IDE" Foreground="{StaticResource TextBrush}"
                               VerticalAlignment="Center" FontSize="12" FontWeight="SemiBold"/>
                </StackPanel>

                <!-- Título do arquivo aberto -->
                <TextBlock Grid.Column="1" x:Name="txtCurrentFile"
                           Text="Bem-vindo"
                           Foreground="#808080"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           FontSize="12"/>

                <!-- Botões de controle da janela -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="─" Width="46" Height="30" Click="Minimize_Click"
                            Background="Transparent" BorderThickness="0" Foreground="#cccccc"
                            FontSize="10"/>
                    <Button x:Name="btnMaximize" Content="□" Width="46" Height="30" Click="Maximize_Click"
                            Background="Transparent" BorderThickness="0" Foreground="#cccccc"
                            FontSize="10"/>
                    <Button Content="✕" Width="46" Height="30" Click="Close_Click"
                            Background="Transparent" BorderThickness="0" Foreground="#cccccc"
                            FontSize="10"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <!-- Activity Bar (ícones laterais) -->
                <ColumnDefinition Width="48"/>
                <!-- Sidebar (explorador, busca, etc) -->
                <ColumnDefinition Width="250"/>
                <!-- Splitter -->
                <ColumnDefinition Width="1"/>
                <!-- Editor Principal -->
                <ColumnDefinition Width="*"/>
                <!-- Splitter -->
                <ColumnDefinition Width="1"/>
                <!-- Painel de Chat IA -->
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>

            <!-- Activity Bar -->
            <Border Grid.Column="0" Background="{StaticResource ActivityBarBrush}">
                <StackPanel>
                    <Button x:Name="btnExplorer" Style="{StaticResource ActivityBarButton}"
                            Tag="Active" Click="ActivityBar_Click" ToolTip="Explorador (Ctrl+Shift+E)">
                        <TextBlock Text="&#xf07c;" FontFamily="Segoe MDL2 Assets" FontSize="24"/>
                    </Button>
                    <Button x:Name="btnSearch" Style="{StaticResource ActivityBarButton}"
                            Click="ActivityBar_Click" ToolTip="Buscar (Ctrl+Shift+F)">
                        <TextBlock Text="&#xf002;" FontFamily="Segoe MDL2 Assets" FontSize="24"/>
                    </Button>
                    <Button x:Name="btnGit" Style="{StaticResource ActivityBarButton}"
                            Click="ActivityBar_Click" ToolTip="Controle de Versão (Ctrl+Shift+G)">
                        <TextBlock Text="&#xf126;" FontFamily="Segoe MDL2 Assets" FontSize="24"/>
                    </Button>
                    <Button x:Name="btnChat" Style="{StaticResource ActivityBarButton}"
                            Click="ActivityBar_Click" ToolTip="Chat IA (Ctrl+Shift+I)">
                        <TextBlock Text="&#xe8bd;" FontFamily="Segoe MDL2 Assets" FontSize="24"/>
                    </Button>
                </StackPanel>
            </Border>

            <!-- Sidebar -->
            <Border Grid.Column="1" Background="{StaticResource SidebarBrush}">
                <Grid>
                    <!-- Explorer Panel -->
                    <Grid x:Name="pnlExplorer" Visibility="Visible">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="35"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                            <Grid Margin="10,0">
                                <TextBlock Text="EXPLORADOR" Foreground="#bbbbbb"
                                           VerticalAlignment="Center" FontSize="11" FontWeight="SemiBold"/>
                                <Button Content="..." HorizontalAlignment="Right"
                                        Background="Transparent" BorderThickness="0" Foreground="#808080"
                                        Width="20" Height="20" Click="OpenFolder_Click" ToolTip="Abrir Pasta"/>
                            </Grid>
                        </Border>

                        <TreeView x:Name="treeExplorer" Grid.Row="1"
                                  Background="Transparent" BorderThickness="0"
                                  Foreground="{StaticResource TextBrush}"
                                  SelectedItemChanged="TreeExplorer_SelectedItemChanged">
                            <TreeView.ItemTemplate>
                                <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                    <StackPanel Orientation="Horizontal" Margin="2">
                                        <TextBlock Text="{Binding Icon}" FontFamily="Segoe MDL2 Assets"
                                                   Foreground="#dcb67a" Margin="0,0,6,0" FontSize="14"/>
                                        <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextBrush}"/>
                                    </StackPanel>
                                </HierarchicalDataTemplate>
                            </TreeView.ItemTemplate>
                        </TreeView>
                    </Grid>

                    <!-- Search Panel -->
                    <Grid x:Name="pnlSearch" Visibility="Collapsed">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="35"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                            <TextBlock Text="BUSCAR" Foreground="#bbbbbb" Margin="10,0"
                                       VerticalAlignment="Center" FontSize="11" FontWeight="SemiBold"/>
                        </Border>

                        <StackPanel Grid.Row="1" Margin="10">
                            <TextBox x:Name="txtSearch" Height="26" Background="#3c3c3c"
                                     Foreground="{StaticResource TextBrush}" BorderBrush="#3c3c3c"
                                     Padding="8,4" KeyDown="TxtSearch_KeyDown"/>
                            <CheckBox x:Name="chkCaseSensitive" Content="Diferenciar maiúsculas"
                                      Foreground="{StaticResource TextBrush}" Margin="0,8,0,0"/>
                            <CheckBox x:Name="chkRegex" Content="Expressão regular"
                                      Foreground="{StaticResource TextBrush}" Margin="0,4,0,0"/>
                        </StackPanel>

                        <ListBox x:Name="lstSearchResults" Grid.Row="2"
                                 Background="Transparent" BorderThickness="0"
                                 Foreground="{StaticResource TextBrush}"
                                 SelectionChanged="SearchResults_SelectionChanged"/>
                    </Grid>

                    <!-- Git Panel -->
                    <Grid x:Name="pnlGit" Visibility="Collapsed">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="35"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                            <Grid Margin="10,0">
                                <TextBlock Text="CONTROLE DE VERSÃO" Foreground="#bbbbbb"
                                           VerticalAlignment="Center" FontSize="11" FontWeight="SemiBold"/>
                                <Button Content="⟳" HorizontalAlignment="Right"
                                        Background="Transparent" BorderThickness="0" Foreground="#808080"
                                        Width="20" Height="20" Click="RefreshGit_Click" ToolTip="Atualizar (F5)"
                                        FontSize="14"/>
                            </Grid>
                        </Border>

                        <StackPanel Grid.Row="1" Margin="10">
                            <TextBlock x:Name="txtGitBranch" Text="Branch: main"
                                       Foreground="{StaticResource TextBrush}" FontSize="12"/>
                            <TextBlock x:Name="txtGitStatus" Text="Nenhuma alteração"
                                       Foreground="#808080" FontSize="11" Margin="0,4,0,0"/>
                        </StackPanel>

                        <!-- Botões Git: Push, Pull, Fetch -->
                        <Grid Grid.Row="2" Margin="10,0,10,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="0" Content="↓ Pull" Height="26" Margin="0,0,4,0"
                                    Background="#3c3c3c" Foreground="{StaticResource TextBrush}"
                                    BorderThickness="0" Click="Pull_Click" ToolTip="Baixar alterações do remoto"/>
                            <Button Grid.Column="1" Content="↑ Push" Height="26" Margin="2,0,2,0"
                                    Background="#3c3c3c" Foreground="{StaticResource TextBrush}"
                                    BorderThickness="0" Click="Push_Click" ToolTip="Enviar alterações para o remoto"/>
                            <Button Grid.Column="2" Content="⇄ Fetch" Height="26" Margin="4,0,0,0"
                                    Background="#3c3c3c" Foreground="{StaticResource TextBrush}"
                                    BorderThickness="0" Click="Fetch_Click" ToolTip="Buscar informações do remoto"/>
                        </Grid>

                        <ListBox x:Name="lstGitChanges" Grid.Row="3"
                                 Background="Transparent" BorderThickness="0"
                                 Foreground="{StaticResource TextBrush}"/>

                        <StackPanel Grid.Row="4" Margin="10">
                            <TextBox x:Name="txtCommitMessage" Height="60"
                                     Background="#3c3c3c" Foreground="{StaticResource TextBrush}"
                                     BorderBrush="#3c3c3c" TextWrapping="Wrap"
                                     AcceptsReturn="True" Padding="8"
                                     ToolTip="Mensagem do commit"/>
                            <Button Content="✓ Commit" Height="28" Margin="0,8,0,0"
                                    Background="{StaticResource AccentBrush}" Foreground="White"
                                    BorderThickness="0" Click="Commit_Click"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>

            <!-- Splitter Sidebar/Editor -->
            <GridSplitter Grid.Column="2" Width="1" Background="{StaticResource BorderBrush}"
                          HorizontalAlignment="Stretch"/>

            <!-- Editor Principal (WebView2 com Monaco) -->
            <Grid Grid.Column="3">
                <Grid.RowDefinitions>
                    <!-- Tabs -->
                    <RowDefinition Height="35"/>
                    <!-- Editor -->
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Tabs de arquivos abertos -->
                <Border Grid.Row="0" Background="{StaticResource SidebarBrush}">
                    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                        <StackPanel x:Name="pnlTabs" Orientation="Horizontal"/>
                    </ScrollViewer>
                </Border>

                <!-- WebView2 para Monaco Editor -->
                <wv2:WebView2 x:Name="webEditor" Grid.Row="1"
                              DefaultBackgroundColor="#1e1e1e"/>
            </Grid>

            <!-- Splitter Editor/Chat -->
            <GridSplitter Grid.Column="4" Width="1" Background="{StaticResource BorderBrush}"
                          HorizontalAlignment="Stretch"/>

            <!-- Painel de Chat com IA -->
            <Border Grid.Column="5" Background="{StaticResource SidebarBrush}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="35"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header do Chat -->
                    <Border Grid.Row="0" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                        <Grid Margin="10,0">
                            <TextBlock Text="DEEPSEEK CHAT" Foreground="#bbbbbb"
                                       VerticalAlignment="Center" FontSize="11" FontWeight="SemiBold"/>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button Content="Regras" Padding="8,2" Margin="0,0,8,0"
                                        Background="#3c3c3c" Foreground="{StaticResource TextBrush}"
                                        BorderThickness="0" Click="EditRules_Click" ToolTip="Editar regras do chat"/>
                                <ComboBox x:Name="cmbModel" Width="120" Height="22"
                                          Background="#3c3c3c" Foreground="{StaticResource TextBrush}"
                                          BorderThickness="0" SelectedIndex="0">
                                    <ComboBoxItem Content="deepseek-chat"/>
                                    <ComboBoxItem Content="deepseek-reasoner"/>
                                </ComboBox>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Painel de Regras (colapsável) -->
                    <Border x:Name="pnlRules" Grid.Row="1" Background="#2d2d2d" Visibility="Collapsed"
                            BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                        <Grid Margin="10,8">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="Regras para o Chat (System Prompt):"
                                       Foreground="#bbbbbb" FontSize="11" Margin="0,0,0,4"/>

                            <TextBox x:Name="txtRules" Grid.Row="1"
                                     Height="80" Background="#3c3c3c"
                                     Foreground="{StaticResource TextBrush}"
                                     BorderBrush="#3c3c3c" TextWrapping="Wrap"
                                     AcceptsReturn="True" Padding="8"
                                     VerticalScrollBarVisibility="Auto"
                                     Text="Você é um assistente de programação útil e experiente. Responda de forma clara e concisa. Quando fornecer código, use blocos de código com a linguagem especificada."/>

                            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,4,0,0">
                                <Button Content="Carregar do Arquivo" Padding="8,2" Margin="0,0,4,0"
                                        Background="#3c3c3c" Foreground="{StaticResource TextBrush}"
                                        BorderThickness="0" Click="LoadRulesFromFile_Click"/>
                                <Button Content="Salvar" Padding="8,2"
                                        Background="{StaticResource AccentBrush}" Foreground="White"
                                        BorderThickness="0" Click="SaveRules_Click"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Mensagens do Chat -->
                    <ScrollViewer x:Name="scrollChat" Grid.Row="2" VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="pnlChatMessages" Margin="10"/>
                    </ScrollViewer>

                    <!-- Input do Chat -->
                    <Border Grid.Row="3" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0">
                        <Grid Margin="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Dica de uso -->
                            <TextBlock Grid.Row="0"
                                       Text="Mencione arquivos com @arquivo.cs, #arquivo.cs, [arquivo.cs] ou `arquivo.cs`"
                                       Foreground="#666666" FontSize="10" Margin="0,0,0,4"/>

                            <TextBox x:Name="txtChatInput" Grid.Row="1"
                                     MinHeight="80" MaxHeight="200"
                                     Background="#3c3c3c" Foreground="{StaticResource TextBrush}"
                                     BorderBrush="#3c3c3c" TextWrapping="Wrap"
                                     AcceptsReturn="True" Padding="8"
                                     KeyDown="TxtChatInput_KeyDown"
                                     ToolTip="Use @arquivo.cs para carregar arquivos automaticamente. Ctrl+Enter para enviar."/>

                            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                                <Button Content="Limpar Chat" Margin="0,0,8,0" Padding="12,4"
                                        Background="#722f37" Foreground="White"
                                        BorderThickness="0" Click="ClearChat_Click"
                                        ToolTip="Limpar histórico de conversa"/>
                                <Button Content="Analisar Editor" Margin="0,0,8,0" Padding="12,4"
                                        Background="#3c3c3c" Foreground="{StaticResource TextBrush}"
                                        BorderThickness="0" Click="AnalyzeCode_Click"
                                        ToolTip="Analisar código do editor atual"/>
                                <Button Content="Enviar (Ctrl+Enter)" Padding="12,4"
                                        Background="{StaticResource AccentBrush}" Foreground="White"
                                        BorderThickness="0" Click="SendChat_Click"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="{StaticResource StatusBarBrush}">
            <Grid Margin="10,0">
                <StackPanel Orientation="Horizontal">
                    <TextBlock x:Name="txtStatusGit" Text="main" Foreground="White"
                               VerticalAlignment="Center" FontSize="11" Margin="0,0,15,0"/>
                    <TextBlock x:Name="txtStatusErrors" Text="0 Erros" Foreground="White"
                               VerticalAlignment="Center" FontSize="11" Margin="0,0,15,0"/>
                    <TextBlock x:Name="txtStatusWarnings" Text="0 Avisos" Foreground="White"
                               VerticalAlignment="Center" FontSize="11"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock x:Name="txtStatusLine" Text="Ln 1, Col 1" Foreground="White"
                               VerticalAlignment="Center" FontSize="11" Margin="0,0,15,0"/>
                    <TextBlock x:Name="txtStatusEncoding" Text="UTF-8" Foreground="White"
                               VerticalAlignment="Center" FontSize="11" Margin="0,0,15,0"/>
                    <TextBlock x:Name="txtStatusLanguage" Text="Plaintext" Foreground="White"
                               VerticalAlignment="Center" FontSize="11"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
